<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Connect IQ Core Topics</title>
	<meta name="author" content="Garmin International"/>
	<meta name="date" content="July 10, 2020"/>
	<link type="text/css" rel="stylesheet" href="resources/programmers-guide/style.css"/>
	<meta name="copyright" content="Connect IQ Core Topics version 3.2, Copyright 2020 Garmin, International."/>
</head>
<body>

<link href="resources/programmers-guide/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
<script src="resources/programmers-guide/jquery-1.11.3.min.js"></script>
<script>
    $(document).ready( function() {
        $( 'pre' ).addClass( 'prettyprint' );
    } );
</script>
<script src="resources/programmers-guide/google-code-prettify/run_prettify.js"></script>
<div id="connect_iq_logo">
<figure>
<img src="resources/programmers-guide/connect_iq_logo.png" style="max-width:471px;" title="Powered by Garmin" />
</figure>
</div>
<div id="title">Connect IQ Core Topics</div>
<div id="tagline">Fundamentals of the Connect IQ Platform</div>
<div class="clear"></div>

<h1 id="tableofcontents">Table of Contents</h1>
<div id="toc">

<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#manifestfileandpermissions">Manifest File and Permissions</a>

<ul>
<li><a href="#applicationattributes">Application Attributes</a></li>
<li><a href="#products">Products</a></li>
<li><a href="#permissions">Permissions</a></li>
</ul></li>
<li><a href="#theapplicationobject">The Application Object</a>

<ul>
<li><a href="#manifest">Manifest</a></li>
<li><a href="#lifecycleevents">Lifecycle Events</a>

<ul>
<li><a href="#youhavetostartsomewhere...">You Have to Start Somewhere&#8230;</a></li>
<li><a href="#aviewtoakillerui">A View to a Killer UI</a></li>
<li><a href="#allgoodthingsmustcometoanend">All Good Things Must Come to an End</a></li>
</ul></li>
</ul></li>
<li><a href="#persistingdata">Persisting Data</a>

<ul>
<li><a href="#storage">Storage</a>

<ul>
<li><a href="#accessingstorage:application.storageconnectiq2.x">Accessing Storage: <code>Application.Storage</code> (Connect IQ 2.x)</a></li>
<li><a href="#accessingpropertiesandsettings:application.properties">Accessing Properties and Settings: <code>Application.Properties</code></a></li>
</ul></li>
<li><a href="#accessingpropertiesandsettings:objectstore">Accessing Properties and Settings: Object Store</a></li>
<li><a href="#whichapishouldiuse">Which API Should I Use?</a></li>
</ul></li>
<li><a href="#backgroundservicesconnectiq2.3">Background Services (Connect IQ 2.3)</a></li>
<li><a href="#glancesconnectiq3.1">Glances (Connect IQ 3.1)</a>

<ul>
<li><a href="#howtoenableglancesupportinwidget">How to Enable Glance Support in Widget</a></li>
<li><a href="#howwidgetsstartonglancepage">How Widgets Start on &#8216;Glance Page&#8217;</a></li>
<li><a href="#glancelifecycle">Glance Lifecycle</a>

<ul>
<li><a href="#liveuiupdate">Live UI Update</a></li>
<li><a href="#backgrounduiupdate">Background UI Update</a></li>
<li><a href="#bestpractices">Best Practices</a></li>
</ul></li>
</ul></li>
<li><a href="#settings">Settings</a>

<ul>
<li><a href="#changingsettingswithingarminconnectmobilegarminexpress">Changing Settings Within Garmin Connect Mobile/Garmin Express</a></li>
<li><a href="#testingappsettings">Testing App Settings</a></li>
<li><a href="#ondevicewatchfaceanddatafieldsettingsconnectiq3.2">On Device Watch Face and Data Field Settings (Connect IQ 3.2)</a></li>
</ul></li>
<li><a href="#intentsconnectiq2.2">Intents (Connect IQ 2.2)</a>

<ul>
<li><a href="#exitingtoconnectiqapps">Exiting to Connect IQ Apps</a></li>
<li><a href="#exitingtonativeapps">Exiting to Native Apps</a></li>
<li><a href="#intentexceptions">Intent Exceptions</a></li>
</ul></li>
<li><a href="#buildconfiguration">Build Configuration</a>

<ul>
<li><a href="#devicefamilyandlocalizationqualifiers">Device, Family, and Localization Qualifiers</a>

<ul>
<li><a href="#devicequalifiers">Device Qualifiers</a></li>
<li><a href="#familyqualifiers">Family Qualifiers</a></li>
<li><a href="#localizationqualifiers">Localization Qualifiers</a></li>
</ul></li>
<li><a href="#buildconfigurationviajungles">Build Configuration via Jungles</a>

<ul>
<li><a href="#configuringresourcepaths">Configuring Resource Paths</a></li>
<li><a href="#feelingexcluded">Feeling Excluded</a></li>
</ul></li>
<li><a href="#buildfileexclusions">Build File Exclusions</a></li>
</ul></li>
<li><a href="#security">Security</a>

<ul>
<li><a href="#developerkeys">Developer Keys</a></li>
<li><a href="#generatingakeyusingopenssl">Generating a Key Using OpenSSL</a></li>
<li><a href="#generatingakeyusingtheeclipseplug-in">Generating a Key Using the Eclipse Plug-in</a></li>
<li><a href="#runningondevice">Running on Device</a></li>
</ul></li>
<li><a href="#viewsdrawablesandlayers">Views, Drawables and Layers</a>

<ul>
<li><a href="#views">Views</a></li>
<li><a href="#drawables">Drawables</a></li>
<li><a href="#layersconnectiq3.1">Layers (Connect IQ 3.1)</a>

<ul>
<li><a href="#animationlayer">AnimationLayer</a></li>
</ul></li>
</ul></li>
<li><a href="#layouts">Layouts</a>

<ul>
<li><a href="#layout">Layout</a></li>
<li><a href="#label">Label</a></li>
<li><a href="#textareaconnectiq3.1">Text Area (Connect IQ 3.1)</a></li>
<li><a href="#drawables-1">Drawables</a></li>
<li><a href="#drawablelist">Drawable List</a></li>
<li><a href="#shape">Shape</a></li>
<li><a href="#bitmap">Bitmap</a></li>
<li><a href="#customdrawables">Custom Drawables</a>

<ul>
<li><a href="#passingparameterstocustomdrawables">Passing Parameters to Custom Drawables</a></li>
</ul></li>
</ul></li>
<li><a href="#graphics">Graphics</a>

<ul>
<li><a href="#drawingcontext">Drawing Context</a></li>
<li><a href="#clippingconnectiq2.3">Clipping (Connect IQ 2.3)</a></li>
<li><a href="#stringsandfonts">Strings and Fonts</a></li>
<li><a href="#bufferedbitmapsconnectiq2.3">Buffered Bitmaps (Connect IQ 2.3)</a></li>
<li><a href="#anti-aliasingconnectiq3.2">Anti-Aliasing (Connect IQ 3.2)</a></li>
</ul></li>
<li><a href="#inputhandling">Input Handling</a>

<ul>
<li><a href="#inputandapptypes">Input and App Types</a></li>
<li><a href="#inputdelegates">Input Delegates</a></li>
<li><a href="#behaviors">Behaviors</a></li>
<li><a href="#selectablesandbuttonsconnectiq2.1">Selectables and Buttons (Connect IQ 2.1)</a>

<ul>
<li><a href="#selectables">Selectables</a></li>
<li><a href="#buttons">Buttons</a></li>
<li><a href="#definingselectablesandbuttonsinlayouts">Defining Selectables And Buttons In Layouts</a></li>
</ul></li>
</ul></li>
<li><a href="#nativeuicontrols">Native UI Controls</a>

<ul>
<li><a href="#menu">Menu</a></li>
<li><a href="#menu2connectiq3.0">Menu2 (Connect IQ 3.0)</a>

<ul>
<li><a href="#menu2xmlresources">Menu2 XML Resources</a></li>
<li><a href="#iconmenuitem">Icon Menu Item</a></li>
<li><a href="#checkboxandtogglemenuitems">Checkbox and Toggle Menu Items</a></li>
</ul></li>
<li><a href="#genericpicker">Generic Picker</a>

<ul>
<li><a href="#userinterface">User Interface</a></li>
<li><a href="#developmentinterface">Development Interface</a></li>
</ul></li>
<li><a href="#numberpicker-_deprecated_">Number Picker - <em>DEPRECATED</em></a></li>
<li><a href="#confirmationdialog">Confirmation Dialog</a></li>
<li><a href="#progressbar">Progress Bar</a></li>
<li><a href="#datafield">Data Field</a></li>
<li><a href="#mappingconnectiq3.0">Mapping (Connect IQ 3.0)</a>

<ul>
<li><a href="#mapview">MapView</a></li>
<li><a href="#maptrackview">MapTrackView</a></li>
<li><a href="#mappingartifacts">Mapping Artifacts</a>

<ul>
<li><a href="#mappolyline">MapPolyline</a></li>
<li><a href="#mapmarker">MapMarker</a></li>
</ul></li>
<li><a href="#simulatingmaps">Simulating Maps</a></li>
</ul></li>
<li><a href="#alertsconnectiq3.2">Alerts (Connect IQ 3.2)</a></li>
</ul></li>
<li><a href="#resources">Resources</a>

<ul>
<li><a href="#theresourcemodulea.k.a.rez">The Resource Module (a.k.a. Rez)</a>

<ul>
<li><a href="#referencingresourceswithinresourcefiles">Referencing Resources Within Resource Files</a></li>
</ul></li>
<li><a href="#resourcescopesconnectiq3.1">Resource Scopes (Connect IQ 3.1)</a></li>
<li><a href="#bitmaps">Bitmaps</a></li>
<li><a href="#animationsconnectiq3.1">Animations (Connect IQ 3.1)</a>

<ul>
<li><a href="#includinganimationresourcesinamonkeycproject">Including Animation Resources in a Monkey C Project</a></li>
</ul></li>
<li><a href="#fonts">Fonts</a></li>
<li><a href="#jsondata">JSON Data</a></li>
</ul></li>
<li><a href="#jsonrestrequests">JSON REST Requests</a>

<ul>
<li><a href="#jsonrestrequestsviamobileproxy">JSON REST Requests via Mobile Proxy</a></li>
</ul></li>
<li><a href="#authenticatedwebservices">Authenticated Web Services</a>

<ul>
<li><a href="#oauth101">OAUTH 101</a></li>
<li><a href="#oauthandwearables">OAUTH and Wearables</a></li>
</ul></li>
<li><a href="#communicatingwithmobileapps">Communicating with Mobile Apps</a>

<ul>
<li><a href="#directinguserstowebcontent">Directing Users to Web Content</a></li>
<li><a href="#mobilesdkdownloads">Mobile SDK Downloads</a></li>
<li><a href="#blesimulationoverandroiddebugbridge">BLE Simulation Over Android Debug Bridge</a></li>
</ul></li>
<li><a href="#downloadingcontentconnectiq2.2">Downloading Content (Connect IQ 2.2)</a>

<ul>
<li><a href="#persistedcontentinthesimulator">Persisted Content in the Simulator</a></li>
<li><a href="#wifibulkdownloadsconnectiq3.1">WiFi Bulk Downloads (Connect IQ 3.1)</a></li>
</ul></li>
<li><a href="#mobilesdkforandroid">Mobile SDK for Android</a>

<ul>
<li><a href="#addingthemobilesdktoaproject">Adding the Mobile SDK to a Project</a></li>
<li><a href="#interactingwiththesdk">Interacting with the SDK</a></li>
<li><a href="#initializingthesdk">Initializing the SDK</a></li>
<li><a href="#displayingauimessageautomaticallywheninitializationfailsdisplayuimessage">Displaying a UI Message Automatically When Initialization Fails <a href="#displayuimessage">DisplayUIMessage</a></a></li>
<li><a href="#workingwithdevices">Working with Devices</a>

<ul>
<li><a href="#findingconnectiq-compatibledevices">Finding Connect IQ-compatible Devices</a></li>
<li><a href="#listeningfordeviceevents">Listening for Device Events</a></li>
</ul></li>
<li><a href="#workingwithapps">Working with Apps</a>

<ul>
<li><a href="#obtaininganinstanceofiqapp">Obtaining an Instance of IQApp</a></li>
<li><a href="#openingtheconnectiqstore">Opening the Connect IQ Store</a></li>
</ul></li>
<li><a href="#sendingmessagessendingmessages">Sending Messages <a href="#sendingmessages">SendingMessages</a></a></li>
<li><a href="#receivingmessagesreceivingmessages">Receiving Messages <a href="#receivingmessages">ReceivingMessages</a></a></li>
<li><a href="#supporteddatatypessupporteddata">Supported Data Types <a href="#supporteddata">SupportedData</a></a></li>
</ul></li>
<li><a href="#mobilesdkforios">Mobile SDK for iOS</a>

<ul>
<li><a href="#configuringaprojecttousethemobilesdk">Configuring a Project To Use the Mobile SDK</a></li>
<li><a href="#initializingthesdk-1">Initializing the SDK</a>

<ul>
<li><a href="#implementingauioverridedelegate">Implementing a UI Override Delegate</a></li>
</ul></li>
<li><a href="#workingwithdevices-1">Working with Devices</a>

<ul>
<li><a href="#findingconnectiq-compatibledevices-1">Finding Connect IQ-compatible Devices</a></li>
<li><a href="#listeningfordeviceevents-1">Listening for Device Events</a></li>
</ul></li>
<li><a href="#workingwithapps-1">Working with Apps</a>

<ul>
<li><a href="#creatinganappinstance">Creating an App Instance</a></li>
</ul></li>
<li><a href="#requestinganappsstatus">Requesting an App&#8217;s Status</a>

<ul>
<li><a href="#installingupgradingormanaginganapp">Installing, Upgrading or Managing an App</a></li>
<li><a href="#sendingmessages">Sending Messages</a></li>
</ul></li>
<li><a href="#receivingmessages">Receiving Messages</a></li>
</ul></li>
<li><a href="#antandant">ANT and ANT+</a>

<ul>
<li><a href="#genericantchannels">Generic ANT channels</a>

<ul>
<li><a href="#usingantstickinlinux">Using ANT stick in Linux</a></li>
</ul></li>
<li><a href="#communicatingwithatempesensor">Communicating with a Tempe Sensor</a></li>
<li><a href="#burstdataconnectiq2.2">Burst Data (Connect IQ 2.2)</a></li>
<li><a href="#antprofilesconnectiq2.2">ANT+ Profiles (Connect IQ 2.2)</a></li>
</ul></li>
<li><a href="#gettingstartedwithconnectiqbledevelopment">Getting Started with Connect IQ BLE Development</a>

<ul>
<li><a href="#resources-1">Resources</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#mac">Mac</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#usingnordicnrfconnect">Using Nordic nRF Connect</a></li>
<li><a href="#findingthecomport">Finding The COM Port</a>

<ul>
<li><a href="#windows-1">Windows</a></li>
<li><a href="#mac-1">Mac</a></li>
<li><a href="#linux-1">Linux</a></li>
<li><a href="#settingthecomport">Setting the COM Port</a></li>
</ul></li>
</ul></li>
<li><a href="#sensors">Sensors</a>

<ul>
<li><a href="#accelerometerdataconnectiq2.3">Accelerometer Data (Connect IQ 2.3)</a>

<ul>
<li><a href="#filteringaccelerometerdata">Filtering Accelerometer Data</a></li>
<li><a href="#loggingaccelerometerdata">Logging Accelerometer Data</a></li>
</ul></li>
<li><a href="#sensorhistoryconnectiq2.1">Sensor History (Connect IQ 2.1)</a></li>
</ul></li>
<li><a href="#positioning">Positioning</a>

<ul>
<li><a href="#location">Location</a></li>
<li><a href="#locationevents">Location Events</a></li>
</ul></li>
<li><a href="#activityrecording">Activity Recording</a>

<ul>
<li><a href="#recordingfitfiles">Recording FIT Files</a></li>
<li><a href="#fitdeveloperfields">FIT Developer Fields</a></li>
</ul></li>
<li><a href="#shareablelibraries">Shareable Libraries</a>

<ul>
<li><a href="#makingamonkeybarrel">Making a Monkey Barrel</a></li>
<li><a href="#barrelsandversions">Barrels and Versions</a></li>
<li><a href="#exportingamonkeybarrel">Exporting a Monkey Barrel</a></li>
<li><a href="#howtoincludebarrels">How to Include Barrels</a>

<ul>
<li><a href="#addingbarrelstoaprojectwiththeeclipseplugin">Adding Barrels to a Project with the Eclipse Plugin</a></li>
</ul></li>
<li><a href="#usingmonkeybarrels">Using Monkey Barrels</a></li>
<li><a href="#runnoevilandmonkeybarrels">Run No Evil and Monkey Barrels</a></li>
<li><a href="#barrelsinthecommandline">Barrels In The Command Line</a></li>
<li><a href="#unlockingbarrels">Unlocking Barrels</a></li>
</ul></li>
<li><a href="#testinganddebugging">Testing and Debugging</a>

<ul>
<li><a href="#basicdebugging">Basic Debugging</a></li>
<li><a href="#debuggingviaeclipse">Debugging via Eclipse</a>

<ul>
<li><a href="#settingabreakpoint">Setting a Breakpoint</a></li>
<li><a href="#viewingapplicationstatus">Viewing Application Status</a></li>
</ul></li>
<li><a href="#debuggingwiththecommandlineconnectiq3.2">Debugging with the Command Line (Connect IQ 3.2)</a>

<ul>
<li><a href="#gettingstarted">Getting Started</a></li>
<li><a href="#loadingandrunninganexecutable">Loading and Running an Executable</a></li>
<li><a href="#settingbreakpoints">Setting Breakpoints</a></li>
<li><a href="#frameinformation">Frame Information</a></li>
<li><a href="#controllingexecution">Controlling Execution</a></li>
</ul></li>
<li><a href="#handlingcrashes">Handling Crashes</a>

<ul>
<li><a href="#appcrashes">App Crashes</a></li>
<li><a href="#devicecrashes">Device Crashes</a></li>
<li><a href="#anoteaboutlogfiles">A Note About Log Files</a></li>
</ul></li>
</ul></li>
<li><a href="#unittesting">Unit Testing</a>

<ul>
<li><a href="#asserts">Asserts</a></li>
<li><a href="#unittests">Unit Tests</a></li>
</ul></li>
<li><a href="#errorreportingapplicationera">Error Reporting Application (ERA)</a>

<ul>
<li><a href="#gettingstarted-1">Getting Started</a>

<ul>
<li><a href="#commandline">Command Line</a></li>
</ul></li>
<li><a href="#addinganewdeveloper">Adding a New Developer</a></li>
<li><a href="#viewingappsettings">Viewing App Settings</a></li>
<li><a href="#viewingcrashreports">Viewing Crash Reports</a></li>
</ul></li>
<li><a href="#publishingtotheconnectiqstore">Publishing to the Connect IQ Store</a>

<ul>
<li><a href="#checksupportedproducts">Check Supported Products</a></li>
<li><a href="#exportingtheapp">Exporting the App</a></li>
<li><a href="#publishingthefirstversion">Publishing the First Version</a></li>
<li><a href="#gdpr">GDPR</a></li>
<li><a href="#approvalprocess">Approval Process</a></li>
</ul></li>
<li><a href="#betaapps">Beta Apps</a></li>
<li><a href="#apptrialsconnectiq2.3">App Trials (Connect IQ 2.3)</a>

<ul>
<li><a href="#trialmodefunctionality">Trial Mode Functionality</a></li>
<li><a href="#trialappserverapi">Trial App Server API</a></li>
<li><a href="#howtousethecallbackurl">How to Use the callbackUrl</a></li>
</ul></li>
</ul>
</div>

<h1 id="overview">Overview</h1>

<p>This section covers the core topics of the Connect IQ platform.</p>

<h1 id="manifestfileandpermissions">Manifest File and Permissions</h1>
<figure>
<img src="resources/programmers-guide/wizard-monkey.png" style="max-width:300px;" title="Sometimes fixing bugs requires a little magic." />
</figure>

<p>All Connect IQ apps require a manifest file. The manifest file is an XML file that specifies application properties like the application type and the supported products. The manifest file is created automatically by the Eclipse plug-in, but it can be created hand as well:</p>

<pre><code class="xml">&lt;iq:manifest version=&quot;1&quot;&gt;
    &lt;iq:application entry=&quot;CommExample&quot; id=&quot;a3421feed289106a538cb9547ab12095&quot;
        name=&quot;AppName&quot; launcherIcon=&quot;LauncherIcon&quot; type=&quot;widget&quot; minSdkVersion=&quot;1.3.1&quot;&gt;

        &lt;iq:products&gt;
            &lt;iq:product id=&quot;vivoactive&quot;/&gt;
        &lt;/iq:products&gt;

        &lt;iq:permissions&gt;
            &lt;iq:uses-permission id=&quot;Communications&quot;/&gt;
        &lt;/iq:permissions&gt;

    &lt;/iq:application&gt;
&lt;/iq:manifest&gt;
</code></pre>

<h2 id="applicationattributes">Application Attributes</h2>

<p>The <code>application</code> element has a number of important attributes. The <code>id</code> field is a 128-bit UUID identifier. Unique identifiers can be generated with the <a href="http://www.uuidgenerator.net/version4">UUID Generator</a> or with standard tools.</p>

<p>The <code>entry</code> attribute must specify the <code>Toybox.Application.AppBase</code> object for your application.</p>

<p>The <code>name</code> and <code>launcherIcon</code> attributes must specify a resource ID that is defined in the app resources. If a <code>launcherIcon</code> isn&#8217;t specified a default icon will be compiled into the application.</p>

<p>The <code>type</code> field specifies what kind of application you are developing. Currently Connect IQ supports four types of apps:</p>

<ol>
<li><code>watchface</code></li>
<li><code>datafield</code></li>
<li><code>widget</code></li>
<li><code>watch-app</code></li>
<li><code>audio-content-provider</code></li>
</ol>

<p>The app type specified in the manifest file determines where your app appears on the device and which APIs the app can use.</p>

<p>The <code>minSdkVersion</code> field specifies the minimum Connect IQ SDK version that your app is compatible with, and serves to prevent you from targeting incompatible devices. The Eclipse plug-in allows you to select a minimum SDK version when creating a new app, or editing the properties of an existing one. Currently, the following versions are selectable when configuring your app:</p>

<ol>
<li><code>1.2.x</code></li>
<li><code>1.3.x</code></li>
<li><code>2.1.x</code></li>
</ol>

<p>The micro version is written out to the manifest at version 1 (1.2.1 for example), but only the major and minor versions are considered when determining device support.</p>

<p>Every application must include an <code>Application</code> object, which serves as the entry point for your application:</p>

<pre><code class="typescript">// AppBase is the base class for an app. All apps shall inherit from this
// class. It is used to manage the lifecycle of an app. For widgets and
// watch-apps, the functions are called in the following order: onStart(),
// getInitialView() and onStop(). For watchfaces and datafields, only
// getInitialView() is called. Every AppBase object has access to an object
// store to persist data.
class AppBase
{
    // Before the initial WatchUi.View is retrieved, onStart() is called.
    // This is where app level settings can be initialized or retrieved from
    // the object store before the initial View is created.
    function onStart(state);

    // To retrieve the initial WatchUi.View and WatchUi.InputDelegate
    // of the application, call getInitialView(). Providing a
    // WatchUi.InputDelegate is optional for widgets and watch-apps. For
    // watchfaces and datafields, an array containing just a WatchUi.View
    // should be returned as input is not available for these app types.
    // @return [Array] An array containing
    //     [ WatchUi.View, WatchUi.InputDelegate (optional) ]
    function getInitialView();

    // When the system is going to terminate an application, onStop() is called.
    // If the application needs to save state to the object store it should be
    // done in this function.
    function onStop(state);

    // To get the data associated with the given key from the object store,
    // use getProperty().
    // @param key Key of the value to retrieve from the object store
    //     (cannot be a Symbol)
    // @return [Object] Content associated with the key, or null if the key
    //     is not in the object store
    function getProperty( key );

    // Using a key, store the given data in the object by calling setProperty().
    // @param key The key used to store and retrieve the value from the object
    //     store (cannot be a Symbol)
    // @param [String] value The value to put into the object store
    function setProperty( key, value );

    // The GOAL_TYPE enum defines the different goal types that can be triggered.
    enum
    {
        // @since 1.3.0
        GOAL_TYPE_STEPS             = 0,
        // @since 1.3.0
        GOAL_TYPE_FLOORS_CLIMBED    = 1,
        // @since 1.3.0
        GOAL_TYPE_ACTIVE_MINUTES    = 2
    }

    // Retrieves the WatchUi.View for a goal that has triggered within a watchface.
    // If a goal is reached when a watchface is running, this function will be triggered.
    // The type of goal that was met will be provided, and the AppBase should return
    // a View that displays a goal reached message and/or animations for that goal.
    // If a View is returned from this function, the main watchface view will be
    // shutdown, and then new View will pushed. If this method is not overridden
    // in the AppBase, or if it returns null, the native goal screens will be shown.
    // @param goalType [Number] The goal type that has triggered from. From the GOAL_TYPE_??? enumeration.
    // @return [Array] An array containing [ WatchUi.View ]
    // @since 1.3.0
    function getGoalView(goalType);


    // Retrieves the System.ServiceDelegate for running background tasks for this app.
    // The method that has been triggered within the ServiceDelegate will be run. The
    // background task will be automatically terminated after 30 seconds if it does
    // not exit before this time by using Background.exit() or System.exit().
    // @return [Array] An array containing [ System.ServiceDelegate ]
    // @since 2.3.0
    (:minSdk(&quot;2.3.0&quot;))
    function getServiceDelegate()
    {
        return null;
    }

    // Passes data from a background process to the application. When the background process
    // termintates, a data payload can be passed. If the main application is active when this
    // occurs, the data will be passed directly to the applications onBackgroundData() method.
    // If the main application is not active, the data will be saved until the next time the
    // application is executed, and will be passed to the application after the onStart()
    // method completes.
    // @param data [Lang.Object] The data passed from the background process.
    // @since 2.3.0
    (:minSdk(&quot;2.3.0&quot;))
    function onBackgroundData(data)
    {
        return null;
    }
}
</code></pre>

<p>The Eclipse plug-in will generate an <code>Application</code> object when a project is created.</p>

<p>An <code>Application</code> object should override <code>getInitialView()</code> to provide the view object to initially push. An array must be returned with either a view and a delegate, or just a one element array with the <code>View</code> object:</p>

<pre><code class="java">return [ new MyView(), new MyDelegate() ];
</code></pre>

<h2 id="products">Products</h2>

<p>Garmin makes a wide variety of products for many use cases, and Monkey C makes it easy to write for all our Connect IQ compatible devices. Monkey C asks the developer which Connect IQ devices they choose to support because it is impossible to know whether a future product may be incompatible with your app. As new Connect IQ compatible products appear on the market, the simulator will be updated to support them so developers can decide whether to support them.</p>

<p>Products supported by an app are listed in the <code>products</code> block of the manifest file:</p>

<pre><code class="xml">&lt;iq:products&gt;
    &lt;iq:product id=&quot;round-watch&quot;/&gt;
&lt;/iq:products&gt;
</code></pre>

<h2 id="permissions">Permissions</h2>

<p>Certain modules expose personal information about the user or expose communication to the internet. To use these modules, permission must be requested from the user at the time of installation. To request permission, the module name must be added to the permissions list of the manifest file.</p>

<p>More modules may be added to this list as modules are added to the API. To request permission, use the following syntax in the manifest file:</p>

<pre><code class="xml">&lt;iq:permissions&gt;
    &lt;iq:uses-permission id=&quot;Sensor&quot;/&gt;
&lt;/iq:permissions&gt;
</code></pre>

<h1 id="theapplicationobject">The Application Object</h1>

<p>Every application has to have a class that extends <code>Toybox.Application.AppBase</code>. This object, known as the application object, is the handler for application lifecycle events.</p>

<h2 id="manifest">Manifest</h2>

<p>The Application object must be specified in the application <code>manifest.xml</code>. This is used by the build tools to denote which class to load at startup.</p>

<pre><code class="xml">&lt;iq:application entry=&quot;[Your Application Class Name Here]&quot; id=&quot;[Manifest UUID]&quot; launcherIcon=&quot;@Drawables.LauncherIcon&quot; minSdkVersion=&quot;3.1.0&quot; name=&quot;@Strings.AppName&quot; type=&quot;watch-app&quot; version=&quot;1.0.11&quot;&gt;

</code></pre>

<h2 id="lifecycleevents">Lifecycle Events</h2>

<p>The application handles three main lifecycle events: startup, getting the initial view, and termination.</p>

<h3 id="youhavetostartsomewhere...">You Have to Start Somewhere&#8230;</h3>

<p>After your application is loaded, your application object will be instantiated. From that point forward it will be available throughout the application by calling <code>Application.getApp()</code>.</p>

<p>After you application object is instantiated, the <code>onStart(state)</code> function will be called. This is your opportunity to initialize the application and restore state.</p>

<p>If your application is launched via an <code>Intent</code>, the state parameter will contain arguments passed via the intent.</p>

<p>Do not attempt to push a <code>View</code> instance at this time.</p>

<h3 id="aviewtoakillerui">A View to a Killer UI</h3>

<p>Once your application is loaded, the system will request the initial view for your application. Depending on what functionality your application implements, you may have to implement several of the following handlers:</p>

<ul>
<li><code>getInitialView()</code>: The primary method for app startup. Return the base view for your watch face, data field, widget, or device app.</li>
<li><code>getGlanceView()</code>: If your are implementing a widget that has a glance, this will be called when the user goes to browse your glance in the glance list.</li>
<li><code>getGoalView()</code>: If your watch face is overriding the goal views, this gives you an opportunity to present your goal view.</li>
<li><code>getPlaybackConfigurationView()</code>: If you are implementing an audio content provider, this method is called when you need to present playback options to the user.</li>
</ul>

<p>All of these functions return an array: The first item is the <code>View</code> instance, and the second is the <code>InputDelegate</code> instance that handles the input for the view.</p>

<h3 id="allgoodthingsmustcometoanend">All Good Things Must Come to an End</h3>

<p>When your application is terminated, the <code>onStop(state)</code> function is called. This gives your application the option to save state before termination.</p>

<h1 id="persistingdata">Persisting Data</h1>

<p>Connect IQ is also able to save data from within an app at runtime. For example, an app may need to obtain or calculate data and store it for later use. This is accomplished by the use of Storage, Properties, and Settings.</p>

<ul>
<li><em>Storage</em> represents data written to disk so it may persist across executions of an application.</li>
<li><em>Properties</em> are constant values defined at build time and included in the executable that are useful for product-specific values that shouldn&#8217;t be defined in code. Properties may also define the default Settings values.</li>
<li><em>Settings</em> are user-editable values modified through Garmin Connect Mobile and Garmin Express. Default settings values are defined by Properties.</li>
</ul>

<h2 id="storage">Storage</h2>

<p>Storage is used for saving and retrieving data from the file system of the device at run time as defined by the developer. This data is only available to the application and is not accessible by the end user. For example, this feature could be used to store a location from when an app was last used. The next time the app is launched, Storage can provide the last known location to the app.</p>

<p>The following data types may be stored:</p>

<ul>
<li><code>Number</code></li>
<li><code>Float</code></li>
<li><code>Long</code></li>
<li><code>Double</code></li>
<li><code>Char</code></li>
<li><code>String</code></li>
<li><code>Boolean</code></li>
<li><code>Array</code></li>
<li><code>Dictionary</code></li>
</ul>

<p>It is important to note that an <code>Array</code> or <code>Dictionary</code> may only contain the data types listed above. For example, it is not possible to store a <code>Symbol</code> in an <code>Array</code> or <code>Dictionary</code> in Storage.</p>

<h3 id="accessingstorage:application.storageconnectiq2.x">Accessing Storage: <code>Application.Storage</code> (Connect IQ 2.x)</h3>

<p>Connect IQ 2.4 introduces the <code>Application.Storage</code> module, which manages persistent key-value pair data storage. Information is automatically saved on disk when <code>Storage.setValue()</code> is called. Keys and values are limited to 8 KB each, and a total of 128 KB of storage is available.</p>

<p>For example, an application might save a location for later use with the code below:</p>

<pre><code class="java">Application.Storage.setValue(&quot;location&quot;, locationValue.toDegrees());
</code></pre>

<p>The next time the application is launched, the stored location value can be retrieved and displayed:</p>

<pre><code class="java">var myLastLocation = Application.Storage.getValue(&quot;location&quot;);
dc.drawText(x, y, Graphics.FONT_SMALL, &quot;Last location: &quot; + myLastLocation, Graphics.TEXT_JUSTIFY_LEFT);
</code></pre>

<p>Connect IQ 3.2 introduces the ability to access the Application.Storage module from background processes. The background process can modify storage using <code>Application.Storage.setValue()</code>, <code>Application.Storage.deleteValue()</code> and <code>Application.Storage.clearValues()</code>. When the storage is written from the background process, <code>Application.onStorageChanged()</code> callback will be invoked for the foreground process if the background and foreground process are active at the same time and vice-versa. The application would then have to reload data from storage to reflect updated information.</p>

<h3 id="accessingpropertiesandsettings:application.properties">Accessing Properties and Settings: <code>Application.Properties</code></h3>

<p>Connect IQ 2.4 also introduced the <code>Application.Properties</code> module, which provides an interface for accessing the values and properties of settings. Information is automatically saved on disk when <code>Application.onStop()</code> is called. To get or set a property value use the <code>Properties.getValue()</code> or <code>Properties.setValue()</code> methods, respectively:</p>

<pre><code class="java">// Set an Object Store app setting
Properties.setValue(&quot;mySetting&quot;, mySetting);

// Get an Object Store app setting value
var mySetting = Properties.getValue(&quot;mySetting&quot;);
</code></pre>

<h2 id="accessingpropertiesandsettings:objectstore">Accessing Properties and Settings: Object Store</h2>

<p>Prior to Connect IQ 2.4, properties and settings were accessed the same way Object Store storage values are accessed. This functionality is still available, though use of the <code>Application.Properties</code> module is preferred on devices that support Connect IQ 2.4 or higher.</p>

<p>Object Store properties and settings are saved on disk to a .SET file when <code>Application.onStop()</code> is called. To get or set a property value use the <code>Application.AppBase.getProperty()</code> or <code>Application.AppBase.setProperty()</code> functions respectively:</p>

<pre><code class="java">// Set an Object Store app setting
Application.getApp().setProperty(&quot;mySetting&quot;, mySetting);

// Get an Object Store app setting value
var mySetting = Application.getApp().getProperty(&quot;mySetting&quot;);
</code></pre>

<h2 id="whichapishouldiuse">Which API Should I Use?</h2>

<p>If your app runs on devices before Connect IQ 2.4, Application.Storage offers a superior solution for persisting application data compared to the Object Store. Using the newer APIs in an existing app is simply a matter of updating code to call the new methods. However, there are a couple of important things of which to be aware:</p>

<ol>
<li><p>Object Store data files are not converted to the new format.</p>

<p>If an app used storage prior to Connect IQ 2.4, existing properties will not automatically migrate to the new file format used by the <code>Application.Storage</code> module. If a conversion is needed, an app must include a routine to get the data from the old files and store it in the new format.</p></li>
<li><p><code>Application.Properties</code> will throw an exception if attempting to write to an undefined property.</p>

<p>Prior to Connect IQ 2.4, an attempt to write to an undefined property would result in a value written to storage (the .STR file) since <code>Application.AppBase.getProperty()</code> and <code>Application.AppBase.setProperty()</code> were overloaded to function with each of Storage, Properties, and Settings. This behavior will no longer occur when using the <code>Application.Properties</code> module since it is distinct from <code>Application.Settings</code>. Instead, an <code>InvalidKeyException</code> is thrown.</p></li>
</ol>

<p>To maximize the number of supported devices, use a <code>has</code> check to see if the Storage API is available and then call the appropriate methods based on what the device supports:</p>

<pre><code class="typescript">if ( Toybox.Application has :Storage ) {
    // use Application.Storage and Application.Properties methods
} else {
    // use Application.AppBase methods
}
</code></pre>

<h1 id="backgroundservicesconnectiq2.3">Background Services (Connect IQ 2.3)</h1>

<p>Applications can register for background services. Services can be registered to run when various events occur. These events include when the user reaches goal targets, when sleep and wake times occur, when a steps threshold is reached, or at a scheduled time. Modules available to background processes differ from those of their parent application.</p>

<p>When background services are started, the <code>getServiceDelegate()</code> is run from the <code>Application</code> object. This method returns a <code>System.ServiceDelegate</code> and the method corresponding to the event that triggered is invoked. Once a background service has finished any necessary tasks, it should exit using the <code>Background.exit()</code> method. This method takes a argument containing data to be sent to the main process. Use null to provide no data.</p>

<p>Services may be terminated at any time free memory for foreground applications. Services will also be terminated automatically if the do not exit properly within 30 seconds of opening.</p>

<p>In the Connect IQ simulator, an option has been added under the Simulation menu, which allows manually triggering background services. When manually triggering a service, the background service for the most recently run application will be loaded, and the corresponding call in the <code>ServiceDelegate</code> will be triggered regardless of whether the application has registered for that event.</p>

<p>This feature is available only in devices running the 2.3.0 SDK or later.</p>

<h1 id="glancesconnectiq3.1">Glances (Connect IQ 3.1)</h1>

<p>The intention of widgets was to make various kinds of information important to the user available at a glance.
 While the app carousel does allow quick navigation, navigating the loop may require launching numerous applications
 to get to what you&#8217;re looking for. It also dedicates the entire screen for a given context.</p>

<p>Glances, introduced in the fēnix® 6, turns the presentation of widgets into a dashboard. Instead of a carousel,
 the user is presented with a list of metrics. Selecting a list item will launch the Widget. In Connect IQ 3.1
 we are adding the ability for developers to support this exciting new feature.</p>

<h2 id="howtoenableglancesupportinwidget">How to Enable Glance Support in Widget</h2>

<p>A new <code>GlanceView</code> class has been added to <code>WatchUi</code>. Think of the <code>WatchUi.GlanceView</code> as a small canvas to present an executive summary from your widget.
 The <code>WatchUi.GlanceView</code> is similar to other <code>View</code> objects in <code>WatchUi</code> but should only be used for implementing a Glance for your widget.
 Override the <code>AppBase.getGlanceView()</code> and return your implementation of <code>WatchUi.GlanceView</code> to add Glance support.</p>

<p>If widget doesn&#8217;t override <code>AppBase.getGlanceView()</code>, default <code>WatchUi.GlanceView</code> will be used, which simply shows the name of the Widget.</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/glance_page.png" style="max-width:800px;" alt="glance page" />
<figcaption>Glance Page</figcaption>
</figure>
</div>

<h2 id="howwidgetsstartonglancepage">How Widgets Start on &#8216;Glance Page&#8217;</h2>

<p>When a Widget is shown as part of the &#8216;Glance Page&#8217;, it will be started in a special running mode,
 a.k.a Glance mode, with limited memory allocated, e.g. 32KB for most devices.</p>

<p>Similar to Background services, developers can use the <code>:glance</code> annotation to indicate which
 modules and / or classes are necessary when running a Widget in Glance mode.
 Using the annotation selectively allows developers to limit memory usage.</p>

<p>It&#8217;s important to note that it is not guaranteed what mode a Widget will be started in first,
 i.e. it&#8217;s not a valid assumption that a Widget will always be started first
 in Glance mode then in normal Widget mode.</p>

<h2 id="glancelifecycle">Glance Lifecycle</h2>

<p>Depending on a device&#8217;s resource limitations, <code>WatchUi.GlanceView</code> can be updated in two different ways.</p>

<h3 id="liveuiupdate">Live UI Update</h3>

<p>Devices that have ample resources <a href="#fn:1" id="fnref:1" title="see footnote" class="footnote">[1]</a> will start the Widget in Glance mode, and keep it alive. The provided
 <code>WatchUi.GlanceView</code> will be updated as needed by the system, and calls to <code>WatchUi.requestUpdate()</code> will
 trigger a <code>View</code> update as expected.</p>

<p>Note: It&#8217;s highly recommended that the update rate should be kept under 1HZ to provide a better scrolling experience.</p>

<h3 id="backgrounduiupdate">Background UI Update</h3>

<p>Devices that have less memory <a href="#fn:2" id="fnref:2" title="see footnote" class="footnote">[2]</a> will start the app only when the system deems it appropriate,
 and calls to <code>WatchUi.requestUpdate()</code> will have no effect. Such a device could update the &#8216;Glance Page&#8217;
 when it becomes visible (activated) and at least 30 seconds since last update.</p>

<p>During a background update, the Widget and its <code>GlanceView</code> will run through a complete life cycle.
 The <code>AppBase</code> functions <code>onStart()</code>, <code>getGlanceView()</code> will be called to start the app and retrieve the view.
 Once the <code>GlanceView</code> has been retrieved, the <code>View</code> functions <code>onLayout()</code>, <code>onShow()</code>, <code>onUpdate()</code> and
 <code>onHide()</code> will be called. The <code>AppBase</code> function <code>onStop()</code> will be called, and the app will be shut down.</p>

<p>All content that is rendered to the <code>dc</code> passed to <code>View.onUpdate()</code> will be cached on the filesystem
 and used to display until the next time the system decides to do an update.</p>

<h3 id="bestpractices">Best Practices</h3>

<p>Most functionality supported in Widget is still supported when running as a Glance,
 such as accessing application storage and make web requests, However, developers should focus on making
 <code>GlanceView</code> quick to load and moving CPU intensive work to a Background service.</p>

<p>See <a href="https://developer.garmin.com/connect-iq/api-docs/Toybox/WatchUi/GlanceView.html">API documentation</a> for more details.</p>

<h1 id="settings">Settings</h1>

<p>The app settings framework enables app developers to present options to end users for their apps within Garmin Connect Mobile and Garmin Express. This will allow app customization and setup, especially for watch faces and data fields, which have no way to receive user input.</p>

<p>An app setting is composed of a property and an associated setting. The property is used to store the underlying setting value. The setting is used to describe how the property should displayed to the end user. You can define a property as a default value and not define an associated setting but you cannot define a setting without tying it to a property.</p>

<p>Settings are also defined as a resource. Use the <code>&lt;setting&gt;</code> tag to define a setting.</p>

<pre><code class="xml">&lt;settings&gt;

    &lt;setting propertyKey=&quot;@Properties.appVersion&quot; title=&quot;@Strings.AppVersionTitle&quot;&gt;
        &lt;settingConfig type=&quot;alphaNumeric&quot; readonly=&quot;true&quot; /&gt;
    &lt;/setting&gt;

    &lt;setting propertyKey=&quot;@Properties.myString&quot; title=&quot;@Strings.MyStringTitle&quot; prompt=&quot;@Strings.MyStringPrompt&quot;&gt;
        &lt;settingConfig type=&quot;list&quot;&gt;
            &lt;listEntry value=&quot;0&quot;&gt;@Strings.HelloWorld&lt;/listEntry&gt;
            &lt;listEntry value=&quot;1&quot;&gt;@Strings.Ackbar&lt;/listEntry&gt;
            &lt;listEntry value=&quot;2&quot;&gt;@Strings.Garmin&lt;/listEntry&gt;
        &lt;/settingConfig&gt;
    &lt;/setting&gt;

    &lt;setting propertyKey=&quot;@Properties.myNumber&quot; title=&quot;@Strings.MyNumberTitle&quot; prompt=&quot;@Strings.MyNumberPrompt&quot;&gt;
        &lt;settingConfig type=&quot;numeric&quot; errorMessage=&quot;@Strings.MyNumberError&quot; /&gt;
    &lt;/setting&gt;

    &lt;setting propertyKey=&quot;@Properties.screenSleep&quot; title=&quot;@Strings.ScreenSleepTitle&quot;&gt;
        &lt;settingConfig type=&quot;boolean&quot; /&gt;
    &lt;/setting&gt;

    &lt;setting propertyKey=&quot;@Properties.username&quot; title=&quot;@Strings.UsernameTitle&quot;&gt;
        &lt;settingConfig type=&quot;alphaNumeric&quot; required=&quot;true&quot; /&gt;
    &lt;/setting&gt;

&lt;/settings&gt;
</code></pre>

<p>The table below shows all of the valid attributes for a setting.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>propertyKey</code></td>
	<td style="text-align:left;">The key of the property that this setting will manage. An error will be thrown at compile time if the property key can&#8217;t be found.</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>title</code></td>
	<td style="text-align:left;">The title to display in Garmin Connect Mobile/Garmin Express when displaying the list of settings/value of the setting. This must reference a string resource ID.</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>prompt</code></td>
	<td style="text-align:left;">The message to display when prompting the user to set the value. This must reference a string resource ID.</td>
	<td style="text-align:left;">Optional. Some settings will not display a prompt even if it&#8217;s provided (for example, <code>readonly</code> or <code>boolean</code> settings displayed as an on/off switch).</td>
</tr>
<tr>
	<td style="text-align:center;"><code>helpUrl</code></td>
	<td style="text-align:left;">A URL to a web page which will provide help for the user.</td>
	<td style="text-align:left;">Optional</td>
</tr>
</tbody>
</table>

<p>A <code>&lt;settingConfig&gt;</code>, a child element of a <code>&lt;setting&gt;</code>, provides additional details about the setting. The valid attributes are given in the table below.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Value</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>type</code></td>
	<td style="text-align:left;">The display type of the setting.</td>
	<td style="text-align:left;"><code>list</code>, <code>boolean</code>, <code>numeric</code>, <code>alphaNumeric</code>, <code>phone</code>, <code>email</code>, <code>url</code>, <code>date</code> or <code>password</code></td>
	<td style="text-align:left;">A value of <code>list</code> will require child <code>&lt;listEntry&gt;</code> elements to define the options which should be available within the list.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>readonly</code></td>
	<td style="text-align:left;">If the setting is read only or not. This attribute is valid for all types except <code>list</code> and <code>password</code>.</td>
	<td style="text-align:left;"><code>true</code> or <code>false</code></td>
	<td style="text-align:left;">Optional. Defaults to <code>false</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>required</code></td>
	<td style="text-align:left;">If the field is required.</td>
	<td style="text-align:left;"><code>true</code> or <code>false</code></td>
	<td style="text-align:left;">Optional. Defaults to <code>false</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>min</code></td>
	<td style="text-align:left;">The minimum value to allow.</td>
	<td style="text-align:left;">An integer value</td>
	<td style="text-align:left;">Optional. Only valid for a <code>type</code> value of <code>numeric</code> or <code>date</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>max</code></td>
	<td style="text-align:left;">The maximum value to allow.</td>
	<td style="text-align:left;">An integer value</td>
	<td style="text-align:left;">Optional. Only valid for a <code>type</code> value of <code>numeric</code> or <code>date</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>maxLength</code></td>
	<td style="text-align:left;">The maximum allowed value length.</td>
	<td style="text-align:left;">An integer value</td>
	<td style="text-align:left;">Optional. Only valid for settings whose associated property&#8217;s type is <code>string</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>errorMessage</code></td>
	<td style="text-align:left;">An error message to display if the value a user enters isn&#8217;t valid based on the <code>type</code>, <code>min</code>, <code>max</code> and <code>maxLength</code> values.</td>
	<td style="text-align:left;">A reference to a string resource.</td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p><code>&lt;settingConfig&gt;</code> types are only valid for certain property types:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Property Type</th>
	<th style="text-align:left;">Valid settingsConfig Types</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>string</code></td>
	<td style="text-align:left;"><code>alphaNumeric</code>, <code>phone</code>, <code>email</code>, <code>url</code>, <code>password</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>number</code></td>
	<td style="text-align:left;"><code>list</code>, <code>numeric</code>, <code>date</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>float</code></td>
	<td style="text-align:left;"><code>numeric</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>boolean</code></td>
	<td style="text-align:left;"><code>boolean</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p>The <code>&lt;listEntry&gt;</code> element is defined in the table below. Its value must be a reference to a string resource.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>value</code></td>
	<td style="text-align:left;">The value to save if this item is selected by the user.</td>
	<td style="text-align:left;">The type of the value should match the property it&#8217;s being saved to. If it doesn&#8217;t match a compile time error is thrown.</td>
</tr>
</tbody>
</table>

<h2 id="changingsettingswithingarminconnectmobilegarminexpress">Changing Settings Within Garmin Connect Mobile/Garmin Express</h2>

<p>End users will be able to view the settings you define within the Garmin Connect Mobile or Garmin Express UI. When app settings are changed while an app is running the <code>Application.AppBase.onSettingsChanged()</code> function is called. Apps can override this function and update accordingly. When dealing with date type settings that are set by Garmin Express or Connect Mobile, one should note that times are stored in UTC and that <code>Gregorian.utcInfo()</code> should be used in place of <code>Gregorian.info()</code> when working with such values to prevent unneeded local time conversion.</p>

<h2 id="testingappsettings">Testing App Settings</h2>

<p>An app settings editor tool is available within the Eclipse plug-in. This tool will allow you to view the defined settings for a project in Eclipse, select values for each setting and send them to the simulator for testing.</p>
<figure>
<img src="resources/programmers-guide/app_settings_editor.png" style="max-width:400px;" title="The App Settings Editor" />
</figure>

<h2 id="ondevicewatchfaceanddatafieldsettingsconnectiq3.2">On Device Watch Face and Data Field Settings (Connect IQ 3.2)</h2>

<p>Device applications, widgets, and audio content providers all accept user input that allow them to implement on-device settings in the app. Watch faces and data fields are not allowed to accept input or push views that would allow on device configuration.</p>

<p>If you want to provide an on-device settings user interface for your watch face or data field, you can implement <code>getSettingsView()</code> in your <code>AppBase</code>. <code>getSettingsView()</code> functions similarly to <code>getInitialView()</code> where you return a <code>View</code> and <code>InputDelegate</code> pair that can serve as the initial view.</p>

<p>Watch Face configuration is available to the user in the system Watch Face menu.</p>

<h1 id="intentsconnectiq2.2">Intents (Connect IQ 2.2)</h1>

<p>Intents allow a Connect IQ watch-app or widget to launch another Connect IQ watch-app, Connect IQ widget, or native application (e.g. built in activities like Run, Bike, etc.) by calling <code>System.exitTo()</code>:</p>

<pre><code class="java">//! Exit the current app and launch a new app. This is an asynchronous request.
//! If the user chooses to launch the Intent then the app will be shut down. Otherwise
//! the app will continue to run. This can only be called by watch-apps and widgets.
//! @param [Intent] content The Intent to trigger
//! @raise [UnexpectedAppTypeException] If the app requested is not a watch-app or widget
//! @raise [AppNotInstalledException] If the application requested is not installed
//! @raise [PreviousOperationNotCompleteException] If exitTo is called a second time before completing
//! @since 2.2.0
native function exitTo(content);
</code></pre>

<p>Calling <code>System.exitTo()</code> will cause a confirmation view to be displayed asking the user whether to exit to the intended app. If the user chooses &#8216;No&#8217; then the app that called <code>System.exit()</code> will continue to run. If the user chooses &#8216;Yes&#8217; then the app will exit and the new app will launch. While the confirmation view is shown, originating app will continue to run.</p>

<h2 id="exitingtoconnectiqapps">Exiting to Connect IQ Apps</h2>

<p>In order to exit to another Connect IQ app, a <code>System.Intent</code> must be created, which contains a target app identifier and any arguments you wish to pass to the target app. The target app identifier must be specified using one of two supported URI schemes:</p>

<ul>
<li><code>manifest-id://</code> followed by a valid UUID from the app&#8217;s manifest.xml</li>
<li><code>store-id://</code> followed by a valid app store UUID</li>
</ul>

<p>Arguments are passsed to the target app as a dictionary, which may be empty or <code>null</code>, and are received by the target app&#8217;s <code>onStart()</code> method as a <code>Dictionary</code> object.</p>

<pre><code class="java">using Toybox.System as Sys;
...
var intent = new Sys.Intent(&quot;manifest-id://01234567-89AB-CDEF-0123-456789ABCDEF&quot;, {&quot;lat&quot;=&gt;38.856419, &quot;lon&quot;=&gt;-94.801369});
Sys.exitTo(intent);
</code></pre>

<p>Assuming the target app is installed on the device, this example launches the app with manifest ID &#8220;01234567&#8211;89AB-CDEF&#8211;0123&#8211;456789ABCDEF&#8221; and passes it the &#8220;lat&#8221; and &#8220;lon&#8221; arguments.</p>

<h2 id="exitingtonativeapps">Exiting to Native Apps</h2>

<p><code>Intents</code> to launch native apps deal exclusively with <code>PersistedContent</code> objects, such as Waypoints, Routes, and Tracks. Connect IQ handles most of the <code>Intent</code> functionality for native apps behind the scenes, automatically embedding the appropriate native app identifier in the <code>PersistedContent</code> object, which is accesible via the <code>toIntent()</code> method. See the <a href="#persistedcontent2.2">Persisted Content</a> section for more information.</p>

<h2 id="intentexceptions">Intent Exceptions</h2>

<p>Connect IQ includes three exception types related to <code>Intents</code>:</p>

<ul>
<li><code>System.UnexpectedAppTypeException</code> is thrown if your app tries to exit to a Connect IQ app type other than watch-app or widget</li>
<li><code>System.AppNotInstalledException</code> is thrown if your app tries to exit to an app that is not installed</li>
<li><code>System.PreviousOperationNotCompleteException</code> is thrown if <code>System.exitTo()</code> is called a while a confirmation view from a previous <code>System.exitTo()</code> call has not been acknowledged by the user</li>
</ul>

<h1 id="buildconfiguration">Build Configuration</h1>

<p>Connect IQ supports a wide variety of Garmin devices, like watches, bike computers, and handhelds. Even within these broader categories, devices can have different screen sizes, shapes, and resolutions. Application developers may wish to define specific resources, like fonts and bitmap graphics, for certain devices or device families for a better user experience. For example, an app may need to use a round background image for round devices, and a square background image for square devices.</p>

<p>Connect IQ offers a few ways to manage app resources: <a href="#devicefamilyandlocalizationqualifiers">device and family qualifiers</a>, <a href="#buildconfigurationviajungles">Jungles</a>, and <a href="#buildfileexclusions">build exclusions</a>.</p>

<h2 id="devicefamilyandlocalizationqualifiers">Device, Family, and Localization Qualifiers</h2>

<p>The simplest way to override resources is with device, family, and localization qualifiers, which are added to a resources folder by adding a hyphen (<code>-</code>) followed by a valid qualifier value. Let&#8217;s take a look at an example:</p>
<figure style="text-align:left;">
<img src="resources/programmers-guide/qualifier-project.png" style="max-width:190px;" title="A project structure using a device qualifier" />
<figcaption>Figure 1: A project that uses a f&emacr;nix 5 device resource qualifier</figcaption>
</figure>

<p>Resource qualifiers are applied to the base resources folder, and all resources found within that folder will inherit the qualifiers of the base folder. Resources with more specific qualifiers will always take precedence over less specific ones if they share a resource ID.</p>

<p>In Figure 1, the <code>resources-fenix5</code> directory uses a <code>-fenix5</code> qualifier to segregate resources specifically intended for the f&emacr;nix 5. When this project is built for f&emacr;nix 5, the layout and drawable in the <code>resources-fenix5</code> directory will be used to display a different background image than the one in the more generic <code>resources</code> directory. All other supported products will compile with the default resources.</p>

<p><strong>Note:</strong> Multiple qualifiers separated by hyphens may be used on a single folder, but device qualifiers are not allowed to co-exist with family qualifiers in the same folder name (e.g. <code>resources-round-fenix3</code>) and will be skipped by the resource compiler if encountered.</p>

<h3 id="devicequalifiers">Device Qualifiers</h3>

<p>The device qualifier format allows for resources to target specific devices (as demonstrated in Figure 1). Resources included in a folder with a device qualifier will override the resources with the same ID that are defined in the base resource folder when building for the associated device. Device qualifiers also take precedence over less specific qualifiers, such as family qualifiers.</p>

<h3 id="familyqualifiers">Family Qualifiers</h3>

<p>The family qualifier format allows for resources to target specific device families, which is a group of devices differentiated by shared screen characteristics. There are two family qualifiers:</p>

<ul>
<li><strong>Screen shape:</strong> The shape of the screen (e.g. <code>round</code>, <code>rectangle</code>, etc.)</li>
<li><strong>Screen size:</strong> The physical size of the screen in pixels ( e.g. <code>218x218</code>, <code>148x205</code>, etc.)</li>
</ul>

<p>The screen shape must always be specified when using a family qualifier, and the screen size may be added to further refine the target family. Here are some examples of valid and invalid family qualifier examples:</p>

<ul>
<li><code>resources-round</code>: <em>Valid</em>&mdash;targets round screen devices, like the f&emacr;nix 3 series and f&emacr;nix 5 series</li>
<li><code>resources-round-218x218</code>: <em>Valid</em>&mdash;targets 218px x 218px, round screen screen devices, like the f&emacr;nix 3 and f&emacr;nix 5S (but not the 5 or 5X since they have 240px x 240px screens)</li>
<li><code>resources-218x218</code>: <em>Invalid</em>&mdash;this will be ignored by the resource compiler because no screen shape has been specified</li>
<li><code>resources-218x218-round</code>: <em>Invalid</em>&mdash;the screen shape was not specified first</li>
</ul>

<p>Resources with more specific qualifiers will always take precedence over less specific ones, so on a round, 218px x 218px device, any resources contained in the <code>resources-round-218x218</code> resources folder will be used in place of those in <code>resources-round</code> if they share an ID. In addition any resource folder that carries a family qualifier will always defer to resource folders named with device qualifiers.</p>

<h3 id="localizationqualifiers">Localization Qualifiers</h3>

<p>Localization qualifiers are a way to specify language-specific string resources, and are specified as an <a href="https://www.loc.gov/standards/iso639-2/php/code_list.php">ISO 639–2 language code</a>. These qualifiers may be combined with either device or family qualifiers, and are always specified last in the qualifier naming scheme. For example:</p>

<ul>
<li><code>resources-fre</code>: Provides French language-specific string resources for all devices</li>
<li><code>resources-round-fre</code>: Provides French language-specific string resources for round devices only</li>
<li><code>resources-fenix5s-fre</code>: Provides French language-specific string resources for f&emacr;nix 5 devices only</li>
</ul>

<h2 id="buildconfigurationviajungles">Build Configuration via Jungles</h2>

<p>Connect IQ runs on a diverse set of purpose built devices. Because of the variety of inputs, screen shapes, and resources, it often is necessary to include code and resources tailored to specific conditions. For example, on a square device a progress bar may be rectangular, but on a round device it might look better as an arc that orbits the screen.</p>

<p>Jungles allow developers to write custom build configurations for Monkey C projects. With Jungles, developers may:</p>

<ul>
<li>Define per-device or per-device family paths to source and resource directories</li>
<li>Exclude portions of source code with annotations</li>
<li>Specify <a href="https://developer.garmin.com/connect-iq/core-topics/shareable-libraries/">Monkey Barrels</a> that should be included when a project is built.</li>
</ul>

<h3 id="configuringresourcepaths">Configuring Resource Paths</h3>

<p>Lets say you are writing a wearable app that has different resources for round, semi-round, and rectangle layouts. Jungles make it easy to manage project build configurations in one place:</p>

<pre><code># Configure paths based on screen shape
round.resourcePath = $(base.resourcePath);resource-round
semiround.resourcePath = $(base.resourcePath);resource-semiround
rectangle.resourcePath = $(base.resourcePath);resource-rectangle
</code></pre>

<p>These instructions tell round devices to use the <code>resource-round</code>, <code>resource-semiround</code>, and <code>resource-rectangle</code> paths for the round, semi-round, and rectangle the devices respectively.</p>

<h3 id="feelingexcluded">Feeling Excluded</h3>

<p>Now, let&#8217;s say that we have some code in our application that should only be run on round products, and all the non-round products should use the &#8220;regular&#8221; version:</p>

<pre><code class="typescript">(:roundVersion)
function drawThis(dc) {
    // Implementation
}

(:regularVersion)
function drawThis(dc) {

}
</code></pre>

<p>We don&#8217;t want to include both versions in any executable because one version would just be dead code. Jungles allow us to specify this using exclusions.</p>

<pre><code class="bash"># Say that all products exclude declarations
# with the annotation :roundVersion
base.excludeAnnotations = roundVersion
# Now say that the round products exclude
# the regular version
round.excludeAnnotations = regularVersion
</code></pre>

<p>When building the app for a product, round products will exclude the version of <code>drawThis</code> with the <code>:regularVersion</code> annotation, and the rest of the products will exclude the version of <code>drawThis</code> with the <code>:roundVersion</code> annotation.</p>

<h2 id="buildfileexclusions">Build File Exclusions</h2>

<p>The resource compiler also supports excluding files, directories or annotations as part of the build process using the <code>&lt;build&gt;</code> tag in an application&#8217;s resources XML files:</p>

<pre><code class="xml">&lt;build&gt;
  &lt;exclude file=&quot;filename.mc&quot;/&gt;
  &lt;exclude dir=&quot;source-excluded&quot; /&gt;
  &lt;exclude annotation=&quot;roundImpl&quot;/&gt;
&lt;/build&gt;
</code></pre>

<p>The <code>&lt;build&gt;</code> tag can be defined in the resource directory of any device or family-based qualifier. Only the single most detailed and relevant <code>&lt;build&gt;</code> resource defined will be used when compiling an application. This feature is useful when adding specific files or features for one device or device family and not another, saving memory that would otherwise be wasted for non-shareable code.</p>

<p>Build exclusions provide a lot of the same capabilities as Jungle files, and will eventually be removed in a future Connect IQ release. If used in combination with a Jungle file, build exclusions will continue to work, but a warning will be generated indicating that they have been deprecated.</p>

<h1 id="security">Security</h1>

<p>At Garmin we are focused on the security of our devices and services. The security model in Connect IQ is designed to give the developer and the user the tools to know that their device and their information is safe with Garmin.</p>

<p>Connect IQ has three levels of trust for apps:</p>

<ul>
<li><strong>Trusted</strong> - Content that has been approved by the app store. These apps have passed the Garmin review process and can be downloaded from the Connect IQ store.</li>
<li><strong>Developer</strong> - Content that has been written by an individual developer, but has not been released in the Connect IQ store. This content can be used for testing, but is not an officially released app.</li>
<li><strong>Untrusted</strong> - Content that should not be run on device.</li>
</ul>

<p>These levels of trust are enforced using digital signatures. Key management has been worked into the app store, the device, and the developer SDK. The goal is to make sure that apps loaded from developers only come from two locations - the app store or a trusted developer.</p>

<h2 id="developerkeys">Developer Keys</h2>

<p>The Connect IQ compiler requires a developer key be provided to for signing when compiling and packaging apps. The required key must be a RSA 4096 bit private key.</p>

<p><strong>Note</strong>: It&#8217;s important you keep track of the key you use to sign app packages. You will need to use the same key to sign updates to an existing app on the store. If you lose your original signing key you will not be able to update your app.</p>

<h2 id="generatingakeyusingopenssl">Generating a Key Using OpenSSL</h2>

<p>If you&#8217;re working from the command line you can generate a RSA key using <a href="https://www.openssl.org/">OpenSSL</a>. The following command will generate a valid signing key.</p>

<pre><code class="bash">&gt; openssl genrsa -out developer_key.pem 4096
&gt; openssl pkcs8 -topk8 -inform PEM -outform DER -in developer_key.pem -out developer_key.der -nocrypt
</code></pre>

<p>This developer key, <code>developer_key.der</code>, is passed to the compiler using the <code>-y</code> command line option.</p>

<h2 id="generatingakeyusingtheeclipseplug-in">Generating a Key Using the Eclipse Plug-in</h2>

<p>If you&#8217;re using the Eclipse Plug-in there is a key generation utility built in. The tool can be accessed through the compiler preferences page (<em>Preferences &gt; Connect IQ &gt; Compiler</em>). Clicking the <em>Generate</em> button will open the wizard. Set the output path in the wizard and click <em>Finish</em>.</p>
<figure>
<img src="resources/programmers-guide/generate_key_wizard.png" style="max-width:814px;" title="The key generation wizard" />
</figure>

<p>The developer key specified in the Connect IQ compiler preferences will automatically be passed to the compiler when a project is compiled.</p>

<h2 id="runningondevice">Running on Device</h2>

<p>Apps must be signed to run on a Garmin device, and unsigned apps will be deleted by the device. The Monkey C tool will automatically sign your app based on your key. Your apps will run at the Developer privilege level. Apps signed by the app store run at the Trusted privilege level. The content of their object store will be encrypted and unreadable from the Connect IQ developer tools.</p>

<p>The app store requires IQ files to be digitally signed. Your upload will be rejected If the developer key has changed since your last upload.</p>

<h1 id="viewsdrawablesandlayers">Views, Drawables and Layers</h1>
<figure>
<img src="resources/programmers-guide/artsy-monkey.png" style="max-width:300px;" title="We're going to put a happy semicolon over here. Happy semicolon..." />
</figure>

<p>The Connect IQ SDK makes it easier to port the user interface to different products. At the resource compiler level, we include a way to define a page in XML as well as specify page definitions per product. These tools make it easy to support multiple devices with a single app.</p>

<h2 id="views">Views</h2>

<p>Watch faces and apps have a page stack. A <code>View</code> is an object that represents a page. Views can be pushed onto and popped off of the page stack, or a view can replace another view on the page stack with a transition.</p>

<p>A subclass of <code>View</code> usually implements the following functions:</p>

<ul>
<li><code>onShow()</code>: Called when your <code>View</code> is first made visible. A good time to do on demand initialization of resources and timers.</li>
<li><code>onLayout(dc)</code>: In this function you can load a layout defined in the [Layouts][../layouts.html] section.</li>
<li><code>onUpdate(dc)</code>: Called when your view needs to update the display. The default version of this function will draw the layout elements, but you call <code>View.onUpdate(dc)</code> to have the system draw the layout and then run your own custom drawing.</li>
<li><code>onHide()</code>: Called when your View is being removed from the view stack.</li>
</ul>

<h2 id="drawables">Drawables</h2>

<p>Each <code>View</code> contains a layout. A layout is an array of drawable objects, called <code>Drawables</code>, where each <code>Drawable</code> is positioned in the <code>View</code>. A <code>Drawable</code> can draw itself to a device context through the <code>draw(dc)</code> method.</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/layout.png" style="max-width:534px;" alt="An illustration of Layouts, Views, and Drawables" title="An illustration of Layouts, Views, and Drawables" />
<figcaption>An illustration of Layouts, Views, and Drawables</figcaption>
</figure>
</div>

<p>Any object that extends <code>Drawable</code> is a drawable object, expose their properties publicly. (This will become useful when we discuss the animation system.) Monkey C provides the basic drawables <code>Text</code> and <code>Bitmap</code>, allowing text and bitmap resources to be included in layouts.</p>

<h2 id="layersconnectiq3.1">Layers (Connect IQ 3.1)</h2>

<p>Connect IQ 3.1 introduces a new concept, layers, to the <code>WatchUi.View</code>.
 Layers are used to fuse multiple levels of drawable content belong to the same view.
 Once added to a view, layers are rendered on the screen automatically in the order they
 are added. Layers are conceptually closer to the <code>Graphics.BufferedBitmap</code> than a
 <code>WatchUi.Drawable</code>, and come with a similar runtime memory cost.</p>

<p>The following is a code snippet about how to use the <code>Layer</code> system</p>

<pre><code class="java">class MyLayerView extends WatchUi.View {

    function initialize() {
        // create a 240x240 layer, at [0,0] offset from the top-left corner of the screen
        var backgroundLayer = new WatchUi.Layer({:x=&gt;0, :y=&gt;0, width=&gt;240, height=&gt;240});

        // draw something on the layer
        backgroundLayer.getDc().drawBitmap( ... );
        backgroundLayer.getDc().drawPolyline( ... );

        // add layer to View as background
        addLayer(backgroundLayer);

        // create another 20x20 layer and add it to the view as foreground layer
        var foregroundLayer = new WatchUi.Layer({:x=&gt;10, :y=&gt;10, width=&gt;20, height=&gt;20});
        addLayer(foregroundLayer);

        // draw something on the foreground layer
        foregroundLayer.getDc().drawText( ... );
    }
}
</code></pre>

<h3 id="animationlayer">AnimationLayer</h3>

<p>Layers are useful for fusing animations with your <code>WatchUi.View</code> content.
 The <code>WatchUi.AnimationLayer</code> is a special layer that allows integration of
 <a href="#animations">AnimationResource</a> and your <code>View</code>. Using layers,
 you can overlay animations over your <code>View</code>, or overlay static content over
 playing animations. See the &#8216;AnimationWatchFace&#8217; sample to learn more.</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/layers.png" style="max-width:800px;" alt="glance page" />
<figcaption>Animation WatchFace With 3 Layers</figcaption>
</figure>
</div>

<p>The above screenshot illustrates a 3-layer WatchFace from the &#8216;AnimationWatchFace&#8217; sample app.</p>

<p>See <a href="https://developer.garmin.com/connect-iq/api-docs/Toybox/WatchUi/View.html">View Documentation</a>, <a href="https://developer.garmin.com/connect-iq/api-docs/Toybox/WatchUi/Layer.html">Layer Documentation</a>, <a href="https://developer.garmin.com/connect-iq/api-docs/Toybox/WatchUi/AnimationLayer.html">AnimationLayer Documentation</a> for more details.</p>

<h1 id="layouts">Layouts</h1>

<p>The resource compiler allows page layouts to be customized to a particular device without changing any Monkey C code. In addition, <code>DrawableList</code> objects can also be defined, which are <code>Drawable</code> objects that can draw a number of graphics primitives.</p>

<p>When defining a layout in XML, simply list the drawable objects to include in your layout inside a set of layout tags. Each drawable listed will be turned into Monkey C <code>Drawable</code> objects and drawn one after the other. Because of this, if two drawables in your layout overlap each other the drawable that is defined second will draw on top of the drawable that is defined first. Here is an example of a basic layout:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;layout id=&quot;MainLayout&quot;&gt;
        &lt;drawable id=&quot;MainBackground&quot; /&gt;
        &lt;label text=&quot;Page Heading&quot; x=&quot;10&quot; y=&quot;25&quot; font=&quot;Gfx.FONT_LARGE&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
        &lt;label text=&quot;Your information goes here.&quot; x=&quot;50%&quot; y=&quot;50%&quot; font=&quot;Gfx.FONT_MEDIUM&quot; color=&quot;Gfx.COLOR_DK_GRAY&quot; /&gt;
    &lt;/layout&gt;
&lt;/resources&gt;
</code></pre>

<p>To use this layout in your code simply call <code>setLayout()</code> inside the <code>onLayout(dc)</code> function. Call the View&#8217;s <code>onUpdate(dc)</code> if you plan on using the <code>onUpdate(dc)</code> function to update dynamic values on the screen. For example:</p>

<pre><code class="java">class MainView {
    function onLayout( dc ) {
        setLayout( Rez.Layouts.MainLayout( dc ) );
    }

    function onUpdate( dc ) {
        // Call parent's onUpdate(dc) to redraw the layout
        View.onUpdate( dc );

        // Include anything that needs to be updated here
    }
}
</code></pre>

<h2 id="layout">Layout</h2>

<p>The following attributes are supported by the <code>layout</code> tag:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the layout. This is used to reference the layout in the Rez module</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<h2 id="label">Label</h2>

<p>Text can be included in layouts. To include text use the <code>label</code> tag, which supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the label. The ID provided here references the label defined in the resource XML file</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>text</code></td>
	<td style="text-align:left;">The text to be displayed</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">An empty string</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>font</code></td>
	<td style="text-align:left;">The font to be used when drawing the text</td>
	<td style="text-align:left;"><code>Graphics</code> font constant or the ID of a user-defined font</td>
	<td style="text-align:left;"><code>Graphics.FONT_MEDIUM</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the point that the text will be justified against</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>left</code>, <code>right</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the point that the text will be justified against</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>top</code>, <code>bottom</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>justification</code></td>
	<td style="text-align:left;">How the text should be justified in relation to the X &amp; Y location</td>
	<td style="text-align:left;"><code>Graphics</code> text justify constant</td>
	<td style="text-align:left;"><code>Graphics.TEXT_JUSTIFY_LEFT</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>color</code></td>
	<td style="text-align:left;">The color of the text</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Graphics.COLOR_WHITE</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>background</code></td>
	<td style="text-align:left;">The background color of the text</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Gfx.COLOR_TRANSPARENT</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<h2 id="textareaconnectiq3.1">Text Area (Connect IQ 3.1)</h2>

<p>Text may also be included in a layout as a text area. A text area is similar to a text label, except it will attempt to fit text into the provided area by selecting an appropriate font, adding line breaks, or applying truncation. To include a text area, use a <code>text-area</code> element. The following attributes are permitted:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the text area. The ID provided here references the text area defined in the resource XML file</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>text</code></td>
	<td style="text-align:left;">The text to be displayed</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">An empty string</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>font</code></td>
	<td style="text-align:left;">The font to be used when drawing the text</td>
	<td style="text-align:left;"><code>Graphics</code> font constant or the ID of a user-defined font</td>
	<td style="text-align:left;"><code>Graphics.FONT_MEDIUM</code></td>
	<td style="text-align:left;">Cannot be used if a font sequence is provided</td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the point that the text will be justified against</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>left</code>, <code>right</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the point that the text will be justified against</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>top</code>, <code>bottom</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>width</code></td>
	<td style="text-align:left;">The width of the area to fit the text into</td>
	<td style="text-align:left;">pixel value, a relative dimension using &#8216;%&#8217;, or <code>fill</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>height</code></td>
	<td style="text-align:left;">The height of the area to fit the text into</td>
	<td style="text-align:left;">pixel value, a relative dimension using &#8216;%&#8217;, or <code>fill</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>justification</code></td>
	<td style="text-align:left;">How the text should be justified in relation to the X &amp; Y location</td>
	<td style="text-align:left;"><code>Graphics</code> text justify constant</td>
	<td style="text-align:left;"><code>Graphics.TEXT_JUSTIFY_LEFT</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>color</code></td>
	<td style="text-align:left;">The color of the text</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Graphics.COLOR_WHITE</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>background</code></td>
	<td style="text-align:left;">The background color of the text</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Gfx.COLOR_TRANSPARENT</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p>A text area can select a font from a sequence to minimize truncation. The text area will try the fonts in the specified order until the text can be drawn in the given area without truncation. If no font is found that avoids truncation, the last font in the sequence will be used and the text will be truncated. Valid values for each font element are the same as that of the <code>font</code> attribute. An example <code>text-area</code> with a font sequence:</p>

<pre><code class="xml">&lt;text-area id=&quot;BlockOfText&quot; text=&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&quot; x=&quot;10%&quot; y=&quot;10%&quot; width=&quot;80%&quot; height=&quot;80%&quot;&gt;
    &lt;fonts&gt;
        &lt;font&gt;Gfx.FONT_MEDIUM&lt;/font&gt;
        &lt;font&gt;@Rez.Fonts.MySmallFont&lt;/font&gt;
        &lt;font&gt;Gfx.FONT_XTINY&lt;/font&gt;
    &lt;/fonts&gt;
&lt;/text-area&gt;
</code></pre>

<h2 id="drawables">Drawables</h2>

<p>Drawables (both bitmaps and drawable XML resources) can also be included in a layout using the <code>drawable</code> tag. The following attributes are supported by the <code>drawable</code> tag:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the drawable. The ID provided here references the drawable defined in the resource XML file</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required; the drawable must also be defined in a resource XML file</td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>left</code>, <code>right</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>top</code>, <code>bottom</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<h2 id="drawablelist">Drawable List</h2>

<p>Drawable XML resources consist of a list of basic drawables: bitmaps and shapes. To create an XML drawable, define a <code>&lt;drawable-list&gt;</code> in an XML resource file. Both <code>&lt;bitmap&gt;</code> and <code>&lt;shape&gt;</code> tags should be be placed as child nodes inside the <code>&lt;drawable-list&gt;</code>. An example drawable-list:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;drawable-list id=&quot;Smiley&quot; background=&quot;Gfx.COLOR_YELLOW&quot;&gt;
        &lt;shape type=&quot;circle&quot; x=&quot;10&quot; y=&quot;10&quot; radius=&quot;5&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
        &lt;shape type=&quot;circle&quot; x=&quot;30&quot; y=&quot;10&quot; radius=&quot;5&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
        &lt;bitmap id=&quot;mouth&quot; x=&quot;15&quot; y=&quot;25&quot; filename=&quot;../bitmaps/mouth.png&quot; /&gt;
    &lt;/drawable-list&gt;
&lt;/resources&gt;
</code></pre>

<p>To use this drawable in code do the following:</p>

<pre><code class="java">function onUpdate( dc ) {
    var mySmiley = new Rez.Drawables.Smiley();
    mySmiley.draw( dc );
}
</code></pre>

<p>The <code>&lt;drawable-list&gt;</code> tag supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the drawable</td>
	<td style="text-align:left;">Any string that starts with a character</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>left</code>, <code>right</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>top</code>, <code>bottom</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>width</code></td>
	<td style="text-align:left;">The width of the drawable list.</td>
	<td style="text-align:left;">pixel value, a relative dimension using &#8216;%&#8217;, or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>height</code></td>
	<td style="text-align:left;">The height of the drawable list.</td>
	<td style="text-align:left;">pixel value, a relative dimension using &#8216;%&#8217;, or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>foreground</code></td>
	<td style="text-align:left;">The color of elements (shapes and text) drawn in the drawable</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;">The current draw context&#8217;s foreground color</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>background</code></td>
	<td style="text-align:left;">The background color of the drawable</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Gfx.COLOR_TRANSPARENT</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<h2 id="shape">Shape</h2>

<p>The <code>&lt;shape&gt;</code> tag supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>type</code></td>
	<td style="text-align:left;">The type of the shape to be drawn</td>
	<td style="text-align:left;"><code>rectangle</code>, <code>ellipse</code>, <code>circle</code>, or <code>polygon</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">For circles and ellipses: X coordinate of the center of the shape in relation to the parent; for everything else: the X coordinate of the top left corner in relation to the parent element.</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>left</code>, <code>right</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">For circles and ellipses: Y coordinate of the center of the shape in relation to the parent; for everything else: the Y coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>top</code>, <code>bottom</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>points</code></td>
	<td style="text-align:left;">A list of points which defines the <code>polygon</code></td>
	<td style="text-align:left;"><code>[[x1, y1], [x2, y2], ... , [xN, yN]]</code>, points can be relative positions using &#8216;%&#8217;</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required for <code>polygon</code>; must have at least 3 points</td>
</tr>
<tr>
	<td style="text-align:center;"><code>width</code></td>
	<td style="text-align:left;">The width of the shape to be drawn</td>
	<td style="text-align:left;">pixel value, a relative dimension using &#8216;%&#8217;, or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;">Required for <code>rectangle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>height</code></td>
	<td style="text-align:left;">The height of the shape to be drawn</td>
	<td style="text-align:left;">pixel value, a relative dimension using &#8216;%&#8217;, or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;">Required for <code>rectangle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>a</code></td>
	<td style="text-align:left;">The a value of the ellipse to be drawn</td>
	<td style="text-align:left;">pixel value, a relative dimension using &#8216;%&#8217;, or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;">Required for <code>ellipse</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>b</code></td>
	<td style="text-align:left;">The b value of the ellipse to be drawn</td>
	<td style="text-align:left;">pixel value, a relative dimension using &#8216;%&#8217;, or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;">Required for <code>ellipse</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>color</code></td>
	<td style="text-align:left;">The color of the shape to be drawn</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;">The current draw context&#8217;s foreground color</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>corner_radius</code></td>
	<td style="text-align:left;">The radius of the rounded corners of the <code>rectangle</code></td>
	<td style="text-align:left;">pixel value</td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;">Only valid for <code>rectangle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>radius</code></td>
	<td style="text-align:left;">The radius of the <code>circle</code></td>
	<td style="text-align:left;">pixel value or a relative dimension using &#8216;%&#8217;</td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;">Required for <code>circle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>border_width</code></td>
	<td style="text-align:left;">The width of the border around the shape</td>
	<td style="text-align:left;">pixel value</td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;">Only valid for <code>rectangle</code>, <code>ellipse</code>, and <code>circle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>border_color</code></td>
	<td style="text-align:left;">The color of the border around the shape</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;">The current draw context&#8217;s foreground color</td>
	<td style="text-align:left;">Only valid for <code>rectangle</code>, <code>ellipse</code>, and <code>circle</code></td>
</tr>
</tbody>
</table>

<h2 id="bitmap">Bitmap</h2>

<p>The <code>&lt;bitmap&gt;</code> tag supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the drawable</td>
	<td style="text-align:left;">Any string that starts with a character</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>left</code>, <code>right</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>top</code>, <code>bottom</code>, or <code>start</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>filename</code></td>
	<td style="text-align:left;">The relative path to the image that should be shown</td>
	<td style="text-align:left;">A valid, relative path</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<h2 id="customdrawables">Custom Drawables</h2>

<p>In some cases it is useful to have a drawable entry within a layout point to a custom defined class which extends <code>Toybox.WatchUi.Drawable</code>, or any of its directly known subclasses. This is possible by using the <code>class</code> attribute of the <code>&lt;drawable&gt;</code> tag.</p>

<pre><code class="xml">&lt;layout&gt;
    &lt;drawable id=&quot;MoveBar&quot; class=&quot;CustomMoveBar&quot; /&gt;
&lt;/layout&gt;
</code></pre>

<p>The drawable entry above will add a new instance of the <code>CustomMoveBar</code> class to the layout. You can then define how the <code>CustomMoveBar</code> is drawn by overriding the <code>draw(dc)</code> function.</p>

<pre><code class="java">using Toybox.WatchUi as Ui;

class CustomMoveBar extends Ui.Drawable {
    function draw(dc) {
        // Draw the move bar here
    }
}
</code></pre>

<h3 id="passingparameterstocustomdrawables">Passing Parameters to Custom Drawables</h3>

<p>If may be useful to pass values into a custom Drawable. To do this you define <code>&lt;param&gt;</code> children within the <code>&lt;drawable&gt;</code> tag. The <code>&lt;param&gt;</code> tag should define the name of the parameter using the <code>name</code> attribute and the value as it&#8217;s content. The content value is passed as is to the custom Drawable. This means if you want to pass a string you must wrap the content in quotes.</p>

<pre><code class="xml">&lt;layout&gt;
    &lt;drawable id=&quot;MoveBar&quot; class=&quot;CustomMoveBar&quot;&gt;
        &lt;param name=&quot;color&quot;&gt;Gfx.COLOR_RED&lt;/param&gt;
        &lt;param name=&quot;string&quot;&gt;&quot;Hello Custom Drawable!&quot;&lt;/param&gt;
    &lt;/drawable&gt;
&lt;/layout&gt;
</code></pre>

<p>The parameters defined in XML are passed to the custom Drawable&#8217;s initialize function as a dictionary. The names are passed as symbols and the values are passed as they appear in the XML.</p>

<pre><code class="java">using Toybox.WatchUi as Ui;

class CustomMoveBar extends Ui.Drawable {

    hidden var mColor, mString;

    function initialize(params) {
        // You should always call the parent's initializer and
        // in this case you should pass the params along as size
        // and location values may be defined.
        Drawable.initialize(params);

        // Get any extra values you wish to use out of the params Dictionary
        mColor = params.get(:color);
        mString = params.get(:string);
    }
}
</code></pre>

<h1 id="graphics">Graphics</h1>

<p>The graphics module handles drawing bitmaps, fonts, and shapes to the device screen.</p>

<h2 id="drawingcontext">Drawing Context</h2>

<p>The Dc object is used to draw to a graphics surface. The primary device surface is provided to the View object methods <code>onLayout()</code>, <code>onUpdate()</code>, and <code>onPartialUpdate()</code>. The size of the surface can be queried with the <code>getWidth()</code> and <code>getHeight()</code> methods.</p>

<p>There are several methods in the Dc object that are used to draw to the surface, including methods to draw primative shapes, <code>drawBitmap()</code> to render bitmaps, and <code>drawText()</code> to draw strings using a specified font. The drawing pen width can be set with the setPenWidth() method. The <code>clear()</code> method will set all active (unclipped) pixels on the surface to the background color.</p>

<p>The <code>setColor()</code> method allows you to set the foreground and background drawing colors. Colors are passed to setColor as 24-bit colors of the form 0xRRGGBB. When setting a color, the device will select the closest available color on the system. To see what colors are available on devices, see the User Experience Guide, which is also available in the ConnectIQ SDK.</p>

<pre><code class="typescript">module Graphics
{
    class Dc
    {
        //! Erase the screen using the background color by calling clear().
        //! @since 1.0.0
        function clear();

        //! Use drawCircle() to draw a circle around a point.
        //! @param [Number] x X location of circle center
        //! @param [Number] y Y location of circle center
        //! @param [Number] radius Radius of circle
        //! @since 1.0.0
        function drawCircle(x, y, radius);

        //! Use drawEllispe() to draw an ellipse around a point.
        //! @param [Number] x X location of ellipse center
        //! @param [Number] y Y location of ellipse center
        //! @param [Number] a The radius of the ellipse along the x axis
        //! @param [Number] b The radius of the ellipse along the y axis
        //! @since 1.0.0
        function drawEllipse(x, y, a, b);

        //! Draw a point on the screen with drawPoint().
        //! @param [Number] x X location of point
        //! @param [Number] y Y location of point
        //! @since 1.0.0
        function drawPoint(x, y);

        //! Draw a rectangle with drawRectangle().
        //! @param [Number] x X location of upper corner
        //! @param [Number] y Y location of upper corner
        //! @param [Number] width Width value of rectangle
        //! @param [Number] height Height value of rectangle
        //! @since 1.0.0
        function drawRectangle(x, y, width, height);

        //! Draw a rounded rectangle with drawRoundedRectangle().
        //! @param [Number] x X location of upper corner
        //! @param [Number] y Y location of upper corner
        //! @param [Number] width Width value of rectangle
        //! @param [Number] height Height value of rectangle
        //! @param [Number] radius Radius of rounding.
        //! @since 1.0.0
        function drawRoundedRectangle(x, y, width, height, radius);

        //! Draw a bitmap to the screen with drawBitmap().
        //! @param [Number] x Top left X coordinate to begin the draw
        //! @param [Number] y Top left Y coordinate to begin the draw
        //! @param [Object] bitmap The WatchUi.BitmapResource or Graphics.BufferedBitmap to render.
        //!                 The source color palette must be a subset of the destination color palette.
        //! @raise InvalidPaletteException Thrown if the source color palette is not a subset of the destination palette
        //! @since 1.0.0
        function drawBitmap(x, y, rez);

        //! Draw a line between two points using drawLine().
        //! @param [Number] x1 First x coord
        //! @param [Number] y1 First y coord
        //! @param [Number] x2 Second x coord
        //! @param [Number] y2 Second y coord
        //! @since 1.0.0
        function drawLine(x1, y1, x2, y2);

        //! Fill a circle with the foreground color using fillCircle().
        //! @param [Number] x X location of circle center
        //! @param [Number] y Y location of circle center
        //! @param [Number] radius Radius of circle
        //! @since 1.0.0
        function fillCircle(x, y, radius);

        //! Fill an ellipse with the foreground color using fillEllipse().
        //! @param [Number] x X location of ellipse center
        //! @param [Number] y Y location of ellipse center
        //! @param [Number] a The radius of the ellipse along the x axis
        //! @param [Number] b The radius of the ellipse along the y axis
        //! @since 1.0.0
        function fillEllipse(x, y, a, b);

        //! To fill a polygon, use fillPolygon().
        //! @param [Array] pts Array of coordinates with a 64 point limit
        //! @since 1.0.0
        function fillPolygon(pts);

        //! Fill a rectangle with the foreground color using fillRectangle().
        //! @param [Number] x X location of upper corner
        //! @param [Number] y Y location of upper corner
        //! @param [Number] width Width value of rectangle
        //! @param [Number] height Height value of rectangle
        //! @since 1.0.0
        function fillRectangle(x, y, width, height);

        //! Fill a rounded rectangle with the foreground color using fillRoundedRectangle().
        //! @param [Number] x X location of upper corner
        //! @param [Number] y Y location of upper corner
        //! @param [Number] width Width value of rectangle
        //! @param [Number] height Height value of rectangle
        //! @param [Number] radius Radius of rounding
        //! @since 1.0.0
        function fillRoundedRectangle(x, y, width, height, radius);

        //! Use setColor() to set the current foreground and background colors.
        //! @param [Number] foreground Graphics.COLOR_* constant or 24-bit integer of the form 0xRRGGBB
        //! @param [Number] background Graphics.COLOR_* constant or 24-bit integer of the form 0xRRGGBB
        //! @since 1.0.0
        function setColor(foreground, background);

        //! Use setPenWidth() to set the width of a line
        //! @param [Number] width in pixels
        //! @since 1.0.0
        function setPenWidth(width);

        //! Use drawArc() to draw an arc.
        //! 0 degree: 3 o'clock position.
        //! 90 degrees: 12 o'clock position.
        //! 180 degrees: 9 o'clock position.
        //! 270 degrees: 6 o'clock position.
        //! @param [Number] x X location of arc center
        //! @param [Number] y Y location of arc center
        //! @param [Number] r radius of arc.
        //! @param [Number] attr Arc drawing attributes. (ARC_COUNTER_CLOCKWISE or ARC_CLOCKWISE)
        //! @param [Number] degreeStart The start angle of the arc by degrees.
        //! @param [Number] degreeEnd The end angle of the arc by degrees.
        //! @since 1.2.0
        function drawArc(x, y, r, attr, degreeStart, degreeEnd);
    }
}
</code></pre>

<h2 id="clippingconnectiq2.3">Clipping (Connect IQ 2.3)</h2>

<p>A clipping region can be set for a <code>Dc</code> object using the <code>setClip()</code> method. The top left corner coordinates, width, and height are specified to set this region. All pixels outside of this region will be unaffected by any drawing operations. The pixels within the region will be updated normally. The <code>clearClip()</code> method will remove the clipping region.</p>

<h2 id="stringsandfonts">Strings and Fonts</h2>

<p>Text can be drawn to the <code>Dc</code> object using the <code>drawText()</code> method. The Dc object also has methods available to get the text width and height of a string with a specified font. Note that text size methods are also available in the Graphics module outside the <code>Dc</code> object.</p>

<pre><code class="typescript">module Graphics
{
    class Dc
    {
        //! Draw text at the given location using drawText().
        //! This method is not supported for anti-aliased fonts (includes most built in
        //! fonts) for BufferedBitmaps that have a palette.
        //! @param [Number] x X location of text
        //! @param [Number] y Y location of text
        //! @param [FontResource] font Font to use. This can be a custom font loaded from resources or a Graphics.FONT_* value.
        //! @param [String] text String to render. This can be a string loaded from resources or a hard coded string.
        //! @param justification One of the Graphics.TEXT_JUSTIFY_XXX constants
        //! @raise InvalidPaletteException Thrown if an anti-aliased font is used on a paletted bitmap.
        //! @since 1.0.0
        function drawText(x, y, font, text, justification);

        //! Get the width and height of a string. This takes new lines into account when
        //! determining the height. The width is the maximum width for a given line of the string.
        //! If a string has two \n in it, the height would be for three lines and the width would be the
        //! width of the longest string.
        //! @param [String] text Text to get width for
        //! @param [FontResource] font Graphics.FONT_* constant or font resource of the text to be measured
        //! @return [Array] [width, height] of string in pixels
        //! @since 1.0.0
        function getTextDimensions(text, font);

        //! Get the width of a string with getTextWidthInPixels().
        //! @param [String] text Text to get width for
        //! @param [FontResource] font Graphics.FONT_* constant or font resource of the text to be measured
        //! @return [Number] Width of string in pixels
        //! @since 1.0.0
        function getTextWidthInPixels(text, font);

        //! Get The Font Height by using getFontHeight().
        //! @param [FontResource] font The font to measure
        //! @return [Number] The height of the font
        //! @since 1.0.0
        function getFontHeight(font);
    }

    //! Gets the recommended distance above the baseline for single
    //! spaced text. The base line is the line on which the text sits.
    //! @param [Number] font Font to use
    //! @return [Number] The ascent of the font
    //! @since 1.2.0
    function getFontAscent(font);

    //! Gets the recommended distance below the baseline for single
    //! spaced text. The base line is the line on which the text sits.
    //! @param [Number] font Font to use
    //! @return [Number] The descent of the font
    //! @since 1.2.0
    function getFontDescent(font);

    //! Gets the height (ascent plus descent) of the given font.
    //! @param [Number] font Font to use
    //! @return [Number] The height of the font
    //! @since 1.2.0
    function getFontHeight(font);
}
</code></pre>

<h2 id="bufferedbitmapsconnectiq2.3">Buffered Bitmaps (Connect IQ 2.3)</h2>

<p>The <code>BufferedBitmap</code> class can be used to draw to surface other than the primary display surface. There are two options for creating a <code>BufferedBitmap</code> object. The first is to generate one from a loaded bitmap resource. In this case, the provided bitmap is used as the drawing surface that is manipulated. The second option is to specify the width, and height of the surface, and optionally a color palette. If no color palette is specified, the <code>BufferedBitmap</code> will use the system colors, and will not have a palette. If a bitmap resource is provided to the initializer, the width, height, and palette parameters are ignored.</p>

<pre><code class="typescript">module Graphics
{
    //! This class represents a offscreen bitmap. It provides methods to
    //! modify the bitmap palette, and get a drawable context.
    //! @since 2.3.0
    class BufferedBitmap {
        //! @param [Dictionary] options Dictionary of options. Must contain width and height, with optional palette,
        //!                     or a Bitmap Resource. This resorurce is not allowed to have an alpha channel.
        //! @option options [Number] :width The width of the surface in pixels
        //! @option options [Number] :height The height of the surface in pixels
        //! @option options [Array] :palette The colors used in this surface. Using less will reduce the bitmap size.
        //!                                  The bitmap will use the system default if not provided. The maximum palette
        //!                                  size allowed is 256 colors. If a palette is provided, the number of colors
        //!                                  must also be &lt;= to the number of system colors.
        //! @option options [BitmapResource] :bitmapResource A bitmap resource to initialize
        //! @raise InvalidPaletteException Thrown if the palette size exceeds the number of system colors.
        //! @raise InvalidPaletteException Thrown if the palette size exceeds 256 colors.
        //! @raise InvalidBitmapResourceException Thrown if the bitmap resource provided has an alpha channel.
        //! @since 2.3.0
        function initialize(options);
    }
}
</code></pre>

<p>If a <code>BufferedBitmap</code> does have a palette, it can be read using the <code>getPalette()</code> method. The palette can also be modified using the <code>setPalette()</code> method. The palette provided must have the same number of colors as the existing palette for that bitmap. All pixels in the image will change color to the new color assigned at each color index. Note that Bitmaps with a palette that are generated by the resource compiler will have an additional transparent index at the end of the specified palette unless the disableTransparency flag has been specified.</p>

<pre><code class="typescript">module Graphics
{
    //! This class represents a offscreen bitmap. It provides methods to
    //! modify the bitmap palette, and get a drawable context.
    //! @since 2.3.0
    class BufferedBitmap {
        //! @return [Array] The current palette for this bitmap. null if this surface uses the system palette
        //! @since 2.3.0
        function getPalette();

        //! @param [Array] A new palette for this bitmap. The number of colors must match the current palette.
        //!                Each color in the image will be replaced with the colors specified in the new palette.
        //! @raise InvalidPaletteException Thrown if the palette size does not match the current palette.
        //! @since 2.3.0
        function setPalette(palette);
    }
}
</code></pre>

<p>A Drawing Context can be obtained from the <code>BufferedBitmap</code> using the <code>getDc()</code> method. This returns a <code>Dc</code> class that has the same capabilities as the primary device <code>Dc</code> that is provided to the methods <code>onLayout()</code>, <code>onUpdate()</code> and <code>onPartialUpdate()</code>. This object can be used to modify the contents of the <code>BufferedBitmap</code> by drawing shapes, text, and bitmaps to it.</p>

<pre><code class="typescript">module Graphics
{
    //! This class represents a offscreen bitmap. It provides methods to
    //! modify the bitmap palette, and get a drawable context.
    //! @since 2.3.0
    class BufferedBitmap {
        //! Get the DC to draw on the buffered bitmap
        //! @return [Graphics.Dc] Draw context
        //! @since 2.3.0
        function getDc();
    }
}
</code></pre>

<h2 id="anti-aliasingconnectiq3.2">Anti-Aliasing (Connect IQ 3.2)</h2>

<p>By default, anti-aliasing of primitives like polygons and lines are disabled, but it can be enabled by calling <code>setAntiAliasing(true)</code>. This method is not available in pre-Connect IQ 3.2 products so if your app runs with the API level set below 3.2 make sure to guard it with a <code>has</code> check.</p>

<pre><code class="typescript">function draw(dc) {
    if(dc has :setAntiAlias) {
        dc.setAntiAlias(true);
    }
    dc.drawPolygon()
}
</code></pre>

<h1 id="inputhandling">Input Handling</h1>

<p>As if input handling wasn&#8217;t already one of the most important and complicated pieces of a UI toolkit, Garmin devices take the complication up a level. Unlike those touchable glowing rectangles that are modern smart phones, Garmin devices come in lots of shapes and sizes. Touch screens are not always ideal for all watch products, so there is a mix of input styles and screen technologies. It&#8217;s the job of the UI toolkit to make this coherent to the developer.</p>

<h2 id="inputandapptypes">Input and App Types</h2>

<p>Not all app types have access to input. Watch faces and data fields cannot handle input, though widgets can receive input (may be limited on some devices) and watch-apps will have the most input capability.</p>

<h2 id="inputdelegates">Input Delegates</h2>

<p>The delegate object implements a certain interface specific to input handling. Monkey C provides a low level <code>InputDelegate</code> that allows handling of events at a basic level. This is good when the app needs to handle button presses or screen presses in a particular way.</p>

<pre><code class="java">module WatchUi
{
    // This class implements basic input handling. A developer needs to override
    // the events they want to handle.
    class InputDelegate
    {
        // Key event
        // @param evt KEY_XXX enum value
        // @return true if handled, false otherwise
        function onKey( evt );

        // Click event
        // @param evt Event object with click information
        // @return true if handled, false otherwise
        function onTap( evt );

        // Screen hold event. Sent if user is touching
        // the screen
        // @param evt Event object with hold information
        // @return true if handled, false otherwise
        function onHold( evt );

        // Screen release. Sent after an onHold
        // @param evt Event object with hold information
        // @return true if handled, false otherwise
        function onRelease( evt );

        // Screen swipe event
        // @param evt Event
        function onSwipe( evt );
    }
}
</code></pre>

<h2 id="behaviors">Behaviors</h2>

<p>Garmin makes products with a purpose, and that purpose can alter the design of one product line over another. Deciding whether a product has a touch screen or has buttons can depend on the environment in which the user will take. For instance, if the product is intended to be used in water (swimming, canoeing, on a boat), it may not have a touch screen. These decisions make for superior products, but also add to developer frustration due to device fragmentation.</p>

<p>Most products will support common behaviors (next page, back a page), but how they are executed by the user may differ based on the available input types. To help with this dilemma, Monkey C exposes events at a behavior level. Behaviors separate high-level intentions from the actual input type&mdash;next page versus screen press. The <code>BehaviorDelegate</code> is a super class of <code>InputDelegate</code> and maps its low level inputs to common operations across multiple products. Using the <code>BehaviorDelegate</code> can lead to much more portable code.</p>

<pre><code class="java">// BehaviorDelegate handles behavior inputs. A BehaviorDelegate differs from
// an InputDelegate in that it acts upon device independent behaviours such as
// next page and previous page. On touch screen devices these behaviors might be
// mapped to the basic swipe left and right inputs, while on non-touch screen
// devices these behaviors might be mapped to actual keys.
// BehaviorDelegate extends InputDelegate so it can also act on basic inputs as
// well. If a BehaviorDelegate does return true for a function, indicating that
// the input was used, then the InputDelegate function that corresponds to the
// behavior will be called.
// @see InputDelegate
class BehaviorDelegate extends InputDelegate
{
    // When a next page behavior occurs, onNextPage() is called.
    // @return [Boolean] true if handled, false otherwise
    function onNextPage();

    // When a previous page behavior occurs, onPreviousPage() is called.
    // @return [Boolean] true if handled, false otherwise
    function onPreviousPage();

    // When a menu behavior occurs, onMenu() is called.
    // @return [Boolean] true if handled, false otherwise
    function onMenu();

    // When a back behavior occurs, onBack() is called.
    // @return [Boolean] true if handled, false otherwise
    function onBack();

    // When a next mode behavior occurs, onNextMode() is called.
    // @return [Boolean] true if handled, false otherwise
    function onNextMode();

    // When a previous mode behavior occurs, onPreviousMode() is called.
    // @return [Boolean] true if handled, false otherwise
    function onPreviousMode();
}
</code></pre>

<h2 id="selectablesandbuttonsconnectiq2.1">Selectables and Buttons (Connect IQ 2.1)</h2>

<h3 id="selectables">Selectables</h3>

<p>Monkey C provides an interface for products with large touch screens (and few buttons) to easily define touchable objects on-screen known as a <code>WatchUi.Selectable</code>:</p>

<pre><code class="java">//! Selectable is the class representation of an on-screen
//! selectable object with defined states depending on selection mode
//! @see Drawable
//! @since 2.1.0
class Selectable extends Toybox.WatchUi.Drawable
{
    //! Default state Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB
    //! @return [Object]
    //! @since 2.1.0
    (:property) var stateDefault;

    //! Highlighted state Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB
    //! @return [Object]
    //! @since 2.1.0
    (:property) var stateHighlighted;

    //! Selected state Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB
    //! @return [Object]
    //! @since 2.1.0
    (:property) var stateSelected;

    //! Disabled state Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB
    //! @return [Object]
    //! @since 2.1.0
    (:property) var stateDisabled;

    //! Constructor
    //! @param [Dictionary] options Parameters to specify in Selectable creation
    //! @option options [Number] :locX @see Drawable#initialize. Required.
    //! @option options [Number] :locY @see Drawable#initialize. Required.
    //! @option options [Number] :width @see Drawable#initialize. Required.
    //! @option options [Number] :height @see Drawable#initialize. Required.
    //! @option options [Object] :stateDefault Drawable to display in default state. Optional.
    //! @option options [Object] :stateHighlighted Drawable to display in disable state. Optional.
    //! @option options [Object] :stateSelected Drawable to display in highlight state. Optional.
    //! @option options [Object] :stateDisabled Drawable to display in selected state. Optional.
    //! @since 2.1.0
    function initialize(options);

    //! Get the current state.
    //! @return [Symbol] The current state (:stateDefault, :stateHighlighted, etc).
    //! @since 2.1.0
    function getState();

    //! Set the current state.
    //! @param [Symbol] state The desired state (:stateDefault, :stateHighlighted, etc) to make current.
    //! @since 2.1.0
    function setState(state);

    //! Draw the object to the display context with draw(). Assume that the
    //! device context has already been configured to the proper settings.
    //! @param [Graphics.Dc] dc The device context
    //! @since 2.1.0
    function draw(dc);
}

//! SelectableEvent is an object sent to InputDelegate when the user
//! manipulates a Selectable using hard-keys or the touchscreen.
//! @since 2.1.0
class SelectableEvent
{
    //! Constructor
    //! @param [Selectable] instance The Selectable that generated the event
    //! @param [Symbol] previousState The previous Selectable state (stateDefault, stateHighlighted, etc)
    //! @since 2.1.0
    function initialize(instance, previousState);

    //! Get the previous state of the Selectable that generated the event.
    //! @return [Symbol] The previous Selectable state (stateDefault, stateHighlighted, etc)
    //! @since 2.1.0
    function getPreviousState();

    //! Get the instance of the manipulated Selectable.
    //! @return The Reference to the Selectable manipulated
    //! @since 2.1.0
    function getInstance();
}

//! InputDelegate handles basic input events. There are three types of basic
//! inputs: key, touch, and swipe.
//! @since 1.0.0
class InputDelegate
{
    //! When the state of a Selectable changes, onSelectable() is called. The instance of the
    //! associated Selectable is passed so that its current state may be determined.
    //! @param [Selectable] instance The Selectable that generated the event
    //! @param [Symbol] previousState The previous Selectable state (stateDefault, stateHighlighted, etc)
    //! @return [Boolean] true if handled, false otherwise
    //! @since 2.1.0
    function onSelectable(instance, previousState);
}
</code></pre>

<p>A <code>Selectable</code> is a state driven object that supports four optional built-in states which are set based on touch interaction:</p>

<ul>
<li>Default (:stateDefault) - Initial state</li>
<li>Highlighted (:stateHighlighted) - Selectable is currently being pressed</li>
<li>Selected (:stateSelected) - Selectable was pressed and released (i.e. tapped)</li>
<li>Disabled (:stateDisabled) - Selectable has been disabled</li>
</ul>

<p>Once a state change occurs, a <code>SelectableEvent</code> is sent which results in a call to <code>WatchUi.InputDelegate.onSelectable()</code>, which passes both the instance of the current Selectable and the symbol of the previous state for comparison, and allows for custom actions as a result of the state change. Selectables <em>must</em> be registered as part of the View&#8217;s layout via the <code>WatchUi.View.setLayout()</code> call in order to for the View to know about them and direct touch events to the object. Stacked instances of Selectables will have input directed to them depending on their order as passed to <code>setLayout()</code> (last in, first drawn / selected).</p>

<p>A new method for the <code>View</code> class is defined to enable compatiblity mode with button-only products:</p>

<pre><code class="java">//! Set the state of the keys to Selectable interaction mode. In this mode the
//! keys are used to cycle through the on screen Selectable objects. The first
//! registered Selectable in the current layout will be highlighted.
//! @param [Boolean] enabled If the mode should be enabled
//! @since 2.1.0
function setKeyToSelectableInteraction(enabled);
</code></pre>

<p>The above routine may be called to enable the up/down keys to cycle through the list of Selectables registered via the View&#8217;s <code>setLayout()</code> call, which sets the highlighted state on a <code>Selectable</code> until it is put in the Selected state via the enter key.</p>

<p>Each of the four states must be mapped to a <code>Drawable</code>, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB. States are optionally defined and be specified in the <code>Selectable</code> constructor, or manually modified as members of the instance. Each <code>Selectable</code> will draw the current state using the defined <code>locX</code> and <code>locY</code> coordinates as an offset if it has been defined. Extending <code>Selectable</code> with additional states is encouraged and the <code>getState()</code> and <code>setState()</code> routines may used to alter the default state machine (see Selectable sample application for a demonstration of check boxes).</p>

<h3 id="buttons">Buttons</h3>

<p>A <code>WatchUi.Button</code> is derived from <code>Selectable</code> and adds the ability to define a background and map interaction to an existing or new custom method (i.e. <code>onMenu()</code>) within <code>WatchUi.BehaviorDelegate</code>.</p>

<h3 id="definingselectablesandbuttonsinlayouts">Defining Selectables And Buttons In Layouts</h3>

<p>Much like their parent <code>Drawable</code>, Selectables and Buttons both support the layout system. Selectable and Button XML resources consist of a list of state ID&#8217;s and optional parameters. To create an XML Selectable, define a <code>&lt;selectable&gt;</code> in an XML resource file:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the Selectable</td>
	<td style="text-align:left;">Any string that starts with a character</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the top left corner of the Selectable region</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>left</code>, <code>right</code>, or <code>start</code></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the top left corner of the Selectable region</td>
	<td style="text-align:left;">pixel value, a relative position using &#8216;%&#8217;, <code>center</code>, <code>top</code>, <code>bottom</code>, or <code>start</code></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>width</code></td>
	<td style="text-align:left;">The width of the Selectable region</td>
	<td style="text-align:left;">pixel value or a relative dimension using &#8216;%&#8217; or <code>fill</code></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>height</code></td>
	<td style="text-align:left;">The height of the Selectable region</td>
	<td style="text-align:left;">pixel value or a relative dimension using &#8216;%&#8217; or <code>fill</code></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<p>The <code>&lt;button&gt;</code> resource expands the definition of <code>&lt;selectable&gt;</code> and adds the following:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>behavior</code></td>
	<td style="text-align:left;">A method existing within a View&#8217;s registered BehaviorDelegate</td>
	<td style="text-align:left;">Method symbol</td>
	<td style="text-align:left;"><code>null</code></td>
	<td style="text-align:left;">Optional / Param</td>
</tr>
<tr>
	<td style="text-align:center;"><code>background</code></td>
	<td style="text-align:left;">The background color of the Button</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Gfx.COLOR_TRANSPARENT</code></td>
	<td style="text-align:left;">Optional / Param</td>
</tr>
</tbody>
</table>

<p>Both <code>&lt;selectable&gt;</code> and <code>&lt;button&gt;</code> tags use <code>&lt;state&gt;</code> as child nodes to define their states at construction. Each state is defined optionally but is defined as the following:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The state ID for the Button / Selectable</td>
	<td style="text-align:left;"><code>stateDefault</code>, <code>stateHighlighted</code>, <code>stateSelected</code>, or <code>stateDisabled</code></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>bitmap</code></td>
	<td style="text-align:left;">A bitmap resource in the layout drawn at the Selectable / Button origin</td>
	<td style="text-align:left;">WatchUi.Bitmap objects</td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required or <code>color</code> must be specified</td>
</tr>
<tr>
	<td style="text-align:center;"><code>color</code></td>
	<td style="text-align:left;">A color fill applied to the Selectable / Button region</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Gfx.COLOR_TRANSPARENT</code></td>
	<td style="text-align:left;">Required or <code>bitmap</code> must be specified</td>
</tr>
</tbody>
</table>

<p>An example layout containing two a menu and back button:</p>

<pre><code class="xml">&lt;layout id=&quot;ButtonLayout&quot;&gt;
    &lt;button x=&quot;40&quot; y=&quot;center&quot; width=&quot;50&quot; height=&quot;50&quot; background=&quot;Gfx.COLOR_BLACK&quot; behavior=&quot;onBack&quot;&gt;
        &lt;state id=&quot;stateDefault&quot; bitmap=&quot;@Drawables.DefaultBackButton&quot; /&gt;
        &lt;state id=&quot;stateHighlighted&quot; bitmap=&quot;@Drawables.PressedBackButton&quot; /&gt;
        &lt;state id=&quot;stateSelected&quot; bitmap=&quot;@Drawables.PressedBackButton&quot; /&gt;
        &lt;state id=&quot;stateDisabled&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
    &lt;/button&gt;
    &lt;button x=&quot;115&quot; y=&quot;center&quot; width=&quot;50&quot; height=&quot;50&quot;&gt;
        &lt;state id=&quot;stateDefault&quot; bitmap=&quot;@Drawables.DefaultMenuButton&quot; /&gt;
        &lt;state id=&quot;stateHighlighted&quot; bitmap=&quot;@Drawables.PressedMenuButton&quot; /&gt;
        &lt;state id=&quot;stateSelected&quot; bitmap=&quot;@Drawables.PressedMenuButton&quot; /&gt;
        &lt;state id=&quot;stateDisabled&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
        &lt;param name=&quot;background&quot;&gt;Gfx.COLOR_BLACK&lt;/param&gt;
        &lt;param name=&quot;behavior&quot;&gt;onMenu&lt;/param&gt;
    &lt;/button&gt;
&lt;/layout&gt;
</code></pre>

<h1 id="nativeuicontrols">Native UI Controls</h1>

<p>In general, complicated input from users and feedback to users should not be done on a wearable device, but should instead be done via a phone app or web page. However, sometimes the device needs to get some form of user input or provide confirmation to the user.</p>

<p><code>WatchUi</code> provides a number of native widgets to handle input:
* Menus
* Generic Picker
* Confirmation Dialog
* Progress Bar
* Map Views
* Data Field Alerts</p>

<p>Two additional handlers provided by <code>WatchUi</code> can be used to give feedback to the user: the confirmation dialog and progress dialog.</p>

<h2 id="menu">Menu</h2>

<p>A menu is a list of options for the user. The options are displayed in a list that matches the device the app is running on. A menu can be defined in the resource XML file using the following format:</p>

<pre><code class="xml">&lt;menu id=&quot;MainMenu&quot;&gt;
    &lt;menu-item id=&quot;item_1&quot; label=&quot;@Strings.menu_item_1_label&quot; /&gt;
    &lt;menu-item id=&quot;item_1&quot; label=&quot;@Strings.menu_item_2_label&quot; /&gt;
&lt;/menu&gt;
</code></pre>

<p>The resource compiler will then take this XML and generate a <code>Menu</code> object in the <code>Rez</code> module. In order to use this menu, a developer simply needs to push the menu and a delegate for the menu using <code>WatchUi.pushView()</code>:</p>

<pre><code class="java">class MyClass extends Ui.View {
    function openTheMenu() {
        Ui.pushView( new Rez.Menus.MainMenu(), new MyMenuDelegate(), Ui.SLIDE_UP );
    }
}

class MyMenuDelegate extends Ui.MenuInputDelegate {
    function onMenuItem(item) {
        if ( item == :item_1 ) {
            // Do something here
        } else if ( item == :item_2 ) {
            // Do something else here
        }
    }
}
</code></pre>

<h2 id="menu2connectiq3.0">Menu2 (Connect IQ 3.0)</h2>

<p>Connect IQ 3.0 includes the <code>Menu2</code> system which allows for more complex menu user interfaces. The <code>Menu2</code> class includes new capabilities like graphical titles<a href="#fn:3" id="fnref:3" title="see footnote" class="footnote">[3]</a>, menu items that can be updated dynamically, and additional menu elements such as check boxes. The Menu2 system includes multiple new classes. Let&#8217;s start with the most simple of the new menu elements.</p>

<p>Here is a basic implementation of a Menu2 using a simple <code>MenuItem</code>:</p>

<pre><code class="c++">using Toybox.WatchUi;

class MyBehaviorDelegate extends WatchUi.BehaviorDelegate {
    function initialize() {
        BehaviorDelegate.initialize();
    }

    function onMenu() {
        var menu = new WatchUi.Menu2({:title=&gt;&quot;My Menu2&quot;});
        var delegate;

        // Add a new MenuItem to the Menu2 object
        menu.addItem(
            new MenuItem(

                // Set the 'Label' parameter
                &quot;Item 1 Label&quot;,

                // Set the `subLabel` parameter
                &quot;Item 1 subLabel&quot;,

                // Set the `identifier` parameter
                &quot;itemOneId&quot;,
                // Set the options, in this case `null`
                {}
            )
        );

        menu.addItem(
            new MenuItem(
                &quot;Item 2 Label&quot;,
                &quot;Item 2 subLabel&quot;,
                &quot;itemTwoId&quot;,
                {}
            )
        );

        // Create a new Menu2InputDelegate
        delegate = new MyMenu2Delegate(); // a WatchUi.Menu2InputDelegate

        // Push the Menu2 View set up in the initializer
        WatchUi.pushView(menu, delegate, WatchUi.SLIDE_IMMEDIATE);
        return true;
    }
}
</code></pre>

<p>While the <code>Menu</code> example is built using the resource system, the <code>Menu2</code> example above is built programatically. Let&#8217;s take a look at some of the new features demonstrated:</p>

<dl>
<dt>new WatchUi.Menu2</dt>
<dd>The <code>Menu2</code> class is a special <code>View</code> that is similar to <code>Menu</code> that presents the user with a list of options.</dd>

<dt>MenuItem</dt>
<dd>The MenuItem object constructor takes four parameters: <code>label, subLabel, identifier, options</code>. Each <code>MenuItem</code> can display a label and sub-label defined by the first two parameters. Here is a diagram that demonstrates the layout of the label and sub-label in <code>MenuItem</code>:</dd>
</dl>
<div class="center">
<figure>
<img src="resources/programmers-guide/Menu2_labels.png" style="max-width:800px;" alt="Illustration of label and sub-labels in Menu2" />
<figcaption>An Illustration of label and sub-labels in <code>Menu2</code></figcaption>
</figure>
</div>

<p>The <code>MenuItem</code> <code>identifier</code> is typically a string and is simply an identifier for the <code>MenuItem</code> object. There is a fourth parameter which is a <code>Dictionary</code> of options which can be <code>null</code>.</p>

<dl>
<dt>WatchUi.Menu2InputDelegate</dt>
<dd>The new <code>Menu2InputDelegate</code> class is used to handle selected Menu2 items. This object handles these selections with three methods:</dd>
</dl>

<ul>
<li><code>onBack()</code> - Handles the back key and pops the current page off the stack if not overridden.</li>
<li><code>onDone()</code> - Used with a specialized <code>CheckboxMenu</code>. Pops the current page when not overridden.</li>
<li><code>onSelect()</code> - Handles when a Menu2 item is selected.</li>
</ul>

<h3 id="menu2xmlresources">Menu2 XML Resources</h3>

<p>A basic <code>MenuItem</code> can be defined in XML as a resource as follows:</p>

<pre><code class="XML">&lt;menu2 id=&quot;MainMenu&quot; title=&quot;@Strings.MainMenuTitle&quot;&gt;
  &lt;menu-item id=&quot;generic1&quot; label=&quot;Generic 1&quot; subLabel=&quot;With Sublabel&quot;&gt;&lt;/menu-item&gt;
  &lt;menu-item id=&quot;generic2&quot; label=&quot;Generic 2&quot;&gt;&lt;/menu-item&gt;
&lt;/menu2&gt;
</code></pre>

<p>The <code>MenuItem</code> identified as &#8220;generic1&#8221; uses both a label and sublabel. The &#8220;generic2&#8221; item uses only a label.</p>

<p>Here are the attributes and definitions of a <code>MenuItem</code> defined as an XML resource:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the <code>&lt;menu-item&gt;</code></td>
	<td style="text-align:left;">Any string that starts with a character</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>label</code></td>
	<td style="text-align:left;">The label text to be displayed</td>
	<td style="text-align:left;">A valid string resource or <code>String</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>subLabel</code></td>
	<td style="text-align:left;">The sub-label text to be displayed</td>
	<td style="text-align:left;">A valid string resource or <code>String</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p>The most exciting part about Menu2 is the use of icons, check boxes and toggles within menus. All Menu2 items can be created and launched in the same way, but each new menu item behaves uniquely. We&#8217;ve already seen the basic <code>MenuItem</code> class. Lets talk about some of the specifics when using the others.</p>

<h3 id="iconmenuitem">Icon Menu Item</h3>

<p>The <code>IconMenuItem</code> class allows developers to implement an icon based menu system. The <code>IconMenuItem</code> uses a label and sub-label, but also includes an icon that may be displayed to the right or left of the label and sub-label text.</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/IconFigure.png" style="max-width:800px;" alt="Illustration of a `IconMenuItem` in in Menu2" />
<figcaption>An illustration of an <code>IconMenuItem</code> in <code>Menu2</code></figcaption>
</figure>
</div>

<p>Here is an <code>IconMenuItem</code> created as an XML resourece:</p>

<pre><code class="XML">&lt;menu2 id=&quot;IconMenu&quot; title=&quot;@Strings.IconMenuTitle&quot;&gt;
    &lt;icon-menu-item id=&quot;defaultAlign&quot; label=&quot;@Strings.IconDefaultLabel&quot; subLabel=&quot;@Strings.IconDummySubLabel&quot;
     icon=&quot;@Drawables.LauncherIcon&quot; /&gt;
    &lt;icon-menu-item id=&quot;right&quot; label=&quot;@Strings.IconRightLabel&quot; subLabel=&quot;@Strings.IconDummySubLabel&quot;
     icon=&quot;@Drawables.LauncherIcon&quot;&gt;
        &lt;param name=&quot;alignment&quot;&gt;Ui.MenuItem.MENU_ITEM_LABEL_ALIGN_RIGHT&lt;/param&gt;
    &lt;/icon-menu-item&gt;
&lt;/menu2&gt;
</code></pre>

<p>Here are the attributes available for <code>&lt;icon-menu-item&gt;</code>:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the <code>&lt;icon-menu-item&gt;</code></td>
	<td style="text-align:left;">Any string that starts with a character</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>label</code></td>
	<td style="text-align:left;">The label text to be displayed</td>
	<td style="text-align:left;">A valid string resource or <code>String</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>subLabel</code></td>
	<td style="text-align:left;">The sub-label text to be displayed</td>
	<td style="text-align:left;">A valid string resource or <code>String</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>icon</code></td>
	<td style="text-align:left;">The icon to be displayed</td>
	<td style="text-align:left;">A valid drawable resource or custom drawable</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<h3 id="checkboxandtogglemenuitems">Checkbox and Toggle Menu Items</h3>

<p>The <code>CheckboxMenuItem</code> allows users to check multiple items in a list of menu items and save their state at one time (i.e. selecting play lists for music content). The <code>CheckboxMenuItem</code> class is used in combination with a class extending the <code>CheckboxMenu</code> View and a <code>Menu2InputDelegate</code>.</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/CheckboxFigure.png" style="max-width:800px;" alt="Illustration of a `CheckboxMenuItem` in in Menu2" />
<figcaption>An illustration of a <code>CheckboxMenuItem</code> in <code>Menu2</code></figcaption>
</figure>
</div>

<p>Developers define a <code>CheckboxMenuItem</code> using XML as follows:</p>

<pre><code class="XML">&lt;checkbox-menu id=&quot;CheckMenu&quot; title=&quot;@Strings.CheckMenuTitle&quot;&gt;
    &lt;checkbox-menu-item id=&quot;defaultAlign&quot; label=&quot;@Strings.CheckDefaultLabel&quot; subLabel=&quot;@Strings.CheckDefaultSubLabel&quot;
     checked=&quot;true&quot; /&gt;
    &lt;checkbox-menu-item id=&quot;right&quot; label=&quot;@Strings.CheckRightLabel&quot; subLabel=&quot;@Strings.CheckRightSubLabel&quot;
     checked=&quot;false&quot;&gt;
        &lt;param name=&quot;alignment&quot;&gt;Ui.MenuItem.MENU_ITEM_LABEL_ALIGN_RIGHT&lt;/param&gt;
    &lt;/checkbox-menu-item&gt;
&lt;/checkbox-menu&gt;
</code></pre>

<p>The <code>ToggleMenuItem</code> class is an element that indicates a menu item is in one of two states: <code>:enabled</code> or <code>:disabled</code>. See the change in the image below:</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/ToggleFigure.png" style="max-width:800px;" alt="Illustration of a `ToggleMenuItem` in in Menu2" />
<figcaption>An illustration of a <code>ToggleMenuItem</code> in <code>Menu2</code></figcaption>
</figure>
</div>

<p>You can create a <code>ToggleMenuItem</code> as a resource using XML:</p>

<pre><code class="XML">&lt;menu2 id=&quot;ToggleMenu&quot; title=&quot;@Strings.ToggleMenuTitle&quot;&gt;
    &lt;toggle-menu-item id=&quot;defaultAlign&quot; label=&quot;@Strings.ToggleLabel1&quot; subLabel=&quot;@Strings.ToggleOnSubLabel&quot;
     disabledSubLabel=&quot;@Strings.ToggleOffSubLabel&quot; checked=&quot;true&quot; /&gt;
    &lt;toggle-menu-item id=&quot;left&quot; label=&quot;@Strings.ToggleLabel2&quot; subLabel=&quot;@Strings.ToggleOnSubLabel&quot;
     disabledSubLabel=&quot;@Strings.ToggleOffSubLabel&quot; checked=&quot;false&quot;&gt;
        &lt;param name=&quot;alignment&quot;&gt;WatchUi.MenuItem.MENU_ITEM_LABEL_ALIGN_LEFT&lt;/param&gt;
    &lt;/toggle-menu-item&gt;
&lt;/menu2&gt;
</code></pre>

<p>The <code>&lt;checkbox-menu-item&gt;</code> and <code>&lt;toggle-menu-item&gt;</code> attributes are identical in name and function:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the <code>&lt;toggle-menu-item&gt;</code> or <code>&lt;checkbox-menu-item&gt;</code></td>
	<td style="text-align:left;">Any string that starts with a character</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>label</code></td>
	<td style="text-align:left;">The label text to be displayed</td>
	<td style="text-align:left;">A valid string resource or <code>String</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>subLabel</code></td>
	<td style="text-align:left;">The sub-label text to be displayed when <code>checked</code> is <code>true</code></td>
	<td style="text-align:left;">A valid string resource or <code>String</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>disabledSubLabel</code></td>
	<td style="text-align:left;">The sub-label text to be displayed when <code>checked</code> is <code>false</code></td>
	<td style="text-align:left;">A valid string resource or <code>String</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>checked</code></td>
	<td style="text-align:left;">The boolean state of the <code>&lt;toggle-menu-item&gt;</code> or <code>&lt;checkbox-menu-item&gt;</code></td>
	<td style="text-align:left;"><code>true</code> for <code>:enabled</code>, <code>false</code> for <code>disabled</code></td>
	<td style="text-align:left;"><code>false</code></td>
	<td style="text-align:left;">Value will switch even when not defined in XML</td>
</tr>
</tbody>
</table>

<p>The <code>checked</code> attribute is automatically created as part of a <code>ToggleItem</code> or <code>CheckboxItem</code> object and does not have to be defined in XML. If it is not defined in XML, then it will default to <code>false</code>.</p>

<p>For a <code>MenuItem</code> using graphical elements such as toggles and check boxes, developers can choose to align the elements to the left or right of the <code>MenuItem</code> label. If not defined, then elements will be aligned to the right as seen in the <code>defaultAlign</code> toggle menu above. A <code>&lt;param&gt;</code> tag with the desired <a href="https://developer.garmin.com/connect-iq/api-docs/Toybox/WatchUi/MenuItem.html"><code>MENU_ITEM_LABEL_ALIGN_*</code></a> value is used to set the alignment of icons, checks, and toggles. Developers can also explicitly align items to the right by using the <a href="https://developer.garmin.com/connect-iq/api-docs/Toybox/WatchUi/MenuItem.html"><code>MENU_ITEM_LABEL_ALIGN_RIGHT</code></a> value.</p>

<h2 id="genericpicker">Generic Picker</h2>

<p>The <code>Picker</code> class, along with the <code>PickerDelegate</code> and <code>PickerFactory</code> classes, provides applications with the ability to create on-screen lists of user-selectable objects. A picker consists of one or more choosable objects, a title, a next and previous arrow, and a confirm button. The next and previous arrows and the confirm button are device specific but can be overwritten if desired. Pickers are pushed using <code>WatchUi.pushView()</code>, providing a <code>PickerDelegate</code> for the input delegate. A <code>PickerFactory</code> is required to indicate what should be displayed for each pickable value.</p>

<p>Sample picker implementations can be found in the Picker sample project, inside the <code>samples/Picker</code> directory.</p>

<h3 id="userinterface">User Interface</h3>
<figure>
<img src="resources/programmers-guide/picker-layout.png" style="max-width:205px;" title="Main components of a generic picker layout" >
</figure>

<p>The above image is a representation of the general structure of what a picker should look like on a square screen. Other screen formats should have the same layout with some size differences to account for the screen and button layout.</p>

<ul>
<li>The top red bar represents where the title of the picker is displayed.</li>
<li>Up and down arrows to scroll through the available options are placed where the green boxes are.</li>
<li>The leftmost blue box is where the last item you selected is shown if the picker has multiple selectable items.</li>
<li>The center blue box is the item you are currently selecting.</li>
<li>The white box will either be the next selectable item in the list or the button to confirm your selection.</li>
</ul>

<h3 id="developmentinterface">Development Interface</h3>

<pre><code class="java">// A Picker uses a PickerFactory to decide what to display to the user. It is
// capable of displaying any number of entries for the user to choose from.
// For instance, if the PickerFactory was [new NumberFactory(), new Ui.Text({:text=&gt;&quot;-&quot;}), new NumberFactory()]
// then the Picker will have three entries: a choosable number, a non-choosable &quot;-&quot;, and another choosable number.
class Picker extends Toybox.WatchUi.View
{
    // Constructor
    // @param [Dictionary] options @see Picker#setOptions
    function initialize( options );

    // Set the options for the Picker.
    // @param [Dictionary] options the options for the Picker
    // @option options [Drawable] :title the title for the Picker. Required.
    // @option options [Array] :pattern an Array of [Object] for the Picker to display. If the Array entry is a PickerFactory then it is presented to the user to make a choice. If it is a Drawable then it is display only. Required.
    // @option options [Array] :defaults an Array of [Number] indicating the starting index for each entry in :pattern. Optional.
    // @option options [Drawable] :nextArrow a custom next icon for the Picker. Optional.
    // @option options [Drawable] :previousArrow a custom previous icon for the Picker. Optional.
    // @option options [Drawable] :confirm a custom confirm icon for the Picker. Optional.
    function setOptions( options );
}

// PickerDelegate responds to a confirm or cancel. The
// Picker does not automatically call popView.
// event from a [Picker].
class PickerDelegate
{
    // Handle a confirm event from a [Picker]
    // @param [Array] values The chosen values from the Picker. For [Drawable] entries, null will be returned for that value.
    function onAccept( values );

    // Handle a cancel event from a [Picker]
    function onCancel();
}

// A PickerFactory is used by a Picker to display Drawables to
// be chosen.
class PickerFactory
{
    // Generate a Drawable instance for a given item
    // @param [Number] item Item index
    // @param [Boolean] isSelected true if the current item is the selected item, false otherwise
    // @return [Drawable] object to be rendered
    function getDrawable( item, isSelected );

    // Return a representative value for this item
    // @param [Number] item Item index
    // @return [Object] Representative item for the given index
    function getValue( item );

    // Get the number of items in the factory
    // @return [Number] number of items in the factory
    function getSize();
}
</code></pre>

<h2 id="numberpicker-deprecated">Number Picker - <em>DEPRECATED</em></h2>

<p>To allow the user to pick or adjust numerical data, the number picker widget is your best bet. The number picker widget allows for editing or adjusting of common numerical types. Here&#8217;s an example of number picker use:</p>

<pre><code class="java">enum
{
    NUMBER_PICKER_DISTANCE,     // A Float in meters
    NUMBER_PICKER_TIME,         // A Duration
    NUMBER_PICKER_TIME_MIN_SEC, // A Duration
    NUMBER_PICKER_TIME_OF_DAY,  // A Duration representing the number of seconds since midnight
    NUMBER_PICKER_WEIGHT,       // A Float in kilograms
    NUMBER_PICKER_HEIGHT,       // A Float in meters
    NUMBER_PICKER_CALORIES,     // A Number
    NUMBER_PICKER_BIRTH_YEAR    // A Number
}

// This is the on-screen representation of number picker. The look-and-feel
// will be device specific. NumberPickers are pushed using WatchUi.pushView(),
// providing a NumberPickerDelegate for the input delegate. There are minimum
// and maximum values enforced by the product for each mode. The initial value
// will be modified to be within these bounds.
class NumberPicker
{
    // Constructor
    // @param mode An enum value of type NUMBER_PICKER_*
    // @param initialValue The initial value for the Number Picker, type
    //       depends on mode
    function initialize( mode, initialValue );
}

// NumberPickerDelegate responds to a number being chosen. This class should be
// extended to get the chosen number.
class NumberPickerDelegate
{
    // When a number is chosen, onNumberPicked() is called, passing the
    // chosen value.
    // @param value The chosen number, type depends on the NumberPicker mode
    function onNumberPicked( value );
}
</code></pre>

<h2 id="confirmationdialog">Confirmation Dialog</h2>

<p>The confirmation dialog provides a simple yes/no dialog. This is useful when presenting a simple selection.</p>

<pre><code class="java">enum
{
    CONFIRM_NO,
    CONFIRM_YES
}

// This is the on-screen representation of the confirmation dialog.
// The look-and-feel will be device specific. Confirmations
// are pushed using WatchUi.pushView(), providing a ConfirmationDelegate
// for the input delegate.
class Confirmation
{
    // Constructor
    // @param [String] message A textual confirmation message
    function initialize( message );
}

// ConfirmationDelegate handles a response being chosen in the Confirmation.
class ConfirmationDelegate
{
    // When a response is chosen, onResponse() is called, passing
    // the response of CONFIRM_NO or CONFIRM_YES
    // @param response The response of the confirmation of CONFIRM_NO or CONFIRM_YES
    function onResponse( response );
}
</code></pre>

<h2 id="progressbar">Progress Bar</h2>

<p>The progress dialog gives a standard wait dialog. It has two modes&mdash;one that shows the completion of some process, and a second that acts a wait timer displaying an indeterminate amount of progress. The look and feel of the progress bar will be device-specific.</p>

<pre><code class="java">// This is the on-screen representation of a progress bar.
// The look-and-feel will be device specific. ProgressBars are pushed
// using WatchUi.pushView(), providing either null or an input delegate.
// This can display a string and either a progress bar from 0-100%
// or a busy bar.
class ProgressBar
{
    // Constructor
    // @param [String] displayString The string to display on the progress bar view
    // @param [Float] startValue The initial value for the progress bar (0-100), null for &quot;busy&quot;
    function initialize( displayString, startValue );

    // Use setProgress() to set the value of the progress bar.
    // @param [Float] progressValue The value for the progress bar (0-100), null for &quot;busy&quot;
    function setProgress( progressValue );

    // Use setDisplayString() to set the string displayed on the progress bar view.
    // @param [String] displayString The string to display on the progress bar view
    function setDisplayString( displayString );
}
</code></pre>

<h2 id="datafield">Data Field</h2>

<p>On Devices with touch screen support, an input delegate can be used to accept input. Only the onTap() behavior is supported and will be triggered when the user touches a point inside the data field when it is active on the screen. The behavior delegate should be the second element of the array that is returned from getInitialView as with other app types.</p>

<pre><code class="java">// This data field accepts touch input
class DataFieldApp extends App.AppBase {
    // Data field view with associated behavior delegate
    function getInitialView() {
        return [ new DataFieldView(), new DataFieldDelegate() ];
    }
}

class DataFieldDelegate extends Ui.InputDelegate {
    // Handle touch events
    function onTap(evt) {
        // Process the touch event
    }
</code></pre>

<h2 id="mappingconnectiq3.0">Mapping (Connect IQ 3.0)</h2>

<p>Connect IQ 3.0 enables developers to embed map views into their apps on products with onboard cartography. Mapping is accessible in two ways: The <code>WatchUi.MapView</code> and the <code>WatchUi.MapTrackView</code>.</p>

<h3 id="mapview">MapView</h3>

<p>The <code>MapView</code> class is pushed like any other <code>View</code> class, but has some unique characteristics. Namely, <code>MapView</code> objects give you access to a rendering of a specified portion of the on-board map for a device. MapViews let you choose a portion of a map to focus on by using two points of the type <code>Toybox.Positon.Location</code>.</p>

<p>Here is the setup for a basic MapView:</p>

<pre><code class="C++">Using Toybox.WatchUi;
Using Toybox.Position;

class MyMapView extends MapView {

    // Initialize the MapView
    function initialize() {
        MapView.initialize();

        // Set the top left Location object for the Map Visible Area
        var top_left = new Position.Location({:latitude =&gt; 38.85695, :longitude =&gt;-94.80051, :format =&gt; :degrees});

        // Set the bottom right Location object for the Map Visible Area
        var bottom_right = new Position.Location({:latitude =&gt; 38.85391, :longitude =&gt;-94.7963, :format =&gt; :degrees});

        // Set the area of the map to be displayed
        MapView.setMapVisibleArea(top_left, bottom_right);

        // Set the area in which to display the selected map area
        MapView.setScreenVisibleArea(0, 0, 240, 240/2);

        // Set the map mode
        MapView.setMapMode(WatchUi.MAP_MODE_PREVIEW);
    }
}
</code></pre>

<p>Let&#8217;s dissect this a bit to learn about the view itself:</p>

<dl>
<dt>MapView.initialize()</dt>
<dd>It is recommended to set the parameters of your MapView in it&#8217;s <code>initialize()</code> function as shown here.</dd>

<dt>MapView.setMapVisibleArea()</dt>
<dd>This method takes <code>top_left</code> and <code>bottom_right</code> parameters as <code>Position.Location</code> objects. These two locations create a bounding box that defines the view area of the map which are the top-left and bottom-right most <code>Location</code> objects that must be displayed on the initial map render. Conceptually, this works itself out into a rectangular portion of a map that must be focused on for the initial render of the MapView.</dd>

<dt>MapView.setScreenVisibleArea()</dt>
<dd>MapViews allow developers to overlay UI items on top. Sometimes you want the entire screen to have the map image, but other times you&#8217;ll want to split the display between map and UI elements. If you want the map area to not be the center of the screen you can use this method to define the rectangular area. This method determines the rectangular area in which the area of the map defined in the <code>setMapVisibleArea()</code> call should be rendered. Here is a figure to help illustrate the relationship where the blue rectangles represent the map area and the red rectangles represent the screen area.</dd>
</dl>
<div class="center">
<figure>
<img src="resources/programmers-guide/MappingDiagram.png" style="max-width:800px;" alt="Illustration of relationship between Map Area and the Screen Area" />
<figcaption>An Illustration of relationship between Map Area and the Screen Area</figcaption>
</figure>
</div>

<dl>
<dt>MapView.setMapMode()</dt>
<dd>This call sets the map mode to one of the <code>MAP_MODE_*</code> enum values.</dd>
</dl>

<p>MapViews and MapTrackViews have two modes:</p>

<ul>
<li><strong>Preview:</strong> Selected with the <code>MAP_MODE_PREVIEW</code> enum value. This allows a non-movable map to be rendered on the screen.</li>
<li><strong>Browse:</strong> Selected with the <code>MAP_MODE_BROWSE</code> enum value. This mode allows the user to zoom, pan, and move the map using the system default controls.</li>
</ul>

<h3 id="maptrackview">MapTrackView</h3>

<p>The MapTrackView is similar to the MapView in all ways except for one. The MapTrackView will dynamically render the active location of the device on the screen.</p>

<h3 id="mappingartifacts">Mapping Artifacts</h3>

<p>Maps can add context with your content, but only if you can combine them together. Thankfully, not only can you access the maps native to devices, you can draw on them too! Monkey C has two new objects to interact with maps: <code>MapView.MapPolyline</code> and <code>MapView.MapMarker</code>.</p>

<h4 id="mappolyline">MapPolyline</h4>

<p>The <code>MapPolyline</code> object allows developers to draw a line with multiple points of location on a MapView rendering of a map. Only one <code>MapPolyline</code> object is allowed in a view.</p>

<p>Here is an example of a MapPolyline with four points:</p>

<pre><code class="c++">    // Initialize a new MapPolyline object
    var polyline = new WatchUi.MapPolyline();

    //Set the color of the MapPolyline
    polyline.setColor(Toybox.Graphics.COLOR_RED);

    // Set the pen width to draw the MapPolyline
    polyline.setWidth(2);

    // Set the Locations on the MapPolyline
    polyline.addLocation(
        new Position.Location({
            :latitude =&gt; 38.85391,
            :longitude =&gt;-94.79630,
            :format =&gt; :degrees
        })
    );
    polyline.addLocation(
        new Position.Location({
            :latitude =&gt; 38.85465,
            :longitude =&gt;-94.79922,
            :format =&gt; :degrees
        })
    );
    polyline.addLocation(
        new Position.Location({
            :latitude =&gt; 38.85508,
            :longitude =&gt;-94.79959,
            :format =&gt; :degrees
        })
    );
    polyline.addLocation(
        new Position.Location({
            :latitude =&gt; 38.85557,
            :longitude =&gt;-94.79864,
            :format =&gt; :degrees
        })
    );

    // Set the MapPolyline object to draw on the map
    MapView.setPolyline(polyline);
</code></pre>

<dl>
<dt>new WatchUi.MapPolyline</dt>
<dd>This creates a new instance of <code>MapPolyline</code> object.</dd>

<dt>setColor()</dt>
<dd>Sets the color of the <code>MapPolyline</code> with a <code>COLOR_*</code> enum value.</dd>

<dt>setWidth()</dt>
<dd>Sets the pen width used to draw the <code>MapPolyline</code> in pixels.</dd>

<dt>addLocation()</dt>
<dd>This method takes a <code>Position.Location</code> object and adds it to an <code>Array</code> of <code>MapPolyline</code> objects. These locations make up the points used to draw the lines that comprise the <code>MapPolyline</code> representation on the map.</dd>

<dt>MapView.SetPolyline()</dt>
<dd>This sets the MapPolyline object to be rendered on the map in the <code>MapView</code> or <code>MapTrackView</code>. In this example it is using the <code>MapPolyline</code> object stored as <code>polyline</code>.</dd>
</dl>

<h4 id="mapmarker">MapMarker</h4>

<p>The <code>MapMarker</code> object pairs a <code>Position.Location</code> object with a BitmapResource to create a marker to be draw on a map. Each Bitmap image used in a <code>MapMarker</code> object will have a &#8220;hotspot&#8221; for the image. The hotspot is the point of the image that will be drawn at the latitude and longitude for the provided <code>Location</code> for the <code>MapMarker</code>.</p>

<p>Here is a simple implementation of a <code>MapMarker</code> object:</p>

<pre><code class="c++">    // Initialize a map marker with a Location object
    var bitmapMarker = new WatchUi.MapMarker(
        new Position.Location({
            :latitude =&gt; 38.85391,
            :longitude =&gt;-94.79630,
            :format =&gt; :degrees
        })
    );
            bitmapMarker.setIcon(WatchUi.loadResource(Rez.Drawables.MapPin), 12, 24);
            bitmapMarker.setLabel(&quot;Custom Icon&quot;);

    var defaultMarker = new WatchUi.MapMarker(
        new Position.Location({
            :latitude =&gt; 38.85508,
            :longitude =&gt;-94.79959,
            :format =&gt; :degrees
        })
    );
            defaultMarker.setIcon(WatchUi.MAP_MARKER_ICON_PIN, 0, 0);
            defaultMarker.setLabel(&quot;Predefined Icon&quot;);

    // Set the Map Marker for the view
    MapView.setMapMarker(defaultMarker);
</code></pre>

<p>Let&#8217;s look at the code above to get a better handle on the APIs.</p>

<dl>
<dt>new WatchUi.MapMarker</dt>
<dd>The <code>MapMarker</code> object is initialized with the <code>Location</code> object passed to it. This is be the point at which the <code>MapMarker</code> hotspot of the Bitmap resource is be drawn.</dd>

<dt>bitmapMarker.setIcon(WatchUi.loadResource(Rez.Drawables.MapPin), 12, 24)</dt>
<dd>This call sets the icon of the <code>MapMarker</code> named <code>bitmapMarker</code> to the bitmap resource <code>Rez.Drawables.MapPin</code>. The hotspot is set to <code>12</code> for the <code>x</code> coordinate of the bitmap and <code>24</code> for the <code>y</code> coordinate of the <code>MapPin</code> icon.</dd>

<dt>setLabel()</dt>
<dd>Sets the label of the <code>MapMarker</code> icon to be displayed on the rendered map.</dd>

<dt>defaultMarker.setIcon(WatchUi.MAP_MARKER_ICON_PIN, 0, 0)</dt>
<dd>This <code>MapMarker</code> is using the <code>MAP_MARKER_ICON_PIN</code> enum value when setting the icon and use the system default icon for marking the point on the map. Note that the provided values for <code>x, y</code> for the hotspot are <code>0, 0</code> respectively. When using the default icon, the hotspot management is handled by the system.</dd>

<dt>setMapMarker()</dt>
<dd>The <code>setMapMarker()</code> method takes a <code>MapMarker</code> object and sets it on the map. In this example only the <code>defaultMarker</code> is set to be drawn on the map. However, it is acceptable to set multiple MapMarker objects by setting them in an <code>Array</code>. For example:</dd>
</dl>

<pre><code class="c++">// Create an Array to hold the MapMarker objects
var markers = [];

// Add the MapMarkers to the Array
markers.add(bitmapMarker);
markers.add(defaultMarker);

// Set multiple markers in an Array
MapView.setMapMarker(markers);

</code></pre>

<h3 id="simulatingmaps">Simulating Maps</h3>

<p>When working with maps in the simulator, Connect IQ uses web APIs to retrieve map images to simulate on-device behavior. Simulator and on-device mapping coverage with vary as on-device mapping is contingent on the device and maps available. Here is the detail coverage map for the simulator:</p>

<ul>
<li><strong>Green:</strong> Low detail</li>
<li><strong>Blue:</strong> Medium detail</li>
<li><strong>Red:</strong> High detail</li>
</ul>

<p><div class="center"></p>
<figure>
<img src="resources/programmers-guide/MapCoverage.png" style="max-width:534px;" alt="Detail map coverage guide for the Connect IQ Simulator" />
<figcaption>The detail map available on the Connect IQ Simulator</figcaption>
</figure>

<h2 id="alertsconnectiq3.2">Alerts (Connect IQ 3.2)</h2>

<p>When you want your data field to notify the user of a specific event, you can push a view that extends <code>WatchUi.DataFieldAlert</code>. <code>DataFieldAlert</code> is a special instance of <code>View</code> that can be presented to the user with <code>DataField.showAlert</code>. The alert does not accept input and will time out after the standard alert period.</p>

<p>The user is required to enable alerts for your app in the workout alert settings.</p>

<h1 id="resources">Resources</h1>
<figure>
<img src="resources/programmers-guide/sculptor-monkey.png" style="max-width:300px;" title="It is my finest work." />
</figure>

<p>The resource compiler compiles images, text, and static data into a resource database that the application can access at run time. The resource compiler is tied into the Monkey C compiler. Its input is an XML file:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;bitmap id=&quot;bitmap_id&quot; filename=&quot;path/for/image&quot; /&gt;
    &lt;font id=&quot;font_id&quot; filename=&quot;path/to/fnt&quot; /&gt;
    &lt;string id=&quot;string_id&quot;&gt;Hello World!&lt;/string&gt;
&lt;/resources&gt;
</code></pre>

<h2 id="theresourcemodulea.k.a.rez">The Resource Module (a.k.a. Rez)</h2>

<p>The resource compiler auto-generates a Monkey C module named <code>Rez</code> that contains the resource IDs for the resource file. These identifiers are used to refer to your resources:</p>

<pre><code class="java">module Rez
{
    module Drawables
    {
        const bitmap_id = 123;
    }
    module Strings
    {
       const hello_id = 456;
    }
    module Fonts
    {
       const font_id = 789;
    }
}
</code></pre>

<p>The code can use the <code>Rez</code> class to reference the resources at run time. For example, let&#8217;s say you have a bitmap you want to use in your view. Before it can be used by the app, it must be loaded from the resource file:</p>

<pre><code class="typescript">image = Graphics.loadResource( Rez.Drawables.id_monkey );
</code></pre>

<p>Now the bitmap can be drawn in the update handler:</p>

<pre><code class="typescript">dc.drawBitmap( 50, 50, image );
</code></pre>

<p>Resources are reference counted just like other Monkey C objects. Loading a resource can be an expensive operation, so do not load resources when handling screen updates.</p>

<h3 id="referencingresourceswithinresourcefiles">Referencing Resources Within Resource Files</h3>

<p>Resources can also be referenced from within another resource file. To do this use the syntax <code>@&lt;module&gt;.&lt;id&gt;</code>. For example, you could reference a String resource within a menu definition using the following code.</p>

<pre><code class="xml">&lt;string id=&quot;menu_item_1_label&quot;&gt;Item 1&lt;/string&gt;

&lt;menu id=&quot;MainMenu&quot;&gt;
    &lt;menu-item id=&quot;item_1&quot; label=&quot;@Strings.menu_item_1_label&quot; /&gt;
&lt;/menu&gt;
</code></pre>

<p>This code would use the string defined with an ID of <code>menu_item_1_label</code> as the label for the menu item.</p>

<h2 id="resourcescopesconnectiq3.1">Resource Scopes (Connect IQ 3.1)</h2>

<p>Adding resources to an app comes with a minor runtime memory cost. While the cost is small, it can seriously cut into the available memory for background services and glances. To mitigate these costs, Connect IQ 3.1 introduces an additional <code>scope</code> attribute to the following resource tags: <code>&lt;layout&gt;</code>, <code>&lt;drawable-list&gt;</code>, <code>&lt;bitmap&gt;</code>, <code>&lt;string&gt;</code>, <code>&lt;font&gt;</code>, <code>&lt;jsonData&gt;</code>. The <code>scope</code> attribute tells the resource compiler the type of application that the resource should be made available to. Valid values for the <code>scope</code> attribute are <code>background</code>, <code>glance</code>, and <code>foreground</code>. If the attribute is not specified for a resource, it will be considered part of the <code>foreground</code> scope by default. An example of using the <code>scope</code> attribute with string resources:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;string id=&quot;MyBackgroundString&quot; scope=&quot;background&quot;&gt;Background String&lt;/string&gt;
    &lt;string id=&quot;MyGlanceString&quot; scope=&quot;glance&quot;&gt;Glance String&lt;/string&gt;
    &lt;string id=&quot;MyForegroundString&quot; scope=&quot;foreground&quot;&gt;Foreground String&lt;/string&gt;
&lt;/resources&gt;
</code></pre>

<p>Use the <code>scope</code> attribute to save memory in your glance or background service. All background scoped resources will be available to the glance and foreground application. All glance scoped resources will be available to the foreground application, but not to the background service. Foreground scoped resources will only be available to the foreground application.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Application Mode</th>
	<th style="text-align:center;">MyBackgroundString</th>
	<th style="text-align:center;">MyGlanceString</th>
	<th style="text-align:center;">MyForegroundString</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;">Background Service</td>
	<td style="text-align:center;">X</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
</tr>
<tr>
	<td style="text-align:center;">Glance</td>
	<td style="text-align:center;">X</td>
	<td style="text-align:center;">X</td>
	<td style="text-align:center;"></td>
</tr>
<tr>
	<td style="text-align:center;">Foreground</td>
	<td style="text-align:center;">X</td>
	<td style="text-align:center;">X</td>
	<td style="text-align:center;">X</td>
</tr>
</tbody>
</table>

<p>In the example above, <code>MyBackgroundString</code> would be available when running the application in any valid mode. <code>MyGlanceString</code> would be available to the glance and foreground application, but not to the background service if present. <code>MyForegroundString</code> would only be available to the foreground application. By providing this hierarchy, developers can better determine how their resources should be scoped.</p>

<p>See <a href="#backgroundservicesconnectiq2.3">Background Services</a> or <a href="#glancesconnectiq3.1">Glances</a> for more information.</p>

<h2 id="bitmaps">Bitmaps</h2>

<p>Garmin devices have different form factors, screen sizes, and screen technologies, so bitmaps need to be explicitly converted for every device. The resource compiler will generate resources for every intended product, which allows the developer to have one set of resources for black and white products, one set for color products, one for larger screen sizes, etc. The resource compiler supports <code>JPG/JPEG</code>, <code>BMP/WBMP</code>, <code>GIF</code> and <code>PNG</code> file formats.</p>

<p>While each device has a unique palette, the developer can specify a palette to use for an image. The resource compiler will map the colors that are defined in the developer&#8217;s palette to the closest match in the device palette and use only those colors. A palette can be defined using the following syntax:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;bitmap id=&quot;bitmap_id&quot; filename=&quot;path/for/image&quot;&gt;
        &lt;palette disableTransparency=&quot;false&quot;&gt;
            &lt;color&gt;FF0000&lt;/color&gt;
            &lt;color&gt;FFFFFF&lt;/color&gt;
            &lt;color&gt;0000FF&lt;/color&gt;
        &lt;/palette&gt;
    &lt;/bitmap&gt;
&lt;/resources&gt;
</code></pre>

<p>The table below shows some of the valid attributes for a <code>&lt;bitmap&gt;</code> definition.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the layout, which is used to reference the layout in the Rez module</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>filename</code></td>
	<td style="text-align:left;">The relative path to the image file</td>
	<td style="text-align:left;">A valid, resolvable path to an image file</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>dithering</code></td>
	<td style="text-align:left;">The type of dithering to use when compiling the image</td>
	<td style="text-align:left;"><code>floyd_steinberg</code> or <code>none</code></td>
	<td style="text-align:left;"><code>floyd_steinberg</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>compress</code></td>
	<td style="text-align:left;">Indicate that the compiled bitmap should be compressed to reduce .PRG size</td>
	<td style="text-align:left;"><code>true</code> or <code>false</code></td>
	<td style="text-align:left;"><code>false</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>automaticPalette</code></td>
	<td style="text-align:left;">Automatically determine a reduced color palette to use while compiling the image. Images will be limited to 256 colors for 16-bit color devices.</td>
	<td style="text-align:left;"><code>true</code> or <code>false</code></td>
	<td style="text-align:left;"><code>true</code> for 16-bit color devices</td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p>The valid attributes for a <code>&lt;palette&gt;</code> definition are in the table below.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>disableTransparency</code></td>
	<td style="text-align:left;">Should the compiler allow transparent pixels in the image? Disabling transparency may save memory</td>
	<td style="text-align:left;"><code>true</code> or <code>false</code></td>
	<td style="text-align:left;"><code>false</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<h2 id="animationsconnectiq3.1">Animations (Connect IQ 3.1)</h2>

<p>Connect IQ 3.1 introduces a new animation framework. The Monkey Motion tool is a tool included in the Connect IQ SDK that can be used to generate animation resources for compatible Connect IQ products.</p>

<p>The Monkey Motion tool supports importing from <a href="https://github.com/cota/streamit-2.1.1/blob/master/apps/library_only/mpeg2/c/doc/mpeg2enc.doc"><code>YUV</code></a> and <code>GIF</code> file formats. Due the fact that <code>YUV</code> is a true color, close-to-raw file format, it is the recommended format when entering a high quality animation into the Monkey Motion encoder tool. If necessary, <a href="https://ffmpeg.org/">FFmpeg</a> is a convenient tool for converting video file formats. For example, if your creative team has provided a video in some other popular format, convert the file to the <code>YUV</code> format:</p>

<pre><code>&gt; ffmpeg -i input.mp4 -vf format=yuv420p output.y4m

</code></pre>

<p>Additionally, to overcome the fact that the <code>YUV</code> format does not support transparency (unlike the <code>GIF</code> file format), the Monkey Motion tool accepts an additional <code>YUV</code> file as input. This video file should represent an alpha channel mask of the original animation that contained transparency. Again, FFmpeg is a convenient tool for creating such a video. The <code>alphaextract</code> option can be used to take an input stream with an alpha channel and return a video containing just the alpha component as a greyscale value:</p>

<pre><code>&gt; ffmpeg -i input.gif -vf alphaextract,format=yuv420p output.y4m
</code></pre>

<p>To simplify the process further, a python script, <code>generateOptimizedYUV.py</code>, has been packaged within the bin folder of the SDK, which accepts GIF files and performs the two commands just described. At the same time, the script will attempt a few optimizations with the intent of producing a smaller encoding of the video file.</p>

<p>For the same reasons outlined in the section above, animations need to be explicitly converted for every device. For easy import into your Connect IQ application, the Monkey Motion tool batch converts video to binary encoding<a href="#fn:4" id="fnref:4" title="see footnote" class="footnote">[4]</a> for devices you select.</p>

<h3 id="includinganimationresourcesinamonkeycproject">Including Animation Resources in a Monkey C Project</h3>

<p>To include an animation resource in a Monkey C project, define an animation resource. This can be done manually or by using the Monkey Motion tool. The table below shows all of the valid attributes for an <code>&lt;animation&gt;</code> resource:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the layout, which is used to reference the layout in the Rez module</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>filename</code></td>
	<td style="text-align:left;">The relative path to the Monkey Motion Manifest file</td>
	<td style="text-align:left;">A valid, resolvable path to a Monkey Motion Manifest file</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<p>An example Animation XML resource:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;animation id=&quot;swirl&quot; filename=&quot;swirl.mmm&quot; /&gt;
&lt;/resources&gt;
</code></pre>

<p>To load this animation resource in code, create a <a href="#animationlayer">WatchUi.AnimationLayer</a> then add it to a <code>View</code></p>

<pre><code class="java">class MyAnimationView extends WatchUi.View {

   var mySwirl;

   function initialize( dc ) {
       var dev = System.getDeviceSettings();
       var x = ( dev.screenWidth - mySwirl.getWidth() ) / 2;
       var y = ( dev.screenHeight - mySwirl.getHeight() ) / 2;

       // create a new AnimationLayer with the resource then add it to the view
       // as a WatchUi.Layer
       mySwirl = new WatchUi.AnimationLayer(Rez.Drawables.swirl, {:locX=&gt;x, :locY=&gt;y});
       view.addLayer( mySwirl );
    }

    function onShow() {
        mySwirl.play();
        View.onShow();
    }

    function onUpdate(dc) {
        // override 'onUpdate' to clear the screen
        dc.clear();
    }
}
</code></pre>

<p>Read more about Animations in the <a href="https://developer.garmin.com/connect-iq/api-docs/Toybox/WatchUi/AnimationResource.html">API documentation</a>, <a href="https://developer.garmin.com/connect-iq/api-docs/Toybox/WatchUi/AnimationLayer.html">AnimationLayer documentation</a>, the <a href="#appendixb:animationconsiderations">Animation Considerations</a>, and the AnimationWatchFace sample.</p>

<h2 id="fonts">Fonts</h2>

<p>The resource compiler reads fonts in <code>TXT</code> or <code>PNG</code> format. You can use the BMFont tool (available at <a href="http://www.angelcode.com/products/bmfont/">http://www.angelcode.com/products/bmfont/</a>) to convert a font from many different formats to a compatible format. Prior to export, ensure that BMFont&#8217;s <em>Font Settings</em> specify the Unicode character set. Recommended export options are shown in the image below:</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/bmfont_options.png" style="max-width:298px;" alt="The BMFont Export Options" title="The BMFont export options window" />
<figcaption>The BMFont Export Options</figcaption>
</figure>
</div>

<p>The color can be set using <code>dc.setColor()</code>. Since bitmap fonts can take a lot of runtime memory, the font converter defaults to non-anti-aliased 1-bit fonts to save memory. If you know you will have the runtime RAM available, you can turn on font anti-aliasing with the <code>antialias</code> option.</p>

<pre><code class="xml">&lt;!-- Domo arigato mister font --&gt;
&lt;font id=&quot;font_id&quot; filename=&quot;roboto.fnt&quot; antialias=&quot;true&quot; /&gt;
</code></pre>

<p>If you are creating a large font, sometimes, only particular glyphs need to be large-sized (like numbers for a watch face). Use the filter attribute to specify the particular glyphs to include:</p>

<pre><code class="xml">&lt;!-- Only include digits from this large font --&gt;
&lt;font id=&quot;font_id&quot; filename=&quot;big_font.fnt&quot; filter=&quot;0123456789:&quot;/&gt;
</code></pre>

<h2 id="jsondata">JSON Data</h2>

<p>JSON data resources can store relatively large amounts of data in your app without having to keep it in memory at all times. This can be useful for storing something like a table of information that must be referenced at runtime, but will not be modified.</p>

<p>These resources are declared with the <code>jsonData</code> tag in a resource file, are read by the resource compiler, and loaded on demand at runtime. The <code>jsonData</code> tag supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The identifier of the JSON resource</td>
	<td style="text-align:left;">Any string starting with a letter</td>
</tr>
<tr>
	<td style="text-align:center;"><code>filename</code></td>
	<td style="text-align:left;">The name of a file containing JSON data</td>
	<td style="text-align:left;">A valid, resolvable path to a data file</td>
</tr>
</tbody>
</table>

<p>JSON data resources may be provided as either a <code>jsonData</code> value or as a file referenced by the <code>filename</code> attribute, depending on whether it&#8217;s easier to manage the data inside a resource file or in a separate JSON file. If using a file, it may only contain JSON data. Here are a few examples:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;jsonData id=&quot;jsonDictionary&quot;&gt;{&quot;key&quot;:&quot;value&quot;, &quot;3&quot;:&quot;three&quot;, &quot;three&quot;:3}&lt;/jsonData&gt;
    &lt;jsonData id=&quot;jsonArray&quot;&gt;[1,2,3,4,5,6]&lt;/jsonData&gt;
    &lt;jsonData id=&quot;jsonMix&quot;&gt;[1,{&quot;1&quot;:&quot;one&quot;},[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]]&lt;/jsonData&gt;
    &lt;jsonData id=&quot;jsonPrimitive&quot;&gt;5&lt;/jsonData&gt;
    &lt;jsonData id=&quot;jsonFile&quot; filename=&quot;data.json&quot;/&gt;
&lt;/resources&gt;
</code></pre>

<p>The JSON data is loaded with the <code>WatchUi.loadResource()</code> method by passing in the <code>jsonData</code> ID. For example, to load the <code>jsonArray</code> data from the example above, the following code would be used:</p>

<pre><code class="java">var array = WatchUi.loadResource(Rez.JsonData.jsonArray);
</code></pre>

<h1 id="jsonrestrequests">JSON REST Requests</h1>

<p>Widgets and apps can communicate with a mobile phone via <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">Bluetooth Low Energy</a> (BLE). The mobile phone may be sharing data with the device, or it may act as a bridge between the app and the Internet. This allows the mobile phone to become part of the wearable web.</p>

<p>There are a few complications with device-to-phone communication. For example, the watch app may be killed during the time communication happens, or a phone app may try to send information while the app is not active. In order to simplify these cases for the developer, Monkey C does not expose a low-level interface, but instead exposes a very high-level approach: the API exposes a mailbox metaphor instead of using a socket metaphor. Messages are constructed as a parcel of information and sent back and forth between devices. Each app will have a mailbox where messages are received, and an event that fires when new messages arrive.</p>

<p>There are also high-level interfaces for making JSON and image requests. This allows developers the option of developing a wearable web app without having to write their own companion phone app.</p>

<h2 id="jsonrestrequestsviamobileproxy">JSON REST Requests via Mobile Proxy</h2>

<p>Monkey C exposes a high level APIs to allow calls to basic web services through Garmin Connect Mobile:</p>

<pre><code class="java">module Communications
{
    //! To use Garmin Connect Mobile as a proxy to the web, use makeWebRequest().
    //! The request is asynchronous; the responseCallback will be called when the request returns.
    //! @param [String] url The URL being requested
    //! @param [Dictionary] parameters Dictionary of keys and values, appended to the URL as a GET request or set as the body for a POST request. These values
    //!                                should not be URL encoded. Can be null.
    //! @param [Dictionary] options Dictionary of options. Can be null.
    //! @option options [Number] :method The HTTP method of the request. Should be a HTTP_REQUEST_METHOD_* value.
    //! @option options [Dictionary] :headers A Dictionary of HTTP headers to include in the request. The &quot;Content-Type&quot;
    //!                                       header can be specified using a REQUEST_CONTENT_TYPE_* value. If the content
    //!                                       type is not specified, it will default to &quot;application/json&quot; for GET and
    //!                                       DELETE requests, and will default to &quot;application/x-www-form-urlencoded&quot; for
    //!                                       POST and PUT requests.
    //! @option options [Number] :responseType The format of the response. Should be a HTTP_RESPONSE_CONTENT_TYPE_* value. If not given, the system will attempt
    //!                                        to first parse the response as JSON, then as URL ENCODED.
    //! @param [Method] responseCallback This is a callback in the format function responseCallback(responseCode, data);
    //!                                  responseCode has the server response code or a BLE_* error type, and data contains a Dictionary of content if the request was successful.
    //! @since 1.3.0
    function makeWebRequest( url, parameters, options, responseCallback );

    // These are the supported HTTP methods
    enum {
        HTTP_REQUEST_METHOD_GET = 1,
        HTTP_REQUEST_METHOD_PUT = 2,
        HTTP_REQUEST_METHOD_POST = 3,
        HTTP_REQUEST_METHOD_DELETE = 4
    }

    //! The expected response from making a web request
    enum {
        //! @since 1.3.0
        HTTP_RESPONSE_CONTENT_TYPE_JSON = 0,
        //! @since 1.3.0
        HTTP_RESPONSE_CONTENT_TYPE_URL_ENCODED,
        //! @since 2.2.0
        HTTP_RESPONSE_CONTENT_TYPE_GPX,
        //! @since 2.2.0
        HTTP_RESPONSE_CONTENT_TYPE_FIT
    }

    //! To request an image through Garmin Connect Mobile, call makeImageRequest(). GCM
    //! will scale and dither the image based on the capabilities of the device, but
    //! the user will be able to pass additional options (like dithering it down to a
    //! one color image)
    //! @param [String] url URL of image to request
    //! @param [Dictionary] parameters Dictionary of keys and values, appended to the URL. Can be null.
    //! @param [Dictionary] options Additional image options
    //! @option options [Array] :palette The color palette to restrict the image dithering to. Using a smaller palette can reduce the size of the image data to speed up transfers.
    //! @option options [Number] :maxWidth The maximum width an image should be scaled to
    //! @option options [Number] :maxHeight The maximum height an image should be scaled to
    //! @option options [Number] :dithering The type of dithering to use when processing the image. Defaults to Floyd-Steinberg.
    //! @param [Method] responseCallback This is a callback in the format function responseCallback(responseCode, data);
    //!      responseCode has the server response code, and data contains a WatchUi.BitmapResource if it was successful.
    //! @since 1.2.0
    function makeImageRequest( url, parameters, options, responseCallback );

    enum
    {
        IMAGE_DITHERING_NONE = 1,
        IMAGE_DITHERING_FLOYD_STEINBERG = 2
    }
}
</code></pre>

<p>These APIs expose JSON requests and image requests as very straightforward APIs for making REST API calls. The JSON calls are converted to serialized Monkey C data and sent across the BLE pipe.</p>

<h1 id="authenticatedwebservices">Authenticated Web Services</h1>

<p>There are countless web services available to developers that use either OAUTH 1 or 2 to provide access control. Connect IQ has OAUTH APIs in the <strong>Communications</strong> module that allow widgets and device apps to make authenticated calls.</p>

<h2 id="oauth101">OAUTH 101</h2>

<p>OAUTH provides a standard way for developers to authenticate to gain access to web APIs. Before an app can access the web API, the developer must register the app with the service. During registration you must provide a redirect URL that will be used to retrieve the credentials. Once registered the app will provide a <em>client id</em> and <em>secret</em>, which are necessary for the login process.</p>

<p><img src="resources/programmers-guide/oauth_flow.png" style="max-width:300px;" title="OAUTH flow" />
</figure></p>

<p>To access the web service, the app must authenticate the user. To do this, the app redirects the user&#8217;s web browser to the web service authentication page, providing the secret, the client id, and the redirect URL. After the service has authenticated the user, it redirects their browser back to the client providing an access token. The access token can then be used in subsequent calls to the web service.</p>

<h2 id="oauthandwearables">OAUTH and Wearables</h2>

<p>The OAUTH standard is based on the world of web browsers and mobile applications, but in general people don&#8217;t want to enter their username and password on their watch. Connect IQ has added some new APIs to allow you to xwrite OAUTH enabled apps:</p>

<pre><code class="typescript">  //! Request an OAuth sign-in on Garmin Connect Mobile. A notification will trigger on the phone, that when clicked,
  //! provides a webview that shows initialUrl. If the user grants permission to the app the function given to
  //! registerForOAuthMessages() will be called with a Dictionary of keys from the OAuth process.
  //! @param [String] requestUrl The URL to load in the web view to begin authentication.
  //! @param [Dictionary] requestParams A dictionary of non-URL encoded parameters for the initial url.
  //! @param [String] resultUrl The URL of the final page of authentication that contains the resultKeys.
  //! @param [Number] resultType What format the result will be in. Should be a OAUTH_RESULT_TYPE_XXX value.
  //! @param [Dictionary] resultKeys A dictionary of the keys Garmin Connect Mobile will need to pull out of the OAuth response and given to the
  //!           registered callback in registerForOAuthMessages().
  //! @since 1.3.0
  function makeOAuthRequest(requestUrl, requestParams, resultUrl, resultType, resultKeys);

  //! Register a callback for receiving OAuth messages. The callback will be called once for
  //! each received OAuth message. If there are messages waiting for the app when this
  //! function is called, the callback will immediately be called once for each
  //! waiting message.
  //! @param method [Method] The callback with the signature callback(data). data will be of
  //!            type OAuthMessage
  //! @since 1.3.0
  function registerForOAuthMessages(method);
</code></pre>

<p>The <code>makeOAuthRequest</code> call is intended for implementing credential entry step of the OAUTH 1&amp; 2 standard. When called, the user will receive a phone notification that your app wants to log into a web service. Clicking on this notification will take the user to a web view within Garmin Connect mobile app, where they can enter their log in information.</p>

<p><img src="resources/programmers-guide/oauth_notification.png" style="max-width:300px;" title="OAUTH notification" />
</figure></p>

<p>During this time, the Connect IQ app should display a page directing the user to open Garmin Connect. Once the user has completed credential entry, Connect will send back the tokens specified in the <code>resultKeys</code> option, and direct them back to the wearable.</p>

<p><img src="resources/programmers-guide/oauth_complete.png" style="max-width:300px;" title="OAUTH complete" />
</figure></p>

<p>Your app should call <code>registerForOAuthMessages</code> to receive the result of the login process. Logging in can take a long time, and a widget may time out before the user completes the login step. If your app closes before the login process completes, the result will be cached on the device until the next time your app calls <code>registerForOAuthMessages</code>, at which point the result will be passed to your callback immediately. Once you have the access token, you can use it as an argument to <code>makeWebRequest</code>.</p>

<h1 id="communicatingwithmobileapps">Communicating with Mobile Apps</h1>

<h2 id="directinguserstowebcontent">Directing Users to Web Content</h2>

<p>The <code>openWebPage</code> call can be used to direct the user to a specific web page on the phone. When called, the specified web page should be fetched and displayed in the phones default browser. There is no callback for this function and the watch app has no method for checking if the call was completed on the phone successfully.</p>

<pre><code class="java">module Communications
{
    //! Request that GCM issue a phone notification that will open a web page.
    //! @param url [String] The URL to open.
    //! @param params [Dictionary] The request parameters. Parameters should not be URL encoded.
    //! @param options [Dictionary] Additional options for the request. (TBD)
    //! @since 1.3.0
    function openWebPage(url, params, options);
}
</code></pre>

<h2 id="mobilesdkdownloads">Mobile SDK Downloads</h2>

<p>The Connect IQ Mobile SDKs are released separately from the Connect IQ Developer SDK and is available for iOS and Android. There are several editions of the Mobile SDK available:</p>

<ul>
<li>Android BLE</li>
<li>iOS BLE</li>
<li>Android ADB</li>
</ul>

<p>The <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">BLE</a> edition supports development of communication-enabled applications on an iOS or Android target device while the <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">Android Debug Bridge</a> (ADB) edition is used for testing with the Connect IQ Simulator.</p>

<p>More information on how to download the correct version for your mobile platform may be found on the <a href="http://developer.garmin.com/connect-iq/developer-tools/communication">Garmin Developer site</a>.</p>

<h2 id="blesimulationoverandroiddebugbridge">BLE Simulation Over Android Debug Bridge</h2>

<p>When using the Connect IQ Simulator, it is possible to communicate with a companion app running on an Android device using <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a>. This will simulate actual <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">BLE</a> speeds to better approximate performance of your application.</p>

<p>The <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a> edition of the Android Mobile SDK and companion app is required to use <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a> for testing. Here&#8217;s how to enable the companion to communicate over <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a>:</p>

<ol>
<li>Connect the phone to the PC running the simulator via USB</li>
<li>Have USB debugging enabled on the Android handset</li>
<li>Obtain an instance of ConnectIQ using <code>getInstance( IQCommProtocol.ADB_SIMULATOR )</code></li>
<li>Optionally call <code>setAdbPort( int port )</code> to set a specific port to use for communication (the default port is 7381)</li>
<li>Call <code>initialize()</code></li>
</ol>

<p>To allow the simulator to communicate over <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a>, forward the TCP port to the Android device in a terminal or console:</p>

<pre><code class="bash">adb forward tcp:7381 tcp:7381
</code></pre>

<p>Note that this command will need to be reissued for each connected Android device, or if a device is disconnected and re-connected.</p>

<p>Once your app is started on the phone, connect it to the simulator by clicking the <em>Connection</em> menu and selecting <em>Start</em> (CTRL-F1). The Connect IQ apps in the simulator will now be able to communicate with your device via the Communications APIs over <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a>.</p>

<p>The <code>PersistedContent</code> module allows access to the saved Tracks, Courses, Waypoints, Workouts, and Routes that the user has on their device. These content types contain a name and a unique identifier, which can be used by <code>System.exitTo()</code> as an <code>Intent</code> to launch into a native app and present the content to the user in some way. See the <a href="#intents2.2">Intents</a> section for more details about <code>Intents</code>.</p>

<p>Calling <code>System.exitTo()</code> with a <code>PersistedContent</code> object prompts the user to choose which native app to launch. For example, if an app calls <code>System.exitTo()</code> with a <code>PersistedContent.Waypoint</code> object, the dialog will ask whether to launch the waypoint with one of either the Run or Bike native apps.</p>

<p>When retrieving the list of stored content on the device, a <code>PersistedContent.Iterator</code> will be returned. The <code>next()</code> function must be called to get the first entry, and <code>null</code> is returned when there are no more entries:</p>

<pre><code class="java">// This will launch the first waypooint stored on the device
using Toybox.PersistedContent as Content;
using Toybox.System as Sys;

var waypoints = Content.getWaypoints();
var waypoint = routes.next();

if(waypoint != null) {
    Sys.exitTo(waypoint.toIntent());
}
</code></pre>

<p>There are three possible cases once the content is sent to the device:</p>

<ol>
<li><strong>Data import is successful</strong> - A <code>PersistedContent.Iterator</code> will be returned, which contains the elements that were downloaded.</li>
<li><strong>The system does not have enough space</strong> - The <code>STORAGE_FULL</code> response will be returned to the <code>responseCallback</code>.</li>
<li><strong>The system does not support the file type</strong> (i.e. a running workout is sent to a cycling device) - The <code>responseCallback</code> will return an empty iterator or <code>null</code> value.</li>
</ol>

<p>Access to <code>PersistedContent</code> requires the &#8216;Persisted Content&#8217; permission.</p>

<h2 id="persistedcontentinthesimulator">Persisted Content in the Simulator</h2>

<p>Because native apps are not simulated in Connect IQ simulator, an <em>Intent Launched</em> feature has been added that is useful for testing with <code>PersistedContent</code>. This feature displays three critical pieces of information about the <code>PersistedContent</code> object supplied via <code>Intent</code> in the simulator window:</p>

<ol>
<li>The object type</li>
<li>The unique serializable ID of the object</li>
<li>The name of the object</li>
</ol>

<p>For example, the sample code above may display a picture of an activity with &#8220;Intent Launched&#8221;, a type, an ID number and its name displayed.</p>
<figure>
<img src="resources/programmers-guide/intent-launched.png" style="max-width:635px;" title="Launched Intent in the Simulator" />
</figure>

<h2 id="wifibulkdownloadsconnectiq3.1">WiFi Bulk Downloads (Connect IQ 3.1)</h2>

<p>In some cases, the <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">Bluetooth Low Energy</a> (BLE) link to Garmin Connect Mobile is too slow for downloading some content. For these situations, the WiFi Bulk Downloads feature can prove useful.</p>

<p>The <code>Communications</code> module provides methods to initiate a transition to sync mode, and communicate sync status information to the system for display:</p>

<pre><code class="java">module Communications
{

    //! Send a system notification to the system to indicate overall sync progress.
    //! @param percentageComplete [Number] An integer from 0 to 100 indicating the
    //!   completion percentage.
    function notifySyncProgress(percentageComplete);

    //! Send a system notification to the system to indicate that the sync completed.
    //! @param errorMessage [String] A descriptive error message if a failure occurred.
    //!  If the sync completes successfully, +null+ should be passed to this method.
    function notifySyncComplete(errorMessage);

    //! Exit the Application and launch it in sync mode.
    function startSync();

    //! A delegate object that the user implements to respond to sync requests
    //! from the system.
    class SyncDelegate {

        //! Called when a sync is started by the system.
        //!
        //! This method should be used to kick-off the application sync process.
        function onStartSync();

        //! Check if a sync is needed.
        function isSyncNeeded();

        //! Called when an active sync is cancelled.
        function onStopSync();
    }

}
</code></pre>

<p>The <code>Application.AppBase</code> class provides an entry point for the system to get a delegate used to communicate with the app while in sync mode:</p>

<pre><code class="java">module Application
{
    class AppBase {

        //! Get a SyncDelegate object that communicates sync status to the system
        //! for syncing content to the device.
        function getSyncDelegate() {
            return null;
        }
    }
}
</code></pre>

<p>To use the bulk download functionality, implement <code>AppBase.getSyncDelegate()</code> to return an instance of a class derived from <code>Communications.SyncDelegate</code>. When the application calls <code>Communications.startSync()</code>, the system will terminate the running application, re-launch it in sync mode, and make a call to <code>getSyncDelegate()</code> to retrieve the application&#8217;s <code>SyncDelegate</code>.</p>

<p>Once the application has retrieved the application&#8217;s <code>SyncDelegate</code>, it will verify that a sync is necessary by calling <code>SyncDelegate.isSyncNeeded()</code>. If this method returns <code>true</code>, the system will proceed to call <code>SyncDelegate.onStartSync()</code>. At this point, the delegate may initiate a request to download content by making a call to <code>Communications.makeWebRequest()</code> or <code>Communications.makeImageRequest()</code>. When the response callback for the request is invoked, the delegate should notify the system of the progress made by calling <code>Communications.notifySyncProgress()</code>. If additional content remains to be downloaded, another content request may be issued. This cycle should repeat until all content has been downloaded or an error has occurred, at which time a call to <code>Communications.notifySyncComplete()</code> should be made to notify the system that the app can leave sync mode.</p>

<p>If the user decides to cancel the bulk download operation, the system will call <code>SyncDelegate.onStopSync()</code> to notify the application. The app must acknowledge the sync cancellation by calling <code>Communications.notifySyncComplete()</code>. The system will display the given error message, if appropriate, and will proceed to exit sync mode.</p>

<h1 id="mobilesdkforandroid">Mobile SDK for Android</h1>

<p>The Mobile SDK for Android allows you to create companion applications that run on users&#8217; phones and interact with your application on their wearable devices. This allows for a more feature-rich user experience where doing certain tasks on the wearable device might be tedious or resource intensive.</p>

<h2 id="addingthemobilesdktoaproject">Adding the Mobile SDK to a Project</h2>

<p>To begin using the mobile SDK, copy the connectiq.jar file into the libs folder of your Android project.</p>

<p>To communicate with a Connect IQ device via your companion application, users must also install Garmin Connect Mobile&trade; onto their phones. All communication for companion applications running on Android goes through a Garmin Connect Mobile service to reach the device.
When initializing the SDK, this requirement is checked and initialization will fail if Garmin Connect Mobile is not installed. If true is passed to the auto UI parameter of initialize, a message is displayed to the user that he or she needs to either install or upgrade Garmin Connect Mobile, and provides him/her a way to go directly to the application in the Google Play Store. See <a href="#displayuimessage">Displaying a UI Message Automatically When Initialization Fails</a> for more information.</p>

<h2 id="interactingwiththesdk">Interacting with the SDK</h2>

<p>All interactions between the companion application and the Connect IQ application are done via the <code>ConnectIQ</code> class. To use this class you must first obtain an instance of the class and then initialize it.</p>

<pre><code class="java">ConnectIQ connectIQ = ConnectIQ.getInstance(ConnectIQ.IQConnectType.&lt;protocol&gt;);
</code></pre>

<p><code>ConnectIQ.IQConnectType</code> provides two options:</p>

<ul>
<li><code>WIRELESS</code> - For communicating with the Connect IQ simulator or real device via BLE. This is the default.</li>
<li><code>TETHERED</code> - For communicating with the Connect IQ simulator over the Android Debug Bridge.</li>
</ul>

<h2 id="initializingthesdk">Initializing the SDK</h2>

<p>Initializing the SDK is an asynchronous process and requires a <code>ConnectIQListener</code> to handle returned states of the SDK. You must wait for the <code>onSdkReady()</code> call to be made before calling any additional API methods. Doing so beforehand will result in an <code>InvalidStateException</code>.</p>

<pre><code class="java">    connectIQ.initialize(context, true, new ConnectIQListener() {
    // Called when the SDK has been successfully initialized
    @Override
    public void onSdkReady() {

        // Do any post initialization setup.
    }

    // Called when initialization fails.
    @Override
    public void onInitializationError(IQSdkErrorStatus status) {

        // A failure has occurred during initialization.  Inspect
        // the IQSdkErrorStatus value for more information regarding
        // the failure.

    }

    ...
});
</code></pre>

<h2 id="displayuimessage">Displaying a UI Message Automatically When Initialization Fails</h2>

<p>If initialization fails due to Garmin Connect Mobile not being installed on the user&#8217;s phone or if it needs to be upgraded, a message can be displayed prompting the user to take action. You can tell the SDK to display this message automatically by passing true as the second parameter to the <code>initialize()</code> method. By default, the UI will display a dialog message to the user asking them to take action. The strings that make up the dialogs are by default English only strings. These strings are fully customizable by simply adding some predefined strings to your projects <code>strings.xml</code> file.</p>

<p>Customizable Strings</p>

<table>
<colgroup>
<col/>
<col/>
</colgroup>

<thead>
<tr>
	<th><code>android:name</code> in <code>strings.xml</code></th>
	<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td><code>install_needed_title</code></td>
	<td>Dialog title for when Garmin Connect Mobile needs to be installed.</td>
</tr>
<tr>
	<td><code>install_needed_message</code></td>
	<td>Dialog message for when Garmin Connect Mobile needs to be installed.</td>
</tr>
<tr>
	<td><code>install_needed_yes</code></td>
	<td>Button text for user to confirm they want to visit the Google Play Store to install Garmin Connect Mobile.</td>
</tr>
<tr>
	<td><code>install_needed_cancel</code></td>
	<td>Button text for user to cancel the dialog and not install Garmin Connect Mobile.</td>
</tr>
<tr>
	<td><code>upgrade_needed_title</code></td>
	<td>Dialog title for when Garmin Connect Mobile needs to be upgraded to a version that supports the SDK.</td>
</tr>
<tr>
	<td><code>upgrade_needed_message</code></td>
	<td>Dialog message for when Garmin Connect Mobile needs to be upgraded to a version that supports the SDK.</td>
</tr>
<tr>
	<td><code>upgrade_needed_yes</code></td>
	<td>Button text for user to confirm they want to visit the Google Play Store to upgrade Garmin Connect Mobile.</td>
</tr>
<tr>
	<td><code>upgrade_needed_cancel</code></td>
	<td>Button text for a user to cancel the dialog and not upgrade Garmin Connect Mobile.</td>
</tr>
</tbody>
</table>

<h2 id="workingwithdevices">Working with Devices</h2>

<h3 id="findingconnectiq-compatibledevices">Finding Connect IQ-compatible Devices</h3>

<p>Before you can interact with a Connect IQ device, you must obtain a reference to an <code>IQDevice</code> object instance representing it. This is done by one of two methods. <code>getKnownDevices()</code> will return a list on any Connect IQ device that has been paired within Garmin Connect Mobile. These devices may or may not be connected at the time the API is called.</p>

<pre><code class="java">List&lt;IQDevice&gt; paired = connectIQ.getKnownDevices();

if (paired != null &amp;&amp; paired.size() &gt; 0) {
    // get the status of the devices
    for (IQDevice device : paired) {
       IQDeviceStatus status = connectIQ.getStatus(device);
       if (status == IQDeviceStatus.CONNECTED) {
               // Work with the device
       }
    }
}
</code></pre>

<p><code>getAvailableDevices()</code> will return a list of currently connected devices. Because these devices could become disconnected at any time, it is good practice to register to receive a notification when the device connects or disconnects. See <a href="#ReceivingMessages">Receiving Messages</a> for more information.</p>

<pre><code class="java">List&lt;IQDevice&gt; devices = connectIQ.getAvailableDevices();

if (devices != null &amp;&amp; devices.size() &gt; 0) {
    // Work with devices.

}
</code></pre>

<h3 id="listeningfordeviceevents">Listening for Device Events</h3>

<p>You can request to be notified when the status of a device changes by calling <code>registerForDeviceEvents(IQDevice, IQDeviceEventListener)</code>. Once registered, any device status change will call the &lt;<code>IQDeviceEventListener.onDeviceStatusChanged()</code> with the new status. When you no longer need to receive updates for a device, you should call <code>unregisterForDeviceEvents(IQDevice)</code> to release any associated resources.</p>

<pre><code class="java">// Register to receive status updates
connectIQ.registerForDeviceEvents(device, new IQDeviceEventListener() {

    @Override
    public void onDeviceStatusChanged(IQDevice device, IQDeviceStatus newStatus) {

        // Handle new status

    }

});

// Get the current status
IQDeviceStatus current = connectIQ.getStatus(device);

// Unregister when we not longer need status updates
connectIQ.unregisterForDeviceEvents(device);
</code></pre>

<p>Possible device statuses:</p>

<ul>
<li>CONNECTED &#8211; The device is connected and can be communicated with.</li>
<li>NOT_CONNECTED &#8211; The device is paired with Garmin Connect Mobile but is not currently connected and cannot be communicated with.</li>
<li>NOT_PAIRED &#8211; The device is not paired with Garmin Connect Mobile and cannot be communicated with.</li>
</ul>

<h2 id="workingwithapps">Working with Apps</h2>

<h3 id="obtaininganinstanceofiqapp">Obtaining an Instance of IQApp</h3>

<p>Apps are represented in the Mobile SDK as instances of the <code>IQApp</code> class. While you can create an <code>IQApp</code> instance on your own, it is recommended to obtain a fully populated <code>IQApp</code> instance via the <code>getApplicationInfo()</code> method. You can determine if your Connect IQ application is installed on the user&#8217;s device by calling <code>getApplicationInfo()</code> passing the <code>IQDevice</code> and the Application UUID Identifier for the application you want to check. This will return an <code>IQApp</code> object that can be inspected via the <code>getStatus()</code> method to determine the status of your application on the device. If the status is <code>INSTALLED</code>, the version number will also be populated so you can determine if the user has the latest version of your application.</p>

<pre><code class="java">IQApp app = connectIQ.getApplicationInfo(device, MY_APPLICATION_ID);

if (app != null) {
    if (app.getStatus() == INSTALLED) {
        if (app.getVersion() &gt; MY_CURRENT_VERSION) {
            // Prompt the user to upgrade
        }
    }
}
</code></pre>

<p>Possible application statuses:</p>

<ul>
<li>INSTALLED &#8211; The application is installed on the device and the version information has been populated.</li>
<li>NOT_INSTALLED &#8211; The application is not currently installed on the device but is supported.</li>
<li>NOT_SUPPORTED &#8211; The application is not installed on the device and is not supported by the device.</li>
</ul>

<h3 id="openingtheconnectiqstore">Opening the Connect IQ Store</h3>

<p>If the user does not have your applications installed (status of <code>NOT_INSTALLED</code>), or needs to upgrade to the latest version, you can open the Connect IQ store directly to your application. Simply call <code>openStore()</code> passing the Application Identifier for your application.</p>

<pre><code class="java">connectIQ.openStore(MY_APPLICATION_ID);
</code></pre>

<h2 id="sendingmessages">Sending Messages</h2>

<p>You can send messages to your Connect IQ application on a connected device using any of the Java equivalent Monkey C data types (see <a href="#supporteddata">Supported Data Types</a>). Calling <code>sendMessage()</code> will deliver the message to your applications mailbox.</p>

<pre><code class="java">List&lt;Object&gt; message = new ArrayList&lt;String&gt;() {&quot;hello pi&quot;, 3.14159};

IQMessageStatus status = connectIQ.sendMessage(device, app, message);

if (status != IQMessageStatus.SUCCESS) {

    // Evaluate status for the cause of the failure.

}
</code></pre>

<h2 id="receivingmessages">Receiving Messages</h2>

<p>In order to receive data messages from a Connect IQ application, you must first register to receive application events. Once registered via <code>registerForAppEvents()</code>, when a new message arrives from the Connect IQ application, it will be delivered to the <code>onMessageReceived()</code> method of the listener passed when registering. When you no longer wish to receive incoming messages, you should call <code>unregisterForAppEvents()</code> to release any associated resources.</p>

<p>A companion app may register to receive messages from multiple apps across many devices. However, multiple companion apps cannot be registered to receive messages from the same ConnectIQ application. The SDK will override any previous registrations with each call to <code>registerForAppEvents()</code>.</p>

<pre><code class="java">// Register to receive messages from our application
connectIQ.registerForAppEvents(device, app, new IQApplicationEventListener() {

       @Override
       public void onMessageReceived(IQDevice device, IQApp app,
                                     List&lt;Object&gt; messageData,
                                     IQMessageStatus status) {
              // First inspect the status to make sure this
              // was a SUCCESS.  If not then the status will indicate why there
              // was an issue receiving the message from the Connect IQ application.
              if (status == IQMessageStatus.SUCCESS) {
                      // Handle the message.
              }
       }

});

// unregister when we no longer care about messages coming from our app.
connectIQ.unregisterForAppEvents(device, app);
</code></pre>

<h2 id="supporteddata">Supported Data Types</h2>

<table>
<colgroup>
<col/>
<col/>
<col/>
</colgroup>

<thead>
<tr>
	<th>Java Data Type</th>
	<th>Monkey C Type</th>
	<th>Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td>int, Integer</td>
	<td>Integer</td>
	<td></td>
</tr>
<tr>
	<td>float, Float</td>
	<td>Float</td>
	<td></td>
</tr>
<tr>
	<td>boolean, Boolean</td>
	<td>Boolean</td>
	<td></td>
</tr>
<tr>
	<td>String</td>
	<td>String</td>
	<td></td>
</tr>
<tr>
	<td>List&lt;?&gt;</td>
	<td>Array[]</td>
	<td>List must contain only supported data types. If the list contains unsupported data types, an exception will be thrown.</td>
</tr>
<tr>
	<td>Map&lt;?,?&gt;</td>
	<td>Dictionary</td>
	<td>Map keys and values must be supported data types. If the map contains unsupported data types, an exception will be thrown.</td>
</tr>
</tbody>
</table>

<h1 id="mobilesdkforios">Mobile SDK for iOS</h1>

<p>The Mobile SDK for iOS allows you to create companion iOS applications that interact with Monkey C applications running on Garmin wearable devices. This allows feature-rich user experiences to be built by retrieving remote data or offloading resource-intensive tasks from the wearable device to the iOS device. This is your guide to adding the Mobile SDK to an iOS project, as well as introducing the SDK&#8217;s API and how to communicate with your Monkey C apps.</p>

<h2 id="configuringaprojecttousethemobilesdk">Configuring a Project To Use the Mobile SDK</h2>

<p><strong>

<li>Add the framework to the project.</li></strong></p>

<p>The Mobile SDK for iOS is distributed as an iOS framework package and can be found in the iOS SDK. First, drag the <code>ConnectIQ.framework</code> into the Frameworks group of the project in Xcode.</p>

<p><strong>

<li>Add the bundle to the project.</li></strong></p>

<p>The Mobile SDK for iOS is also distributed with a bundle containing resources used by the SDK, and can be found in the iOS SDK. To allow the SDK to access these resources, they must be added to the project that is referencing the SDK&#8217;s framework. Drag the <code>ConnectIQ.bundle</code> file into an appropriate folder of the project in Xcode (e.g. Resources or Supporting Files).</p>

<p><strong>

<li>Add a linker dependency to the framework.</li></strong></p>

<p>To allow a project to build with the Mobile SDK, add a linker dependency to the framework for each of the project&#8217;s targets by adding an entry to the <code>Target &gt; Build Phases &gt; Link Binary With Libraries</code> panel.</p>

<p><strong>

<li>Copy bundle resources.</li></strong></p>

<p>Similarly, in order for the resources inside the bundle added in step 2 to be available at runtime, they must be copied to the target&#8217;s resources at build time. This can be accomplished by adding an entry to the <code>Target &gt; Build Phases &gt; Copy Bundle Resources</code> panel.</p>

<p><strong>

<li>Add required linker flags.</li></strong></p>

<p>The Mobile SDK for iOS utilizes category methods internally. When importing a library that uses category methods, an additional flag must be specified to allow the library to be linked correctly. To do this, add the <code>–ObjC flag</code> to the <code>Target &gt; Build Settings &gt; Other Linker Flags</code> setting.</p>

<p><strong>

<li>Register a URL scheme.</li></strong>
Unlike the Mobile SDK for Android, apps created with the Mobile SDK for iOS are standalone apps and do not directly rely on Garmin Connect™ Mobile (GCM) to communicate with a wearable device. They do, however, require GCM to initially discover Connect IQ-compatible devices that are available for communication, or to install Monkey C applications on the wearable device. The companion app and GCM exchange information by launching each other via the iOS URL scheme system.</p>

<p>To facilitate this, a URL scheme that GCM can send data to must be registered by the app. To do this, add an entry to the <code>Target &gt; Info &gt; URL Types</code> panel. A string that is not likely to collide with any other apps on the iOS device should be chosen. See the Apple documentation for more information on custom URL schemes.</p>

<p><strong>

<li>Set background execution mode (optional).</li></strong>
The iOS system allows apps that communicate with Bluetooth devices to be woken up to execute in the background when a connected device has data to send. This can be useful
for companion apps that process requests for their respective Monkey C applications on a wearable device. To enable this behavior, turn on the <code>Uses Bluetooth LE accessories</code> option in the <code>Target &gt; Capabilities &gt; Background Modes</code> panel.</p>

<h2 id="initializingthesdk">Initializing the SDK</h2>

<p>All interaction with the Mobile SDK is done through the <code>ConnectIQ</code> class. This class must be initialized during app startup with the project&#8217;s URL scheme and a UI override delegate. Typically this is done within the app delegate&#8217;s <code>application:didFinishLaunchingWithOptions:</code> method.</p>

<pre><code class="objective-c">[[ConnectIQ sharedInstance] initializeWithUrlScheme:@&quot;exapp-123456&quot;
                                 uiOverrideDelegate:self];
</code></pre>

<p>The URL scheme should be the same string chosen in Step 4 of <a href="#configuringaprojecttousethemobilesdk">Configuring a Project To Use the Mobile SDK</a></p>

<p>When invoking a method of the <code>ConnectIQ</code> class that requires GCM to be installed and it is not present on the iOS system, by default an alert dialog will be shown to users that allows them to go to the Apple App Store page for GCM to install it. By passing an instance of an object that conforms to the <code>IQUIOverrideDelegate</code> protocol here, custom behavior or a specialized UI may be specified in this case. To use the default alert dialog and behavior, pass <code>nil</code>.</p>

<h3 id="implementingauioverridedelegate">Implementing a UI Override Delegate</h3>

<p>If a UI override delegate was specified and an action was performed that requires GCM to be installed, the <code>ConnectIQ</code> class will call the <code>needsToInstallConnectMobile</code> method on that delegate. The app should inform the user that GCM is required for this action and give the user the option to open the Apple App Store page for GCM or to cancel the action that triggered it. If the user chooses to install GCM, the <code>howAppStoreForConnectMobile</code> method may be called.</p>

<pre><code class="objective-c">- (void)needsToInstallConnectMobile {
    // Show alert to user with choice to install GCM
    if (alert.result == YES) {
       [[ConnectIQ sharedInstance] showAppStoreForConnectMobile];
    }
}
</code></pre>

<p>Note that this example is synchronous, but if UI is shown to the user, the <code>showAppStoreForConnectMobile</code> method should be called as a result of user input instead of directly in the <code>needsToInstallConnectMobile</code> method.</p>

<h2 id="workingwithdevices">Working with Devices</h2>

<h3 id="findingconnectiq-compatibledevices">Finding Connect IQ-compatible Devices</h3>

<p>The Mobile SDK for iOS can communicate directly with Connect IQ-compatible devices over Bluetooth. However, it must first know which devices are available. To accomplish this, a
companion app must call the <code>showConnectIQDeviceSelection</code> method.</p>

<pre><code class="objective-c">[[ConnectIQ sharedInstance] showConnectIQDeviceSelection];
</code></pre>

<p>This method launches GCM to the foreground and allows the user to choose which paired Connect IQ-compatible devices to share with the companion app. If GCM is not installed and
a UI override delegate was set, its <code>needsToInstallConnectMobile</code> will be called.</p>

<p>Note that by launching GCM, this method causes the companion app to go into the background, possibly resulting in the app being suspended. <strong>The companion app should expect to be suspended when calling this method</strong>.</p>

<p>Once the user has selected which of the paired devices to share with the companion app, GCM will launch the companion app (via its registered URL scheme), passing the list of devices as serialized URL query items. The companion app should override its app delegate&#8217;s <code>application:openURL:sourceApplication:annotation:</code> method to listen for this. The companion app may then call the <code>parseDeviceSelectionResponseFromURL:</code> method to extract the query items into an <code>NSArray</code> of <code>IQDevice</code> objects that it can use with the Mobile SDK.</p>

<pre><code class="objective-c">- (BOOL)application:(UIApplication *)application
            openURL:(NSURL *)url
  sourceApplication:(NSString *)sourceApplication
         annotation:(id)annotation {
    if ([url.scheme isEqualToString:ReturnURLScheme] &amp;&amp;
        [sourceApplication isEqualToString:IQGCMBundle]) {

        NSArray *devices = [[ConnectIQ sharedInstance]
                             parseDeviceSelectionResponseFromURL:url];
        if (devices != nil) {
            [self.devices removeAllObjects];
            for (IQDevice *device in devices) {
                 self.devices[device.uuid] = device;
            }
            return YES;
        }
    }
    return NO;
}
</code></pre>

<p>Note that in this example, the parsed devices are stored to a dictionary for later use within the app, but are not cached in any kind of persistent storage.</p>

<p>To avoid needing to launch GCM excessively to discover devices, <strong>companion apps should cache devices to persistent storage</strong>.</p>

<p>When a list of devices is returned by GCM, companion apps should clear all previously cached references to devices they may have known about. <strong>Always use only the latest list of devices that the user has authorized</strong>.</p>

<h3 id="listeningfordeviceevents">Listening for Device Events</h3>

<p>Once the companion app has one or more <code>IQDevice</code> instances from GCM, it may register with the <code>ConnectIQ</code> class to receive notifications when that device&#8217;s connection status changes by calling <code>registerForDeviceEvents:delegate:</code>.</p>

<pre><code class="objective-c">[[ConnectIQ sharedInstance] registerForDeviceEvents:device
                                           delegate:self];
</code></pre>

<p>The delegate passed in must be an instance of a class that conforms to the <code>IQDeviceEventDelegate</code> protocol. Once registered, the delegate&#8217;s <code>deviceStatusChanged:status:</code> method will be invoked when the device&#8217;s connection status changes. The getDeviceStatus: method may also be called to get the current connection status of the device. These methods both return a device&#8217;s status as an <code>IQDeviceStatus</code> value.</p>

<p>A companion app must register to receive device events before calling methods that operate on devices or apps, such as <code>getDeviceStatus:</code> or
<code>sendMessage:toApp:progress:completion:</code>.</p>

<p>To stop listening for device events, a companion app may call either the <code>unregisterForDeviceEvents:delegate:</code> or <code>unregisterForAllDeviceEvents:</code>
method.</p>

<pre><code class="objective-c">// Stop listening to a single device
[[ConnectIQ sharedInstance] unregisterForDeviceEvents:device
                                             delegate:self];
// ... or unregister all devices for this listener
[[ConnectIQ sharedInstance] unregisterForAllDeviceEvents:self];
</code></pre>

<h2 id="workingwithapps">Working with Apps</h2>

<h3 id="creatinganappinstance">Creating an App Instance</h3>

<p>Apps are represented in the Mobile SDK as instances of the <code>IQApp</code> class. An instance of the <code>IQApp</code> class represents a single app on a single device. This means that in order to work with an app that&#8217;s installed on two different devices, a companion app will need two instances of the <code>IQApp</code> class with the same app ID, one for each device. To create an app instance, use the <code>IQApp</code> class&#8217;s <code>appWithUUID:device:</code> method.</p>

<pre><code class="objective-c">NSUUID *uuid = [[NSUUID alloc] initWithUUIDString:@&quot;&lt;YourAppID&gt;&quot;];
IQApp *app = [IQApp appWithUUID:uuid device:device];
</code></pre>

<h2 id="requestinganappsstatus">Requesting an App&#8217;s Status</h2>

<p>Once an <code>IQApp</code> instance has been created that links an app ID to an <code>IQDevice</code> instance, a companion app may request the status of the app on that device by calling the <code>getAppStatus:completion:</code> method.</p>

<pre><code class="objective-c">[[ConnectIQ sharedInstance] getAppStatus:completion:^(IQAppStatus *appStatus) {
    if (appStatus != nil &amp;&amp; appStatus.isInstalled) {
        NSLog(@&quot;App is installed! Version: %d&quot;, appStatus.version);
    }
}];
</code></pre>

<p>This method communicates with the device over Bluetooth, and therefore is asynchronous. The completion block will be invoked when the device responds, or the request times out.</p>

<p>If the request is successful, the completion block will be invoked with an instance of the <code>IQAppStatus</code> class. A companion app may inspect this status to discover if the app is installed on the device, and if so, what the version of that app is. A companion app could then potentially show a UI that recommends that the user upgrade the app on the device.</p>

<p>If the device is not currently connected or the request times out, the completion block will be invoked with a <code>nil</code> status.</p>

<h3 id="installingupgradingormanaginganapp">Installing, Upgrading or Managing an App</h3>

<p>If a companion app determines that an app is out of date or not installed, it may allow the user to install or upgrade that app by launching the Connect IQ store within GCM. To do this,
simply call the <code>showConnectIQStoreForApp:</code> method.</p>

<pre><code class="objective-c">[[ConnectIQ sharedInstance] showConnectIQStoreForApp:app];
</code></pre>

<p>A companion app may also call this method even if the app is installed and up to date on the device, to allow the user to manage or uninstall the app from the device.</p>

<p>Like the <code>showConnectIQDeviceSelection</code> method, by launching GCM, this method causes the companion app to go into the background, possibly resulting in the app being
suspended. <strong>The companion app should expect to be suspended when calling this method</strong>.</p>

<h3 id="sendingmessages">Sending Messages</h3>

<p>Once a companion app has determined that an app is installed on a connected device, the companion app may send messages over Bluetooth to that app&#8217;s mailbox by calling the
<code>sendMessage:toApp:progress:completion:</code> method. This method takes an object as a message, an <code>IQApp</code> as the destination, and two blocks &mdash; one that is invoked periodically as the data transfer progresses, and one that is invoked once the transfer is finished.</p>

<pre><code class="objective-c">NSArray *message = @[@&quot;hello pi&quot;, @(3.14159)];
[[ConnectIQ sharedInstance] sendMessage:message
                                  toApp:app
                               progress:^(uint32_t sent, uint32_t total) {
    float percent = 100 * sent / (float)total;
    NSLog(@&quot;.2f%% - %u/%u&quot;, percent, sent, total);
} completion:^(IQSendMessageResult result) {
    NSLog(@&quot;Send message finished with result %@&quot;,
        NSStringFromSendMessageResult(result));
}];
</code></pre>

<p>The message object that is passed to this method is first converted by the SDK into a Monkey C-compatible type, and is then sent to the app&#8217;s mailbox on the device. Therefore,
<strong>only Objective-C types that can be directly translated to comparable Monkey C types are valid</strong>.</p>

<p>Valid message types include <code>NSString</code>, <code>NSNumber</code>, <code>NSArray</code>, <code>NSDictionary</code> and <code>NSNull</code>. Take advantage of nesting other types inside an <code>NSArray</code> or <code>NSDictionary</code> to form complex messages. Values contained in <code>NSNumber</code> objects will be converted to the most appropriate Monkey C value type on the device.</p>

<p>Keep in mind that the wearable devices have limited memory and processing power compared to an iOS device. <strong>Messages should be as small as possible</strong>. However, sending frequent small messages can incur performance and battery life costs. Therefore, it is more desirable to send occasional large messages than it is to frequently send many tiny messages. <strong>Companion apps should aim to balance the costs of memory and performance by sending messages only when necessary and keeping message size to a minimum</strong>.</p>

<h2 id="receivingmessages">Receiving Messages</h2>

<p>A companion app may register to receive messages that are sent from an app on a device by calling the <code>registerForAppMessages:delegate:</code> method. This method takes an <code>IQApp</code> to listen for messages from, and an instance of an object that conforms to the <code>IQAppMessageDelegate</code> protocol as the listener. After registering, when a message from that app is successfully received, the <code>receivedMessage:fromApp:</code> method will be called on the listener.</p>

<p>To stop listening for app messages, a companion app may call either the <code>unregisterForAppMessages:delegate:</code> or unregisterForAllAppMessages:
method.</p>

<pre><code class="objective-c">- (void)viewWillAppear:(BOOL)animated {
    [[ConnectIQ sharedInstance] registerForAppMessages:self.app delegate:self];
}
- (void)viewDidDisappear:(BOOL)animated {
    [[ConnectIQ sharedInstance] unregisterForAllAppMessages:self];
}
- (void)receivedMessage:(id)message fromApp:(IQApp *)app {
    NSLog(@&quot;Received message from app %@: '%@'&quot;, app, message);
}
</code></pre>

<p>A companion app may register to receive messages from multiple apps across many devices. However, <strong>multiple companion apps should never register to receive messages from the same app</strong>. The nature of Bluetooth communication on iOS prevents the Mobile SDK from determining which companion app to deliver the message to. Therefore, undefined behavior will result from multiple companion apps registering to receive messages from the same app.</p>

<h1 id="antandant">ANT and ANT+</h1>

<p>The Sensor module of Connect IQ gives developers access to the built-in and paired sensors of the device. Connect IQ also provides access to the available ANT channels as well. This allows developers to communicate with sensors not supported by Garmin. Using the FIT recording system those metrics can be recorded to the Activity file and uploaded to Garmin Connect.</p>

<p>Learn more about ANT and ANT+ at <a href="">thisisant.com</a></p>

<h2 id="genericantchannels">Generic ANT channels</h2>

<p>Connect IQ provides a low level interface for communication with ANT and ANT+ sensors. With this interface, an ANT channel can be created to send and receive ANT packets.</p>

<p>With an ANT USB dongle you can use Connect IQ ANT APIs in the Connect IQ Simulator. Note that Garmin Express will block access to the ANT USB dongle if it is running, so make sure to shut down Garmin Express when using the ANT USB dongle with the Connect IQ simulator.</p>

<h3 id="usingantstickinlinux">Using ANT stick in Linux</h3>

<p>In order to use ANT stick in Linux the usb device should be accessible to the simulator. A udev rule must be installed in the system for the ANT stick to populate with non-root privileges.</p>

<p>Find the vendor and product id for the ANT stick</p>

<pre><code class="bash">$ lsusb
</code></pre>

<p>Identify the ANT stick in the list and its vendor and product id. example:</p>

<pre><code class="bash">Bus 001 Device 009: ID 0fcf:1009 Dynastream Innovations, Inc. ANTUSB-m Stick
</code></pre>

<p>Create a udev rule for this device</p>

<pre><code class="bash">$ sudo touch /etc/udev/rules.d/50-connectiq-usbant.rules
$ sudo nano /etc/udev/rules.d/50-connectiq-usbant.rules
</code></pre>

<p>Then add the line below to the file and save the changes: CTRL-x</p>

<pre><code class="bash">ACTION==&quot;add&quot;, SUBSYSTEMS==&quot;usb&quot;, ATTRS{idVendor}==&quot;0fcf&quot;, ATTRS{idProduct}==&quot;1009&quot;, MODE=&quot;664&quot;, GROUP=&quot;plugdev&quot;
</code></pre>

<p>Restart the udev service and plug the ANT stick</p>

<pre><code class="bash">$ sudo /etc/init.d/udev restart
</code></pre>

<p>Add yourself to the &#8216;plugdev&#8217; group</p>

<pre><code class="bash">$ sudo usermod -a -G plugdev &lt;userName&gt;
</code></pre>

<h2 id="communicatingwithatempesensor">Communicating with a Tempe Sensor</h2>

<p>The Environment Profile is supported by sensors like the Garmin tempe™ wireless environment sensor and makes it possible to read the minimum, maximum and current temperature.</p>

<p>We can initialize an ANT channel to a tempe sensor with the following:</p>

<pre><code class="typescript">    // Constructor
    function initialize() {
        // Get the channel
        chanAssign = new Ant.ChannelAssignment(
            Ant.CHANNEL_TYPE_RX_NOT_TX,
            Ant.NETWORK_PLUS);
        GenericChannel.initialize(method(:onMessage), chanAssign);

        // Set the configuration
        deviceCfg = new Ant.DeviceConfig( {
            :deviceNumber =&gt; 0,                 //Wildcard our search
            :deviceType =&gt; DEVICE_TYPE,
            :transmissionType =&gt; 0,
            :messagePeriod =&gt; PERIOD,
            :radioFrequency =&gt; 57,              //Ant+ Frequency
            :searchTimeoutLowPriority =&gt; 10,    //Timeout in 25s
            :searchTimeoutHighPriority =&gt; 2,    //Timeout in 5s
            :searchThreshold =&gt; 0} );           //Pair to all transmitting sensors
        GenericChannel.setDeviceConfig(deviceCfg);

        data = new TempeData();
        searching = true;
    }

</code></pre>

<p>This code sets up the ANT channel assignment and sets device config and passes them to the base <code>GenericChannel</code> class. The device config is set to wildcard search to find any environment sensor. The initializer also sets up the <code>onMessage</code> method to handle incoming packets.</p>

<pre><code class="typescript">    // Handle incoming information
    function onMessage(msg) {
        // Parse the payload
        var payload = msg.getPayload();

        if( Ant.MSG_ID_BROADCAST_DATA == msg.messageId ) {
            if( TempeDataPage.PAGE_NUMBER == (payload[0].toNumber() &amp; 0xFF) ) {
                // Were we searching?
                if(searching) {
                    searching = false;

                    // Update our device configuration primarily to see
                    // the device number of the sensor we paired to
                    deviceCfg = GenericChannel.getDeviceConfig();
                }
                var dp = new TempeDataPage();
                dp.parse( msg.getPayload(), data );
                tempDataAvailable = true;
                // Check if the data has changed and we need to update the ui
                if( pastEventCount != data.eventCount ) {
                    pastEventCount = data.eventCount;
                }
            }
        } // end broadcast data

        else if( Ant.MSG_ID_CHANNEL_RESPONSE_EVENT == msg.messageId ) {
            if( Ant.MSG_ID_RF_EVENT == (payload[0] &amp; 0xFF) ) {
                if( Ant.MSG_CODE_EVENT_CHANNEL_CLOSED == (payload[1] &amp; 0xFF) ) {
                    open();
                }
                else if( Ant.MSG_CODE_EVENT_RX_FAIL_GO_TO_SEARCH  == (payload[1] &amp; 0xFF) ) {
                    searching = true;
                }
            }
            else{
                //It is a channel response.
            }
        } // end channel response event

    } // end on message

</code></pre>

<p>The callback handles pairing with a nearby sensor, and handing incoming packets.</p>

<p>The MO2Display sample provides a sample application that implements the Muscle Oxygen ANT profile. The ANT Generic interface is not available to watch faces. Low and high priority search timeout for sensors differs from the basic ANT radio specification to allow for interoperation with native ANT behavior on devices. These are limited to a maximum timeout of 30 seconds and 5 seconds respectively.</p>

<h2 id="burstdataconnectiq2.2">Burst Data (Connect IQ 2.2)</h2>

<p>Burst data transmission provides a mechanism for large amounts of data to be sent between devices over an ANT Generic Channel. Developers are notified through a listener of the success/failure of burst transmit/receive events. Burst data transmission is limited to up to 8Kb of data at a time.</p>

<p>Common use cases for this include passkey authentication or sending/receiving configuration data between devices.</p>

<p>The <code>GenericChannelBurst</code> sample provides a demonstration of transmitting and receiving burst data.</p>

<h2 id="antprofilesconnectiq2.2">ANT+ Profiles (Connect IQ 2.2)</h2>

<p>The <code>AntPlus</code> module allows access to information about ANT+ sensors that are paired to a user&#8217;s device without requiring you to set up and manage the ANT channel yourself. All management of ANT+ sensors such as adding, removing, enabling, disabling, and calibrating is managed by the user via the device&#8217;s regular sensor menus.</p>

<p>An extension of a sensor-specific listener is passed into the constructor for a sensor-specific extension of <code>Device</code>. If there is a sensor of the given type paired to the user&#8217;s device, information about that sensor can be retrieved using the sensor-specific getters, or through the common data getters such as <code>GetBatteryStatus(identifier)</code>. Null can be passed in as the identifier for sensor types (like most) that do not support multi-components.</p>

<p>Callbacks in the <code>DeviceListener</code> and extensions of it will be called automatically if a sensor of the given type is paired and the corresponding information is updated via ANT. For example, <code>onDeviceStateUpdate()</code> will be called if a sensor&#8217;s ANT channel goes from connected to searching, or if the user switches the sensor ID of a given type that their device is connected to. Callbacks like <code>onCalculatedPowerUpdate()</code> will be called when new pieces of information about a power sensor are received via ANT.</p>

<p>Certain ANT+ sensors, such as bike lights, have special callbacks. For example, the <code>onLightNetworkStateUpdate()</code> callback should be used to understand the light network&#8217;s state rather than <code>onDeviceStateUpdate()</code>. The <code>LightNetwork</code> class will allow you to make changes to bike light modes, given there are bike lights paired to the user&#8217;s device and a light network is fully formed.</p>

<p>Not all ANT+ profiles provisioned by Monkey C will be supported by every Connect IQ-compatible device.</p>

<p>[^]:</p>

<h1 id="gettingstartedwithconnectiqbledevelopment">Getting Started with Connect IQ BLE Development</h1>

<p>Starting with Connect IQ version 3.1.0, developers have the ability to communicate directly with devices via the Bluetooth Low Energy wireless communication protocol. This has opened up a whole new world of possibilities for what can be done with Connect IQ. For the uninitiated, the setup process to get started can seem quite daunting. The purpose of this setup guide is to help lighten the load to get developers off the ground as quickly as possible.</p>

<h2 id="resources">Resources</h2>

<p>When going through this guide, developers will want to keep a few things handy.</p>

<ul>
<li><p><strong>Connect IQ BLE API Documentation</strong></p>

<p>Having the <a href="https://developer.garmin.com/connect-iq/api-docs/">API Documentation</a> close by will be critical (especially in the later steps of this document).</p></li>
<li><p><strong>Nordic nRF52 DK</strong></p>

<p>The Connect IQ team has built out the Connect IQ SDK tools to be compatible with the <a href="https://www.nordicsemi.com/Software-and-Tools/Development-Kits/nRF52-DK">Nordic nRF52 DK</a> Bluetooth 5 and Bluetooth mesh Development Kit for nRF52810.</p></li>
</ul>
<!--    and nRF52832 SoCs and the Nordic [nRF52840 Dongle][dongle]. -->

<ul>
<li><p><strong>Nordic Documentation Page</strong></p>

<p>The <a href="https://www.nordicsemi.com/DocLib?Product=nRF52832%20core%20documentation&amp;tags=nRF52832%2CnRF52+DK">Nordic Documentation</a> has links to all of the resources needed to use the nRF52 DK.</p></li>
<li><p><strong>nRF Connect For Desktop</strong></p>

<p>The <a href="https://www.nordicsemi.com/Software-and-Tools/Development-Tools/nRF-Connect-for-desktop">nRF Connect For Desktop</a> application allows developers to flash new firmware to the board, monitor connections, etc. This software is necessary to program the board to work correctly with the Connect IQ simulator.</p></li>
<li><p><strong>An up-to-date Connect IQ SDK</strong></p>

<p>To use the BLE APIs, developers should be working with the current version of the Connect IQ SDK.</p></li>
<li><p><strong>Firmware for the nRF52 DK</strong></p>

<p>The memory layout of the nRF52 DK will need to be flashed to a different firmware for use with the Connect IQ SDK. The correct firmware for the development environment has been provided: <a href="https://developer.garmin.com/connect-iq/connectivity_2.0.1_115k2_with_s132_5.0.zip">nRF52 DK firmware</a></p>
<!--* [nRF52840 Dongle firmware][Dongle_firmware]--></li>
</ul>

<h2 id="windows">Windows</h2>

<p>The drivers and applications needed to communicate with the nRF52 DK are all included in the installation of <a href="https://www.nordicsemi.com/Software-and-Tools/Development-Tools/nRF-Connect-for-desktop">nRF Connect for Desktop</a> for the Windows platform. Once this application is installed along with the necessary drivers, the nRF52 DK should be found by the nRF Connect for Desktop application.</p>

<p>At this point, proceed to the <a href="#Using-Nordic-nRF-Connect">Using Nordic nRF Connect</a> section.</p>

<h2 id="mac">Mac</h2>

<p>When using macOS, developers will need to manually install the JLink/JTrace USB drivers to communicate with the nRF52 DK board. To do so, download and install the Segger JLink installer <a href="https://www.segger.com/downloads/jlink/JLink_MacOSX_V622g.pkg">package 6.22g</a> for Mac.</p>

<p>Once this is completed, developers will need to install the <a href="https://www.nordicsemi.com/Software-and-Tools/Development-Tools/nRF-Connect-for-desktop">nRF Connect for Desktop</a> for Mac.</p>

<p>At this point, proceed to the <a href="#Using-Nordic-nRF-Connect">Using Nordic nRF Connect</a> section.</p>

<h2 id="linux">Linux</h2>

<p>When using Linux, developers will need to manually install the JLink/JTrace USB drivers to communicate with the nRF52 DK board. To do so, download and install using the appropriate Segger JLink installer for Linux:</p>

<ul>
<li>32-bit: <a href="https://www.segger.com/downloads/jlink/JLink_Linux_V622g_i386.deb">JLink_6.22g - 32</a></li>
<li>64-bit: <a href="https://www.segger.com/downloads/jlink/JLink_Linux_V622g_x86_64.deb">JLink_6.22g - 64</a></li>
</ul>

<p>Once this is completed developers will need to install the <a href="https://www.nordicsemi.com/Software-and-Tools/Development-Tools/nRF-Connect-for-desktop">nRF Connect for Desktop</a> for Linux.</p>

<p>At this point, proceed to the <a href="#Using-Nordic-nRF-Connect">Using Nordic nRF Connect</a> section.</p>

<h2 id="usingnordicnrfconnect">Using Nordic nRF Connect</h2>

<p>The nRF Connect Desktop application will need to be installed. Please see the above sections for the appropriate links.</p>

<ol>
<li><p>Once installed, launch the application. Click <em>Add/remove apps</em>:
<figure>
<img src="resources/programmers-guide/nRFConnectLaunch.png" style="max-width:450px;" title="The nRF Connect Desktop Launch Screen" />
</figure></p></li>
<li><p>Install the <em>Programmer</em> app.</p></li>
<li><p>Click <em>Launch App</em>.</p></li>
<li><p>Plug in the nRF52 board.</p></li>
<li><p><em>Launch</em> the <em>Programmer</em> app.
<figure>
<img src="resources/programmers-guide/nRFConnectProgrammerLaunch.png" style="max-width:450px;" title="Launching the Programmer App" />
</figure></p></li>
<li><p>Near the top left, click <em>Select device</em>.</p></li>
<li><p>Select the correct device.</p></li>
<li><p>Click <em>Read</em> to see the Memory Layout of the connected device.<a href="#fn:5" id="fnref:5" title="see footnote" class="footnote">[5]</a></p></li>
<li><p>Drag and drop or click <em>Add HEX file</em> to prepare the desired Memory Layout with the proper <code>.hex</code> file.
<figure>
<img src="resources/programmers-guide/nRFConnectPrepMemoryLayout.png" style="max-width:450px;" title="Launching the Programmer App" />
</figure></p></li>
<li><p>Click <em>Erase &amp; write</em> to flash the new memory layout.
<figure>
<img src="resources/programmers-guide/nRFConnectWriteMemoryLayout.png" style="max-width:450px;" title="Launching the Programmer App" />
</figure></p></li>
</ol>

<h2 id="findingthecomport">Finding The COM Port</h2>

<p>Now that the board is properly communicating with the computer, it&#8217;s time to figure out which port it&#8217;s utilizing.</p>

<h3 id="windows">Windows</h3>

<p>Open up Device Manager and find your device under <code>Ports</code>.</p>

<p>It will look something like this:
<figure>
<img src="resources/programmers-guide/nRFJLinkDevMgr.png" style="max-width:450px;" title="nRF52 DK JLink in Device Manager" />
</figure></p>

<p>The communications port is listed in parentheses. In the example above the communications port is <code>COM4</code>. Copy this to be used in a later step and proceed to <a href="#setting-the-com-port">Setting the COM Port</a>.</p>

<h3 id="mac">Mac</h3>

<p>Open up a terminal and type:</p>

<pre><code>ls /dev/tty.usbmodem*
</code></pre>

<p>then press <code>Tab</code>. This should list out the port information in the format <code>/dev/tty.usbmodem&lt;number&gt;</code>. Copy this to be used in a later step and proceed to <a href="#setting-the-com-port">Setting the COM Port</a>.</p>

<h3 id="linux">Linux</h3>

<p>Open up a terminal and type:</p>

<pre><code>ls /dev/ttyACM*
</code></pre>

<p>then press <code>Tab</code>. This should list out the port information in the format <code>/dev/ttyACM&lt;number&gt;</code>. Copy this to be used in a later step and proceed to <a href="#setting-the-com-port">Setting the COM Port</a>.</p>

<h3 id="settingthecomport">Setting the COM Port</h3>

<p>At this point the nRF52 is properly communicating with the development environnement and the com port information has been retrieved. The final step is to set the COM port in the Connect IQ Simulator.</p>

<ol>
<li><p>Launch the simulator via Eclipse or command line tools.</p></li>
<li><p>Select <em>Settings</em> &gt; <em>BLE Settings</em></p></li>
<li><p>In the dialog box, enter the COM port information from <a href="#finding-the-com-port">Finding the COM Port</a>.
<figure>
<img src="resources/programmers-guide/nRFSetComPortSim.png" style="max-width:450px;" title="Set the COM Port in Connect IQ Simulator" />
</figure></p></li>
<li><p>Click <em>OK</em>.</p></li>
</ol>

<p>It&#8217;s possible that developers might encounter an error. This is likely due to a failure to set the COM Port for the Connect IQ simulator. If an error occurs, then developers have a few things they can check.</p>

<ol>
<li><strong>Double check the COM Port assignment:</strong> Follow the steps for the correct environment to <a href="#finding-the-com-port">find</a> and confirm the COM Port.</li>
<li><strong>Ensure there are no copy/paste errors:</strong> Double check the information entered when <a href="#setting-the-com-port">setting the COM Port</a>.</li>
</ol>

<p>That&#8217;s it! If all goes well, then the Connect IQ Simulator will use the nRF52 DK board BLE chipset to communicate with nearby BLE devices per the Connect IQ Bluetooth Low Energy APIs. For more information on the APIs, please refer to the <a href="https://developer.garmin.com/connect-iq/api-docs/">API documentation</a> and sample applications included in the Connect IQ SDK.</p>

<h1 id="sensors">Sensors</h1>

<p>The <code>Sensor</code> module allows the app to enable and receive information from Garmin ANT+ sensors. To receive information, a listener method must be assigned and the sensors enabled:</p>

<pre><code class="java">function initialize() {
    Sensor.setEnabledSensors( [Sensor.SENSOR_HEARTRATE] );
    Sensor.enableSensorEvents( method( :onSensor ) );
}

function onSensor(sensorInfo) {
    System.println( &quot;Heart Rate: &quot; + sensorInfo.heartRate );
}
</code></pre>

<p>Sensor information is packaged in the <code>Sensor.Info</code> object:</p>

<pre><code class="java">// The Sensor.Info class contains all information necessary for the Sensor.
// It can be passed on the update or it can be retrieved on demand.
class Info
{
    var speed;          // Speed in meters per second
    var cadence;        // Cadence in revolutions per minute
    var heartRate;      // HR in beats per minute
    var temperature;    // Temperature in degrees Centigrade
    var altitude;       // Altitude in meters
    var pressure;       // Pressure in Pa
    var heading;        // Heading in Radians
}
</code></pre>

<p>The simulator can simulate sensor data via the <em>Simulation</em> menu by selecting <em>Fit Data</em> &gt; <em>Simulate Data</em>. This generates valid but random values that can be read in via the sensor interface. For more acuate simulation, the simulator can play back a FIT file and feed the input into the <code>Sensor</code> module. To do this, select <em>Simulation</em> &gt; <em>Fit Data</em> &gt; <em>Playback File</em> and choose a FIT file from the dialog.</p>

<h2 id="accelerometerdataconnectiq2.3">Accelerometer Data (Connect IQ 2.3)</h2>

<p>The Sensor module now contains the ability to fetch samples of accelerometer data for a defined period of time with a certain frequency. This feature enables developers to implement their own custom motion detection algorithms within a Connect IQ application.</p>

<p>Accelerometer data can be obtained by registering a sensor data listener, which provides sampling parameters as well as a user-defined callback method that will be executed when new data is available. Sensor data requests are managed via the following new Sensor module methods and classes:</p>

<pre><code class="java">
class SensorData
{
    // An AccelerometerData object.
    var accelerometerData;
}

class AccelerometerData
{
    // Array of sample x coordinates as floating point values.
    var x;

    // Array of sample y coordinates as floating point values.
    var y;

    // Array of sample z coordinates as floating point values.
    var z;

    // Array of sample pitch values. Can be null if pitch was not requested.
    var pitch;

    // Array of sample roll values. Can be null if roll was not requested.
    var roll;

    // Array of sample vector power values. Can be null if power was not requested.
    var power;
}

// Register a callback to fetch data from various sensors (currently only accelerometer data is supported)
function registerSensorDataListener(listener, options);

// Deregister a previously registered data request
function unregisterSensorDataListener();

// Get the maximum sample rate supported by the system
function getMaxSampleRate();

</code></pre>

<p>Calling registerSensorDataListener() will enable your application to receive accelerometer data via the callback that you provide. The type and amount of data provided is configured via the options dictionary parameter, which supports the following fields:</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Option</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">:period</td>
	<td style="text-align:left;">A Number representing the period of time to request samples in seconds. Maximum is 4 seconds.</td>
</tr>
<tr>
	<td style="text-align:left;">:sampleRate</td>
	<td style="text-align:left;">A Number representing the samples per second in Hz. Use getMaxSampleRate() to determine what the system can support.</td>
</tr>
<tr>
	<td style="text-align:left;">:enableAccelerometer</td>
	<td style="text-align:left;">Set to true to fetch data from the accelerometer</td>
</tr>
<tr>
	<td style="text-align:left;">:includePower</td>
	<td style="text-align:left;">Valid when :enableAccelerometer set to true. Requests that the power array be computed. Default false</td>
</tr>
<tr>
	<td style="text-align:left;">:includePitch</td>
	<td style="text-align:left;">Valid when :enableAccelerometer set to true. Requests that pitch array be computed. Default false</td>
</tr>
<tr>
	<td style="text-align:left;">:includeRoll</td>
	<td style="text-align:left;">Valid when :enableAccelerometer set to true. Requests that roll array be computed. Default false</td>
</tr>
</tbody>
</table>

<p>Additionally, you must provide a callback method that accepts a single parameter, which is invoked by the system when new data is available. This method is passed a SensorData object populated with the requested sensor data. Note that only a single sensor data request can be active at any given time, so if you wish to submit a request while an existing one is active, you must first call unregisterSensorDataListener(). After registerSensorDataListener() is called, the callback that you provided will be invoked whenever a new set of samples are available. For example, if you request four seconds worth of data at 25Hz, the callback will be invoked every 100 samples taken.</p>

<p>A simplified usage example can be found below (for a more detailed sample see the <code>PitchCounter</code> sample app distributed with the SDK).</p>

<pre><code class="java">
using Toybox.Sensor;

class MyAccelHistoryClass
{
    hidden var mSamplesX = null;
    hidden var mSamplesY = null;
    hidden var mSamplesZ = null;

    // Initializes the view and registers for accelerometer data
    function enableAccel() {
        var maxSampleRate = Sensor.getMaxSampleRate();

         // initialize accelerometer to request the maximum amount of data possible
        var options = {:period =&gt; 4000, :sampleRate =&gt; maxSampleRate, :enableAccelerometer =&gt; true};
        try {
            Sensor.registerSensorDataListener(method(:accelHistoryCallback), options);
        }
        catch(e) {
            System.println(e.getErrorMessage());
        }
    }

    // Prints acclerometer data that is recevied from the system
    function accelHistoryCallback(sensorData) {
        mSamplesX = sensorData.accelerometerData.x;
        mSamplesY = sensorData.accelerometerData.y;
        mSamplesZ = sensorData.accelerometerData.z;

        Toybox.System.println(&quot;Raw samples, X axis: &quot; + mSamplesX);
        Toybox.System.println(&quot;Raw samples, Y axis: &quot; + mSamplesY);
        Toybox.System.println(&quot;Raw samples, Z axis: &quot; + mSamplesZ);
    }

    function disableAccel() {
        Sensor.unregisterSensorDataListener();
    }
}

</code></pre>

<h3 id="filteringaccelerometerdata">Filtering Accelerometer Data</h3>

<p>When processing accelerometer data, you may wish to apply filters to the raw sensor input that your application receives. IIR and FIR filter objects are provided to aid the developer in sample filtering. The following new objects have been added to the Math module:</p>

<pre><code class="java">
module Math
{
    class FirFilter extends Filter
    {
        // Initialize the FIR filter
        function initialize(dictionary);

        // Apply the FIR filter to an array of samples
        function apply(data);
    }

    class IirFilter extends Filter
    {
        // Initialize the IIR filter
        function initialize(dictionary);

        // Apply the IIR filter to an array of samples
        function apply(data);
    }
}

</code></pre>

<p>Each filter class requires coefficients to be provided, which is done via the dictionary parameter. The options supported by each filter class are as follows:</p>

<p><strong>FIR Filter</strong></p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Option</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">:coefficients</td>
	<td style="text-align:left;">An array of float values that specify the filter coefficients. This can also be a resource ID referring to an embedded JSON resource that defines the array of values.</td>
</tr>
<tr>
	<td style="text-align:left;">:gain</td>
	<td style="text-align:left;">A float value that specifies a multiplier to be applied to the coefficients.</td>
</tr>
</tbody>
</table>

<p><strong>IIR Filter</strong></p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Option</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">::coefficientList1</td>
	<td style="text-align:left;">An array of float values that specify the filter coefficients. This can also be a resource ID referring to an embedded JSON resource that defines the array of values.</td>
</tr>
<tr>
	<td style="text-align:left;">:coefficientList2</td>
	<td style="text-align:left;">An array of float values that specify the filter coefficients. This can also be a resource ID referring to an embedded JSON resource that defines the array of values.</td>
</tr>
<tr>
	<td style="text-align:left;">:gain</td>
	<td style="text-align:left;">A float value that specifies a multiplier to be applied to the coefficients.</td>
</tr>
</tbody>
</table>

<p>Once the filter object has been constructed, the apply function can be called, passing in an array of samples, and an array containing the filtered results will be returned.</p>

<p>A simplified usage example can be found below (for a more detailed sample see the PitchCounter sample app distributed with the SDK).</p>

<pre><code class="java">using Toybox.Sensor;

class MyAccelHistoryClass
{
    hidden var mFilter = null;
    hidden var mSamplesX = null;
    hidden var mSamplesY = null;
    hidden var mSamplesZ = null;

    function initialize() {
        mFilter = new Sensor.FirFilter({:coefficients=&gt;[0.22,0.12,0.55], :gain=&gt;1.2);
    }
    // Initializes the view and registers for accelerometer data
    function enableAccel() {
        var maxSampleRate = Sensor.getMaxSampleRate();

         // initialize accelerometer to request the maximum amount of data possible
        var options = {:period =&gt; 4000, :sampleRate =&gt; maxSampleRate, :enableAccelerometer =&gt; true};
        try {
            Sensor.registerSensorDataListener(method(:accelHistoryCallback), options);
        }
        catch(e) {
            System.println(e.getErrorMessage());
        }
    }

    // Prints acclerometer data that is recevied from the system
    function accelHistoryCallback(sensorData) {
        mSamplesX = mFilter.apply(sensorData.accelerometerData.x);
        mSamplesY = sensorData.accelerometerData.y;
        mSamplesZ = sensorData.accelerometerData.z;

        Toybox.System.println(&quot;Filtered samples, X axis: &quot; + mSamplesX);
        Toybox.System.println(&quot;Raw samples, Y axis: &quot; + mSamplesY);
        Toybox.System.println(&quot;Raw samples, Z axis: &quot; + mSamplesZ);
    }

    function disableAccel() {
        Sensor.unregisterSensorDataListener();
    }
}
</code></pre>

<h3 id="loggingaccelerometerdata">Logging Accelerometer Data</h3>

<p>Accelerometer data can also be logged by the device, and can be played back in the simulator for testing applications that use the Accelerometer Data feature. Logging accelerometer data is done by passing a SensorLogger object to a FIT recording session.</p>

<pre><code class="java">
module SensorLogging
{
    class SensorLoggingStats
    {
        var sampleCount;  // The total number of samples logged thus far
        var samplePeriod; // The total number of seconds of data logged thus far
    }

    class SensorLogger
    {
        function initialize(options);

        function getStats();
    }
}

</code></pre>

<p>The SensorLogger object with the same options provided to the Sensor.registerSensorDataListener() method. However, the logger will always record at a standard rate for consumption by the simulator.</p>

<p>A simplified usage example can be found below (for a more detailed sample see the PitchCounter sample app distributed with the SDK).</p>

<pre><code class="java">
function initialize() {
    mLogger = new SensorLogging.SensorLogger({:enableAccelerometer =&gt; true});
    mSession = Fit.createSession({:name=&gt;&quot;mySession&quot;, :sport=&gt;Fit.SPORT_GENERIC, :sensorLogger =&gt; mLogger});
}

function startLogging() {
    mSession.start();
}

function stopLogging() {
    mSession.stop();
}

function saveLogging() {
    mSession.save();
}

</code></pre>

<h2 id="sensorhistoryconnectiq2.1">Sensor History (Connect IQ 2.1)</h2>

<p>The <code>SensorHistory</code> module allows the app to access saved sensor history on the device. Data from sensors can be accessed by getting an iterator.</p>

<pre><code class="java">function getHeartRateHistory(options);
function getTemperatureHistory(options);
function getPressureHistory(options);
function getElevationHistory(options);
</code></pre>

<p>All Sensor History types are not available on all devices. Capabilities should be validated using the &#8216;has&#8217; operator. The get functions will return a SensorHistoryIterator type.</p>

<pre><code class="java">class SensorHistoryIterator {
    function next();
    function getMax();
    function getMin();
    function getNewestSampleTime();
    function getOldestSampleTime();
}
</code></pre>

<p>Calling the next() function will iterate through the history values until the end of the data is reached. When there is no more data the iterator will return null. This function returns a <code>SensorSample</code>:</p>

<pre><code class="java">class SensorSample {

    var data; // Sample data. Can be null if not valid
    var when; // The time this sample occurred
}
</code></pre>

<p>The iterator can be adjusted to provide the newest data values first or the oldest values first by using the enumeration values <code>ORDER_NEWEST_FIRST</code> and <code>ORDER_OLDEST_FIRST</code></p>

<h1 id="positioning">Positioning</h1>
<figure>
<img src="resources/programmers-guide/archy-monkey.png" style="max-width:300px;" title="Geocache Jones remembered to stop at three movies." />
</figure>

<p>Monkey C provides access to the wearable&#8217;s available sensors, which may include the GPS, altimeter, thermometer, and supported ANT sensors.</p>

<h2 id="location">Location</h2>

<p>A <code>Location</code> is an abstraction of a coordinate. It exposes the ability to retrieve the coordinates in radians or decimal degrees and then provides a method to convert to coordinate formats supported by the Garmin system. The <code>Position</code> module also exposes string parsing interface to convert from various coordinate formats to a <code>Location</code> object.</p>
<!-- TODO: Talk about the difference between a position and a location -->

<pre><code class="java">// The GEO enum is used to retrieve coordinates in various String representations.
enum
{
    GEO_DEG,    // Degree Format, ddd.dddddd: 38.278652
    GEO_DM,     // Degree/Minute Format, dddmm.mmm: 38 27.865'
    GEO_DMS,    // Degree/Minute/Seconds Format, dddmmss: 38 27' 8&quot;
    GEO_MGRS    // Military Grid Reference System (MGRS): 4QFJ12345678
}

// The Location object represents a position. It provides accessor
// methods for retrieving the coordinates in various formats.
class Location
{
    // Constructor: create a coordinate based off an options hash table
    // @param [Dictionary] options Hash table of options
    // @option options [Number] :latitude The latitude
    // @option options [Number] :longitude The longitude
    // @option options [Symbol] :format The format of lat/long (possible
    //        values are :degrees, :radians, or :semicircles)
    function initialize( options );

    // Use toDegrees() to retrieve the coordinate back as an Array of degree values.
    // @return [Array] An Array of the latitude and the longitude in degree format
    function toDegrees();

    // Use toRadians() to retrieve the coordinate back as an Array of radian values.
    // @return [Array] An Array of the latitude and the longitude in radian format
    function toRadians();

    // Use toGeoString() to get a String representation of the coordinate.
    // @param format Coordinate format to which coordinate should be
    //      converted (GEO constant)
    // @return [String] Formatted coordinate String
    function toGeoString( format );
}
</code></pre>

<h2 id="locationevents">Location Events</h2>

<p>To enable the GPS call the <code>enableLocationEvents()</code> method. The parameters are outlined below:</p>

<pre><code class="java">enum
{
    LOCATION_ONE_SHOT,      // One-time retrieval of Location
    LOCATION_CONTINUOUS,    // Register for Location updates
    LOCATION_DISABLE        // Unregister for Location updates
}

// Request a location event with enableLocationEvents().
// @param type LOCATION_ONE_SHOT for a single location request,
//       LOCATION_CONTINUOUS to enable location tracking, and
//       LOCATION_DISABLE to turn off location tracking
// @param [Method] listener Method object to call with location updates
function enableLocationEvents( type, listener );
</code></pre>

<p>To register a position listener, use the <code>method()</code> call to create a <code>Method</code> callback:</p>

<pre><code class="java">function onPosition( info ) {
    Sys.println( &quot;Position &quot; + info.position.toGeoString( Position.GEO_DM ) );
}

function initializeListener() {
    Position.enableLocationEvents( Position.LOCATION_CONTINUOUS, method( :onPosition ) );
}
</code></pre>

<p>All of the location information will be sent in an <code>Info</code> object:</p>

<pre><code class="java">// The Location.Info class contains all information necessary for the Location.
// It can be passed on the update or it can be retrieved on demand.
class Info
{
    var position;   // Lat/lon
    var speed;      // Speed in meters per second
    var altitude;   // Altitude in meters, mean sea level
    var accuracy;   // Accuracy - good, usable, poor, not available
    var heading;    // Heading in radians
    var when;       // Moment Object: GPS time stamp of fix
}

// Use getInfo() to retrieve the current Location.Info
// @return [Location.Info] The Info object containing the current information
function getInfo();
</code></pre>

<h1 id="activityrecording">Activity Recording</h1>

<p>Imagine that you are trying to create a yoga app. You&#8217;d like the app to record heart rate and calories burned during your yoga workout, just like other Garmin apps. You&#8217;d also like the recording to be dispayed on [Garmin Connect][Garmin_Connect]. Monkey C allows for apps to start and stop recording of FIT files. Controlling the FIT file recording requires a few steps:</p>

<ol>
<li>Enable the sensors to be recorded</li>
<li>Use <code>Fit.createSession(options)</code> to create a session object</li>
<li>Use the <code>start()</code> method of the FIT session to begin recording. Data from the enabled sensors will be recorded into the FIT file.</li>
<li>Use <code>stop()</code> to pause the recording</li>
<li>Use <code>save()</code> to save the recording, or <code>discard()</code> to delete the recording</li>
</ol>

<p>The FIT file will sync with [Garmin Connect][Garmin_Connect]. You can use the [Garmin Connect API][Garmin_Connect_API] to process the FIT file from a web service.</p>

<h2 id="recordingfitfiles">Recording FIT Files</h2>

<p>In addition to being able to play back existing FIT files, the simulator can also record files using data obtained via the <em>Fit Data</em>&gt;<em>Simulate Data</em> menu option. To begin recording a session you must start the timer; this can be done via the <em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Start Activity</em> menu option, or by clicking the corresponding start button on the device you have selected. The following table describes the different options available for activity recording and provides instructions for how to access them via the menu bar, or the device buttons (where available).</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Option</th>
	<th style="text-align:left;">Menu Button</th>
	<th style="text-align:left;">Device Button</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Start Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Start Activity</em></td>
	<td style="text-align:left;">Start Button</td>
	<td style="text-align:left;">The device start button starts and stops an activity.</td>
</tr>
<tr>
	<td style="text-align:left;">Stop Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Stop Activity</em></td>
	<td style="text-align:left;">Start Button</td>
	<td style="text-align:left;">The device start button starts and stops an activity, and the <em>Start Activity</em> menu item is renamed to <em>Stop Activity</em> when recording is active.</td>
</tr>
<tr>
	<td style="text-align:left;">Lap Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Lap Activity</em></td>
	<td style="text-align:left;">Back Button</td>
	<td style="text-align:left;">Records a lap record in the FIT file.</td>
</tr>
<tr>
	<td style="text-align:left;">Pause Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Pause Activity</em></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Pauses activity recording. Note this option is only available when FIT data simulation is enabled.</td>
</tr>
<tr>
	<td style="text-align:left;">Resume Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Resume Activity</em></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Resumes activity recording. Note this option is only available when FIT data simulation is enabled and activity recording is paused.</td>
</tr>
<tr>
	<td style="text-align:left;">Discard Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Discard Activity</em></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Discards the current recording and deletes the corresponding .fit file. Note this is only enabled if activity recording has been started and subsequently stopped.</td>
</tr>
<tr>
	<td style="text-align:left;">Save Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Save Activity</em></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Saves the recorded activity into a .fit file and resets the timer state. Note this is only enabled if activity recording has been started and subsequently stopped.</td>
</tr>
</tbody>
</table>

<p>Note: the device simulator will not automatically start activity recording when a data field is being run. You must excplitily start and stop activity recording via the menu options described here.</p>

<h2 id="fitdeveloperfields">FIT Developer Fields</h2>

<p>Now imagine you want to add a new metric - Namastes - to the Yoga app<a href="#fn:6" id="fnref:6" title="see footnote" class="footnote">[6]</a>. This metric will combine heart rate, accelerometer, and other sensor data into a single value, and does not have an analog in any Garmin recording metric. To do this we need the <code>FitContributor</code> API, which allows you to add new metrics to a FIT recording and display it on [Garmin Connect][Garmin_Connect].</p>

<p>First, you must enable the <code>FitContributor</code> permission in the manifest file. Next, you need to add your field definitions in your resources using the <code>fitContributions</code> block:</p>

<pre><code class="xml">    &lt;strings&gt;
        &lt;string id=&quot;namaste_label&quot;&gt;Namastes&lt;/string&gt;
        &lt;string id=&quot;namaste_graph_label&quot;&gt;Namastes&lt;/string&gt;
        &lt;string id=&quot;namaste_units&quot;&gt;N(s)&lt;/string&gt;
    &lt;/strings&gt;
    &lt;fitContributions&gt;
        &lt;fitField id=&quot;0&quot; displayInChart=&quot;true&quot; sortOrder = &quot;0&quot; precision=&quot;2&quot;
        chartTitle=&quot;@Strings.namaste_graph_label&quot; dataLabel=&quot;@Strings.namaste_label&quot;
        unitLabel=&quot;@Strings.namaste_units&quot; fillColor=&quot;#FF0000&quot; /&gt;
    &lt;/fitContributions&gt;
</code></pre>

<p>The <code>fitField</code> block has a number of configurable options:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">A numeric value from 0 to 255 used to refer to your field</td>
	<td style="text-align:left;">No duplicates within an app are allowed</td>
</tr>
<tr>
	<td style="text-align:center;"><code>displayInChart</code></td>
	<td style="text-align:left;">Indicates whether or not record level connect IQ data should be rendered in a chart</td>
	<td style="text-align:left;"><code>true</code> if you want this entry to be displayed as a chart, <code>false</code> otherwise. Graph fields can only support numeric data.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>displayInActivityLaps</code></td>
	<td style="text-align:left;">Indicates whether or not lap level connect IQ data should be rendered in the Activity Laps section in the Garmin Connect Activity Details page</td>
	<td style="text-align:left;"><code>true</code> if you want this entry to be displayed in the activity laps, <code>false</code> otherwise</td>
</tr>
<tr>
	<td style="text-align:center;"><code>displayInActivitySummary</code></td>
	<td style="text-align:left;">Indicates whether or not activity (fit session) level connect IQ data should be rendered in the Activity Summary section in the Garmin Connect Activity Details page</td>
	<td style="text-align:left;"><code>true</code> if you want this entry to be displayed in the activity summary data, <code>false</code> otherwise</td>
</tr>
<tr>
	<td style="text-align:center;"><code>sortOrder</code></td>
	<td style="text-align:left;">Determines the order in which the Connect IQ data will appear in the Summary or Lap Sections of the Activity Details page and what order charts will be displayed on the Activity Details page</td>
	<td style="text-align:left;">No duplicates are allowed</td>
</tr>
<tr>
	<td style="text-align:center;"><code>precision</code></td>
	<td style="text-align:left;">Decimal point precision for numeric data</td>
	<td style="text-align:left;">0 for integer, 1 for one decimal point, 2 for two decimal points. Without this attribute the default is no rounding</td>
</tr>
<tr>
	<td style="text-align:center;"><code>chartTitle</code></td>
	<td style="text-align:left;">This is the resources string key to use to render the title of the chart</td>
	<td style="text-align:left;">Optional if <code>displayInChart</code> is <code>false</code>. Must be a string resource.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>dataLabel</code></td>
	<td style="text-align:left;">This is the resources string key to use to render the label of the data field in the Activity Summary or Activity Laps section of the Activity Details page (ex. Cadence, or Heart Rate).</td>
	<td style="text-align:left;">Must be a string resource</td>
</tr>
<tr>
	<td style="text-align:center;"><code>unitLabel</code></td>
	<td style="text-align:left;">This is the key to use to render the unit of the data field in the Activity Summary or Activity Laps section of the Activity Details page (ex. kph, or miles).</td>
	<td style="text-align:left;">Must be a string resource</td>
</tr>
<tr>
	<td style="text-align:center;"><code>fillColor</code></td>
	<td style="text-align:left;">RRGGBB value of color to use for chart</td>
	<td style="text-align:left;">Optional if <code>displayInChart</code> is <code>false</code></td>
</tr>
</tbody>
</table>

<p>This will communicate the metadata to display our chart to [Garmin Connect][Garmin_Connect]. Now we need to create our Field in the code. You do this by using the <code>createField</code> method of the <code>Session</code> object within your source:</p>

<pre><code class="java">// Field ID from resources.
const NAMASTE_FIELD_ID = 0;
hidden var mNamasteField;

// Initializes the new Namaste field in the activity file
function setupField(session) {
    // Create a new field in the session.
    // Current namastes provides an file internal definition of the field
    // Field id _must_ match the fitField id in resources or your data will not display!
    // The field type specifies the kind of data we are going to store. For Record data this must be numeric, for others it can also be a string.
    // The mesgType allows us to say what kind of FIT record we are writing.
    //    FitContributor.MESG_TYPE_RECORD for graph information
    //    FitContributor.MESG_TYPE_LAP for lap information
    //    FitContributor.MESG_TYPE_SESSION` for summary information.
    // Units provides a file internal units field.
    mNamasteField = session.createField(&quot;current_namastes&quot;, NAMASTE_FIELD_ID, FitContributor.DATA_TYPE_FLOAT, { :mesgType=&gt;Fit.MESG_TYPE_RECORD, :units=&gt;&quot;N&quot; });
}
</code></pre>

<p>Now when you call <code>setData</code> on <code>mNamasteField</code> the value will be recorded into either the Record, Lap, or Session information of the FIT file based on the message type specified when calling <code>createField</code>. If you are creating a Record (graph), you should update this value once a second. For lap and summary, you should provide constant updates to the current lap or workout value for the metric.</p>

<p>After setting this up, you will want to preview how this will look on [Garmin Connect][Garmin_Connect]. We can use the Monkeygraph tool to create a preview. The Monkeygraph tool requires the following: a FIT file with the recorded developer data, and an IQ file of the app (you can acquire an IQ file via the <a href="#exportingtheapp">App Export Wizard</a>). The tool will allow you to test how charts will look before uploading your app for review. See how to launch the Monkeygraph tool included with the SDK.</p>

<h1 id="shareablelibraries">Shareable Libraries</h1>

<p>Developers can create custom Monkey C libraries, called Monkey Barrels, that contain source code and resource information that are easily shared across Connect IQ Projects.</p>

<p>Monkey Barrels provide an easy way to store and reuse common code and resources that developers find useful. For example, many developers want a quick way to calculate time to sunrise or sunset. With Monkey Barrels, developers can store this code along with other common code and pull it into their various projects when useful. This saves time and effort allowing developers the ability to have maximum creativity.</p>

<h2 id="makingamonkeybarrel">Making a Monkey Barrel</h2>

<p>From the Eclipse Plugin, Barrels can be created as a new project type:</p>

<ol>
<li>Select <em>File &gt; New &gt; Project &gt; Connect IQ &gt; Monkey Barrel</em></li>
<li>Set Project name and select <em>Next</em>
<figure>
<img src="resources/programmers-guide/barrel_name_eclipse.png" style="max-width:450px;" title="Monkey Barrel Project Name" />
</figure>
<div class="note">The project name will be the Barrel&#8217;s namespace and all code must live within it.</div></li>
<li>Set the <em>Monkey Barrel Version</em> number, <em>Minimum SDK Version</em>, and click <em>Next</em>
<figure>
<img src="resources/programmers-guide/barrel_version_eclipse.png" style="max-width:450px;" title="Monkey Barrel Version Numbers" />
</figure></li>
<li>Select <em>Supported Devices</em> and click <em>Next</em>
<figure>
<img src="resources/programmers-guide/barrel_devices_eclipse.png" style="max-width:450px;" title="Monkey Barrel Supported Devices" />
</figure>
<div class="note">Specifying no devices in the manifest means that the device list will be pulled from the SDK instead of pulling the device list from the manifest at compile time.</div></li>
<li>Select <em>Required Permissions</em>
<figure>
<img src="resources/programmers-guide/barrel_permissions_eclipse.png" style="max-width:450px;" title="Monkey Barrel Permissions" />
</figure></li>
<li>Select <em>Supported Languages</em> and click <em>Finish</em>
<figure>
<img src="resources/programmers-guide/barrel_languages_eclipse.png" style="max-width:450px;" title="Monkey Barrel Supported Languages" />
</figure></li>
</ol>

<p>A specific check is in place to ensure that developers cannot have a Barrel with the name &#8220;Toybox&#8221;. The Barrel has now been created&mdash;now it&#8217;s time to fill it!</p>

<p>Developers can think of Barrels as custom modules. In fact this is exactly how they should be set up:</p>

<pre><code class="c++">module FooBarrel {

    (:Bars)           // Notice the annotations above the submodule names
    module Bars {
        // Create a counter var for the &quot;Current Bars&quot;
        var currentBars = 0;

        // Draw a &quot;Bar&quot;
        function drawBar() {
           // . . . draw a super awesome &quot;Bar&quot;
           return Bar;
        }

        // Increment the Bar counter
        function addBar(currentBars) {
           bars = currentBars;
           bars ++;
           return bars;
        }

        // Get the current Bars
        function getCurrentBars() {
            return currentBars;
        }
    }

    (:BarsToo)        // Notice this here too
    module BarsToo {
        function fancyBars() {
            // . . . Do a fancy thing
            return somethingFancy;
        }
    }

    (:Empty)          // An empty annotation
    module Empty {

        // A sub-module without an annotation
        module AlsoEmpty {
        }
    }

    // This module throws an error
    module throwsError {
    }
}
</code></pre>

<p>Developers can use annotations to denote sub-modules within their Barrels. Sub-modules with annotations (i.e. the <code>(:Bars)</code> annotation above) allow developers to import certain sections of code without importing the entire Barrel. If a module directly below the namespace is found at compile time that is not decorated with an annotation, a warning will be generated. A module lacking an annotation that is found within a module decorated with an annotation will also generate a warning (i.e. <code>AlsoEmpty</code> module above). See <a href="#howtoincludebarrels">How to Include Barrels</a> for more information on how to include Barrels and specific annotations.</p>

<p>Annotations must also be configured in the manifest for the Barrel project:</p>

<ol>
<li>Double click the Barrel <code>manfest.xml</code></li>
<li>Click on the <em>Annotations</em> tab at the bottom of the manifest editor</li>
<li>Input your annotation name and click <em>Add</em>
<figure>
<img src="resources/programmers-guide/barrels_add_annotations.png" style="max-width:450px;" title="Adding Monkey Barrel Annotations" />
</figure></li>
<li>Add any addition annotations</li>
<li>Save your changes</li>
</ol>

<p>The annotations will be available to use in the Barrel project.</p>

<p>Barrels can also include resources. Resources are created and held within a Barrel in the same format as a regular application and are defined in XML format. See the [Resource Compiler] section of the Programmer&#8217;s Guide for more info on resources.</p>

<p>The compiler will build the resource module as a sub-module of the Barrel&#8217;s module. For example, in a Barrel called, <code>IconLibrary</code> the module will look like this:</p>

<pre><code class="c++">IconLibrary {                       // Barrel Level
    Rez {                           // Rez Level
        Drawables {                 // Drawables Level
            var myIcon = 123;       // Resource
        }
    }
}
</code></pre>

<p>Developers can reference resources within a Barrel by using the following syntax:</p>

<pre><code class="c++">@IconLibrary.Drawables.myIcon
</code></pre>

<p>This makes it easy for developers to pull those resources into their projects without any changes. All files utilized by a Barrel must live in the Barrel project&#8217;s root directory, determined by the directory of the manifest.xml file, as importing files external to the project is not supported.</p>

<h2 id="barrelsandversions">Barrels and Versions</h2>

<p>Each Barrel has a unique version ID number. This follows the same numbering system as The Connect IQ SDK (<code>Major.Minor.Micro.Quailifier</code> or <code>#.#.#.X</code>). The version qualifier can only be comprised of letters, numbers, and underscores.</p>

<h2 id="exportingamonkeybarrel">Exporting a Monkey Barrel</h2>

<p>Monkey Barrels are packaged by the Monkey C compiler in order to satisfy a basic syntactical check of the source code.
<strong>Note:</strong> While Barrels provide the mechanism of code libraries, they contain all of the unmodified source of your Barrel project.</p>

<p>Launch the Export Wizard in Eclipse by clicking the <em>Connect IQ</em> menu and selecting <em>Export Wizard</em>:</p>
<figure>
<img src="resources/programmers-guide/barrel_export.png" style="max-width:525px;" title="The Barrel Export Wizard" />
</figure>

<p>Click <em>Finish</em> to generate a barrel package (a .barrel file). If there are no errors the barrel is ready to use!</p>

<h2 id="howtoincludebarrels">How to Include Barrels</h2>

<p>In order to use a Barrel, developers will need to add it to the current project. This can be done through the Eclipse Plugin or by manually editing a project&#8217;s Jungle and manifest file.</p>

<h3 id="addingbarrelstoaprojectwiththeeclipseplugin">Adding Barrels to a Project with the Eclipse Plugin</h3>

<p>Developers can add new Barrels to their project through the Eclipse Plugin. This is found in a sub-menu in the project properties:</p>

<ol>
<li>Right Click on the Connect IQ Project root folder</li>
<li>Select <em>Configure Monkey Barrels</em>
<figure>
<img src="resources/programmers-guide/barrel_menu_configure_eclipse.png" style="max-width:450px;" title="Configure Monkey Barrels option" />
</figure></li>
<li>Click <em>Add Barrel</em>
<figure>
<img src="resources/programmers-guide/barrel_configure_add.png" style="max-width:450px;" title="Adding Monkey Barrels" />
</figure></li>
<li>Select the desired Barrel file in the file explorer</li>
<li>Check the desired annotations
<figure>
<img src="resources/programmers-guide/barrel_annotation_configure_add.png" style="max-width:450px;" title="Adding Monkey Barrel Annotations" />
</figure></li>
<li>Select <em>OK</em></li>
</ol>

<p>The Barrels and their specified annotations will be added to the default Barrel Jungle file automatically. The manifest file will also be updated with those Barrel dependencies.</p>
<div class="note">See the [Overriding Resources] section to see how to deal with Barrels in Jungle configuration files directly.</div>

<p>Once this is done, the selected Barrels will be added to your project.</p>

<h2 id="usingmonkeybarrels">Using Monkey Barrels</h2>

<p>Once they have been added to a project, using Barrels is straight forward and simple. It is not necessary for Developers to import Barrels into source files with the <code>using</code> statement, however they will need a using statement if they choose to use aliases for them:</p>

<pre><code class="c++">// This is a normal Toybox &quot;using&quot; statment
using Toybox.System;

// This sets up an alias for a &quot;submodule&quot; within a barrel
using FooBarrel.Bars as Bars;
</code></pre>

<p>At this point, the alias has been set up and the Barrel code has been made available in the project.</p>

<pre><code class="c++">// This is a normal Connect IQ call
System.println(&quot;Cool Bars&quot;);

// This is a general Barrels call (No using statment needed)
FooBarrel.BarsToo.fancyBars();

// This is a specific Barrels call (Alias)
var globalBars = Bars.getCurrentBars();

// This is a call to use a resource held in a Barrel
var icon = UserInterface.loadResource(IconLibrary.Rez.Drawables.myIcon)
</code></pre>

<h2 id="runnoevilandmonkeybarrels">Run No Evil and Monkey Barrels</h2>

<p>Barrels can be used in conjunction with the Run No Evil testing framework to test discrete sections of code. For more information on the Run No Evil testing framework developers can reference the [Run No Evil] documentation in the [How to Test] section of the programmer&#8217;s guide.</p>

<ol>
<li>Right click on the Barrel project root folder</li>
<li>Select <em>Run As</em></li>
<li>Select <em>Run No Evil Test</em></li>
</ol>

<p>The Barrel code with the correct testing annotations (See [Run No Evil] documentation), will be tested in the Run No Evil testing framework.</p>

<h2 id="barrelsinthecommandline">Barrels In The Command Line</h2>

<p>Barrels can be compiled and tested via the command line.</p>

<dl>
<dt><code>barrelbuild</code></dt>
<dd>Calls the Monkey C Barrel compiler. Much like <code>monkeyc</code> the <code>barrelbuild</code> call takes code from multiple files to be included in the library (.barrel file). The <code>-f</code> argument is required as the manifest file path is specified in one of the Barrel&#8217;s Jungle files. For more info, run <code>barrelbuild</code> without any arguments to see a full list of argument definitions.</dd>
</dl>

<pre><code>&gt; barrelbuild -o &lt;output.barrel&gt; -f &lt;barrel.jungle&gt;
</code></pre>

<dl>
<dt><code>barreltest</code></dt>
<dd>Executes Run No Evil tests on the <code>.barrel</code> file. Requires the <code>-d</code> argument with a valid device id.</dd>
</dl>

<pre><code>&gt; barreltest -o &lt;output.barrel&gt; -f &lt;barrel.jungle&gt; -d &lt;device_id&gt;
</code></pre>

<h2 id="unlockingbarrels">Unlocking Barrels</h2>

<p>The Connect IQ team has provided a few useful example Barrels for developers to try. To use these Barrels, go to the Garmin Connect IQ <a href="https://github.com/garmin/connectiq-apps">GitHub repository</a>. Clone or download the desired Barrels and add them to the project using one of the previously discussed methods.</p>

<h1 id="testinganddebugging">Testing and Debugging</h1>
<figure>
<img src="resources/programmers-guide/chopper-monkey.png" style="max-width:300px;" title="Gotta look this world in the eye, gotta live this life till you die" />
</figure>

<p>Connect IQ has a couple of different methods for testing and debugging your apps:</p>

<ol>
<li>Basic debugging with <code>println()</code> statements</li>
<li>Using the Eclipse debugger</li>
<li>Using the command line debugger (<code>mdd</code>)</li>
</ol>

<h2 id="basicdebugging">Basic Debugging</h2>

<p>One way to test Connect IQ apps is to include <code>System.println()</code> statements at strategic points in your app. Within Eclipse, these <code>println()</code> statements will output to the console. On a device, <code>println()</code> statements write to an <code>&lt;APPNAME&gt;.TXT file</code> in the <code>/GARMIN/APPS/LOGS</code> directory in the device file system.</p>

<p>These log files are not automatically created, so must be manually created on the device and named to match the name of the app&#8217;s corresponding <code>PRG</code> file. For example, to log output from <code>/GARMIN/APPS/MYAPP.PRG</code>, you must create <code>/GARMIN/APPS/LOGS/MYAPP.TXT</code>.</p>

<h2 id="debuggingviaeclipse">Debugging via Eclipse</h2>

<p>The Connect IQ application run configurations can be used to run an app in debug mode in addition to run mode. Running an app in debug mode follows the same steps as running an app normally. Debugging is only supported while running an application on the Connect IQ simulator.</p>
<figure>
<img src="resources/programmers-guide/debug_configuration.png" style="max-width:634px;" title="Connect IQ debug configuration" />
</figure>

<p>While actively debugging an app, only the File menu of the Simulator will be accessible. Once the app has resumed normal execution the remaining menus will be re-activated.</p>

<h3 id="settingabreakpoint">Setting a Breakpoint</h3>

<p>To set a breakpoint in the Connect IQ editor right click on the vertical ruler and select the &#8220;Toggle Breakpoint&#8221; option in the context menu.</p>
<figure>
<img src="resources/programmers-guide/toggle_breakpoint.png" style="max-width:332px;" title="Toggle a breakpoint via the context menu." />
</figure>

<h3 id="viewingapplicationstatus">Viewing Application Status</h3>

<p>When your application suspends while debugging you will be prompted to open the native Debug perspective. From here you can view the stack trace within the native <a href="http://help.eclipse.org/neon/index.jsp?topic=%2Forg.eclipse.jdt.doc.user%2Freference%2Fviews%2Fdebug%2Fref-debug_view.htm">Debug view</a>. Clicking on a stack frame within the stack trace will populate the native <a href="http://help.eclipse.org/neon/index.jsp?topic=%2Forg.eclipse.jdt.doc.user%2Freference%2Fviews%2Fvariables%2Fref-variables_view.htm&amp;cp=1_4_7_6">Variables view</a> with the applicable variables at that stack frame. Global variables will only be visible in the top stack frame; they appear as the <code>$</code> variable within that stack frame.</p>
<figure>
<img src="resources/programmers-guide/debug_variables_view.png" style="max-width:806px;" title="Viewing stack trace and variable values." />
</figure>

<h2 id="debuggingwiththecommandlineconnectiq3.2">Debugging with the Command Line (Connect IQ 3.2)</h2>

<p><code>mdd</code> is the Monkey C command line debugger. Modeled after <code>gdb</code>, <code>mdd</code> allows you to load your executables, set breakpoints, and examine stack frames, local variables, and the global environment.</p>

<h3 id="gettingstarted">Getting Started</h3>

<p>Make sure you have followed the &#8220;Getting Started&#8221; instructions to set up the command line environment. Before you begin, start the simulator:</p>

<pre><code class="bash">&gt; simulator &amp;
[1] 27984
&gt; mdd
</code></pre>

<p>You will be greeted with the following:</p>

<pre><code>Connect IQ Version 3.2.0. Type &quot;help&quot; for more information.
(mdd)
</code></pre>

<p>Help is always available from the command line prompt:</p>

<pre><code>(mdd) help
List of classes of commands:

breakpoints -- Making program stop at certain points.
data -- Examining data.
running -- Running the program.
stack -- Examining the stack.
status -- Status inquiries.
support -- Support facilities.

Type &quot;help&quot; followed by a class name for a list of commands in that class.
Type &quot;help all&quot; for the list of all commands.
Type &quot;help&quot; followed by a command name for full documentation.
Command name abbreviations are allowed if defined.
</code></pre>

<h3 id="loadingandrunninganexecutable">Loading and Running an Executable</h3>

<p>To load an executable into <code>mdd</code> you need the <code>prg</code>, the debug XML and the product the <code>prg</code> is built for. If you compile your <code>prg</code> using the <code>monkeyc</code> command, the <code>debug.xml</code> will also be generated, and the Eclipse plug-in typically outputs these files in the <code>bin</code> folder of your project.</p>

<p>You use the <code>file</code> command to load these into the <code>mdd</code> environment.</p>

<pre><code>(mdd) file MyFace.prg MyFace.prg.debug.xml fenix6
</code></pre>

<p>Now you can run the executable using the <code>run</code> command:</p>

<pre><code>(mdd) r
Starting app: C:\Projects\ciq-apps\strava\bin\Strava.prg
</code></pre>

<h3 id="settingbreakpoints">Setting Breakpoints</h3>

<p>Breakpoints can be assigned to a file/line pair with the <code>break</code> command:</p>

<pre><code>(mdd) break \path\to\Thx.mc:1138
</code></pre>

<p>Execution will pause when your program executes that line:</p>

<pre><code>Hit breakpoint 1, initialize () at Thx.mc:1138
(mdd)
</code></pre>

<h3 id="frameinformation">Frame Information</h3>

<p>You can inquire about your current stack frame using <code>info frame</code>:</p>

<pre><code>(mdd) info frame
Stack level 0, frame at 0x10002120
 in initialize() at Thx.mc:1138
 called by frame at 0x10000b48
 Args:
      self = &lt;0x84&gt; (Thx)
 Locals:
      thx = null
      sen = null
</code></pre>

<p>You can also use the <code>print</code> command to output variables as well as expressions.</p>

<pre><code>(mdd) print thx
thx = null
</code></pre>

<h3 id="controllingexecution">Controlling Execution</h3>

<p>You can step to the next line using the <code>next</code> command:</p>

<pre><code>(mdd) next
</code></pre>

<p>The <code>step</code> command will step into a subroutine:</p>

<pre><code>(mdd) step
</code></pre>

<p>The <code>continue</code> command will return to full execution until the next breakpoint is set or the app terminates:</p>

<pre><code>(mdd) continue
</code></pre>

<h2 id="handlingcrashes">Handling Crashes</h2>

<p>Despite the best debugging efforts, crashes will sometimes happen. There are two general types of on-device crash that can occur related to Connect IQ, which each generate log files: <em>app crashes</em> and <em>device crashes</em>.</p>

<h3 id="appcrashes">App Crashes</h3>

<p>App crashes typically result in an app quitting unexpectedly or displaying an &#8216;IQ!&#8217; icon, but does not cause the entire device to crash or reboot. This kind of crash is most commonly due to a bug in an app, though it can also be due to a bug in Connect IQ itself. Whenever an app crash occurs, a <code>CIQ_LOG.YAML</code> file is written or updated to <code>/GARMIN/APPS/LOGS</code> on the device, and contains information related to the crash that app developers may use to address the problem. Here is what a CIQ_LOG generally looks like:</p>

<pre><code class="YAML">Error: ErrorName
Details: Error description.
Time: 2018-02-07T19:07:56Z
Store-Id: 00000000-0000-0000-0000-000000000000
Store-Version: 0
Device-Id: 006-B0000-00
Device-Version: '0.00'
ConnectIQ-Version: 3.0.0
Filename: PRGNAME
Appname: DemoAppName
Stack:
  - pc: 0x100000ef
    File: 'C:\Path\To\source\File.mc'
    Line: 53
    Function: function_causing_error
  - pc: 0x10000080
    File: 'C:\Path\To\source\File2.mc'
    Line: 30
    Function: otherBrokenItems
</code></pre>

<p>The <code>ConnectIQ-Version</code> entry is not the Connect IQ version of the device. Rather, this refers to the SDK version used by the developer when exporting the application.</p>

<p><strong>Note:</strong> For devices running versions older than Connect IQ 3.0, a simplified error log will be printed as CIQ_LOG.TXT.</p>

<h3 id="devicecrashes">Device Crashes</h3>

<p>Device crashes typically cause the device to reboot or freeze. These indicate a Connect IQ or device firmware bug, and should be much less common than app crashes. When a device crash occurs, an <code>ERR_LOG.txt</code> file is written to <code>/GARMIN</code> on the device, containing stack trace information related to the crash. Please provide this file when reporting a crash on our developer forum. Garmin&#8217;s device teams can take a look at the device crash logs to determine the cause of the crash and will typically provide a fix in a future firmware release.</p>

<h3 id="anoteaboutlogfiles">A Note About Log Files</h3>

<p>When any log file on a device exceeds 5kb in size, it will automatically be archived to <code>&lt;LOGNAME&gt;.BAK</code>, and a new log will be started. Any old <code>.BAK</code> files will be overwritten when the archive occurs, so the max space a log can reach is around 10kb.</p>

<h1 id="unittesting">Unit Testing</h1>

<p>The Connect IQ SDK has Run No Evil, an automated unit testing framework found in the Test module. Run No Evil operates only within the Connect IQ simulator and provides the ability to add asserts and unit test methods to your app.</p>

<h2 id="asserts">Asserts</h2>

<p>Asserts are a useful way to check for conditions at critical points in your code and will always execute when your app is launched in the simulator. For example, if your app always expects the value of x and y to not be equal:</p>

<pre><code class="typescript">function onShow() {
  var x = 1;
  var y = 1;
  // Prints an error to the console when x and y are equal
  Test.assertNotEqualMessage(x, y, &quot;x and y are equal!&quot;);
}
</code></pre>

<p>The code above produces the following output in the console when the app is run in the Simulator:</p>

<pre><code class="bash">Device Version 0.1.0
Device id 1 name &quot;A garmin device&quot;
Shell Version 0.1.0
ASSERTION FAILED: x and y are equal!
</code></pre>

<p>Assert code requires no special compiler commands to execute within the simulator, and are removed by the compiler when building release code. Run No Evil has four different assert flavors:</p>

<pre><code class="typescript">//! Assert throws an exception if the test is false
//! @param [Boolean] test Expression to test for true.
function assert(test);

//! Assert throws an exception if the test is false
//! @param [Boolean] test Expression to test for true.
//! @param [String] the identifying message for the assert.
function assertMessage(test, message);

//! Throws an exception if value1 and value2 are not equal
//! @param [Object] Value to test for equality
//! @param [Object] Value to test for equality
function assertNotEqual(value1, value2);

//! Throws an exception if value1 and value2 are not equal
//! @param [Object] Value to test for equality
//! @param [Object] Value to test for equality
//! @param [String] the identifying message for the assert.
function assertNotEqualMessage(value1, value2, message);
</code></pre>

<h2 id="unittests">Unit Tests</h2>

<p>Unit tests are a great way to check discrete pieces of your app for pass/fail criteria. Each test is run independently, so if a test fails or causes a crash, the test will be marked as a failed test and the next test will automatically be executed. This allows an entire suite of tests to be run with a single command in an automated fashion.</p>

<p>Unit tests are written mostly like any other class, module, or function in Monkey C, but have the following requirements:</p>

<ul>
<li>Tests methods must be marked with the <code>:test</code> annotation</li>
<li>Test methods must take a <code>Logger</code> object</li>
<li>Tests methods that are not global (part of a test class or custom test module) must be static methods</li>
</ul>

<p>Here is a simple example of a unit test method:</p>

<pre><code class="typescript">// Unit test to check if 2 + 2 == 4
(:test)
function myUnitTest(logger) {
  var x = 2 + 2; logger.debug(&quot;x = &quot; + x);
  return (x == 4); // returning true indicates pass, false indicates failure
}
</code></pre>

<p>The unit tests include a handy logger with different logging levels for more meaningful error reporting. The sample code above uses a &#8220;debug&#8221; logging level, but the Logger contains a total of three logging levels that can be used to distinguish between different types of errors in your unit test output:</p>

<pre><code class="typescript">//! Write a debug string to the output stream. The String is prefixed with [DEBUG] and time stamp
//! @param [String] Output string
function debug(str);

//! Write a warning string to the output stream. The String is prefixed with [WARNING] and time stamp
//! @param [String] Output string
function warning(str);

//! Write an error string to the output stream. The String is prefixed with [ERROR] and time stamp
//! @param [String] Error string
function error(str);
</code></pre>

<p>Unlike asserts, which always execute in the simulator, unit tests only run when the compiler is told to run them. Unit tests must be executed from the terminal and are not currently available in the Eclipse plug-in. Fortunately, it&#8217;s a straight-forward, three-step process:</p>

<ul>
<li><strong>Build the Project</strong>: Use the &#8211;unit-test flag on the build command to compile with unit tests. It&#8217;s usually easiest to copy and paste the build command from the Eclipse console and add the unit test flag.</li>
<li><strong>Launch the Simulator</strong>: You must use the <code>connectiq</code> script in your SDK&#8217;s bin directory to launch the simulator from the terminal (no arguments required).</li>
<li><strong>Run the App</strong>: Use the <code>monkeydo</code> script in your SDK&#8217;s bin directory with the <code>/t</code> flag to run the app with unit tests enabled - <code>monkeydo.bat path\to\projects\bin\MyApp.prg /t</code></li>
</ul>

<p>You may also supply a function name after /t to run the test associated with a single function. The sample unit test above produces the following output in the console:</p>

<pre><code class="bash">Device Version 0.1.0
Device id 1 name &quot;A garmin device&quot;
Shell Version 0.1.0
\------------------------------------------------------------------------------
Executing test myUnitTest…
DEBUG (14:16): x = 4
Pass
==============================================================================
RESULTS
Test:              Status:
myUnitTest           Pass
Ran 1 test
PASSED (failures=0, errors=0)
Connection Finished
Closing shell and port
</code></pre>

<p>Unit test code will not execute unless the compiler is explicitly told to run unit tests. All test code is automatically removed at compile time when your app is exported for use on devices.</p>

<h1 id="errorreportingapplicationera">Error Reporting Application (ERA)</h1>

<p>The ERA tool can be used to view your app&#8217;s crashes after it has been released on the store. If your app crashes on a device the error report will be collected and aggregated by the ERA server. These reports can be viewed for up to 30 days after a crash occurs. This tool is available in the bin folder of the SDK.</p>

<h2 id="gettingstarted">Getting Started</h2>

<p>To launch the graphical ERA tool, either select <strong>Start ERA</strong> in the Connect IQ menu of the Eclipse plug-in or run era.jar from the bin/ folder of the SDK. When first running the tool, the Manage Developers window will appear. In order to use the tool you must first add a developer identity.</p>

<h3 id="commandline">Command Line</h3>

<p>The ERA tool can be launched from the command line to retrieve crashes for a single app. This will output the crashes for the given app in a JSON format.</p>

<pre><code>&gt; era [-a &lt;arg&gt;] [-k &lt;arg&gt;]

</code></pre>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Argument</th>
	<th style="text-align:left;">Definition</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>-a &lt;arg&gt;</code></td>
	<td style="text-align:left;">The app UUID to retrieve crashes for</td>
</tr>
<tr>
	<td style="text-align:left;"><code>-k &lt;arg&gt;</code></td>
	<td style="text-align:left;">Developer key for the given app</td>
</tr>
</tbody>
</table>

<h2 id="addinganewdeveloper">Adding a New Developer</h2>
<figure>
<img src="resources/programmers-guide/era_manage_developers.png" style="max-width:563px;" title="Add Developer Window" />
</figure>

<p>The Manage Developers window lists all the known developer identities. In this window, you can add a developer, remove a developer, or get information about a selected developer. You can launch this window by selecting <strong>Settings &gt; Manage Developers</strong> in the menu. If you add any new apps for a developer identity, they will be fetched the next time the ERA viewer is opened.</p>

<p>To add a developer, first click on the <strong>+</strong> button. This will bring up the Add Developer window.</p>
<figure>
<img src="resources/programmers-guide/era_add_developer.png" style="max-width:563px;" title="Add Developer Window" />
</figure>

<p>In this window, you will need to enter a developer ID and an optional Default Developer Key. If a default developer key is entered, then any new apps for this developer will automatically be assigned this key. If you use multiple keys for your apps, you can override the default key for each app. To obtain your developer ID search for your apps in the app store and click on your developer name. The URL for this page will contain your developer ID. For example, if the URL is https://apps.garmin.com/en-US/developer/e1683f31&#8211;54fe&#8211;45d9&#8211;9aa8-cba39fe7fd1f/apps then the developer ID is e1683f31&#8211;54fe&#8211;45d9&#8211;9aa8-cba39fe7fd1f. To remove a developer click on the <strong>-</strong> button. This will remove the developer and all its apps from the ERA tool. To view information about a developer click on the <strong>+</strong> button. This will bring up the Edit Developer window.</p>
<figure>
<img src="resources/programmers-guide/era_developer_info.png" style="max-width:563px;" title="Add Developer Window" />
</figure>

<p>In this window you can change the default key used for the developer. This key will be assigned to any new apps that are downloaded from the server.</p>

<h2 id="viewingappsettings">Viewing App Settings</h2>
<figure>
<img src="resources/programmers-guide/era_manage_apps.png" style="max-width:563px;" title="Add Developer Window" />
</figure>

<p>The Manage Apps window allows you to see the apps for all the known developers. You can launch this window by selecting <strong>Settings &gt; Manage Apps</strong> in the menu. The list of apps is color coded to allow easy identification of an app&#8217;s status.</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:center;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Font Style</th>
	<th style="text-align:left;">App Status</th>
	<th style="text-align:center;">Crashes Viewable</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Normal</td>
	<td style="text-align:left;">Released app</td>
	<td style="text-align:center;">Yes</td>
</tr>
<tr>
	<td style="text-align:left;">Gold</td>
	<td style="text-align:left;">Beta app</td>
	<td style="text-align:center;">Yes</td>
</tr>
<tr>
	<td style="text-align:left;">Red</td>
	<td style="text-align:left;">Invalid key for the app</td>
	<td style="text-align:center;">No</td>
</tr>
<tr>
	<td style="text-align:left;">Strikethrough</td>
	<td style="text-align:left;">App is hidden</td>
	<td style="text-align:center;">No</td>
</tr>
</tbody>
</table>

<p>In this window you can add additional apps, rearrange the apps, and change an app&#8217;s settings. To add new apps, click on the <strong>+</strong> button to bring up the Manage Developers window. After adding a new developer will download all the apps for them to the ERA tool. To rearrange the order of the apps, click on an app and click on the <strong>&and;</strong> or <strong>&or;</strong> buttons. The order of the apps in this window are reflected in the app selection box in the crash report view. To change an app&#8217;s settings choose the app in the list and click on the <strong>i</strong> button.</p>
<figure>
<img src="resources/programmers-guide/era_app_info.png" style="max-width:563px;" title="Add Developer Window" />
</figure>

<p>In the Application Settings window you can change the developer key used for this app as well as hide the app from the drop down box in the crash report view. The app&#8217;s developer key will override the default developer key set for the developer. If the <strong>Hide this app</strong> box is checked then the app will not be shown in the crash report view app list.</p>

<h2 id="viewingcrashreports">Viewing Crash Reports</h2>
<figure>
<img src="resources/programmers-guide/era_report_view.png" style="max-width:563px;" title="Add Developer Window" />
</figure>

<p>The crash report view allows you to view all uploaded crash reports for an app in the last 30 days. At the top of this window you can select which app&#8217;s crash reports to view. After selecting an app the latest reports will be downlaoded from the server. In the left pane of the window a list of crash reports will be shown. Each unique crash will be identified by file name, function, and line number where the crash occurred. Choosing a crash in the left pane causes the details for the crash to be shown in the right pane. At the top of the right pane the <strong>Fixed</strong> checkbox can be used to indicate that this particular crash has been fixed. The fixed status will persist across application runs and SDK upgrades.</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Font Style</th>
	<th style="text-align:left;">Crash Status</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Normal</td>
	<td style="text-align:left;">Crash has been viewed.</td>
</tr>
<tr>
	<td style="text-align:left;">Bold</td>
	<td style="text-align:left;">Crash has not been viewed.</td>
</tr>
<tr>
	<td style="text-align:left;">Strikethrough</td>
	<td style="text-align:left;">Crash has been marked as fixed.</td>
</tr>
</tbody>
</table>

<h1 id="publishingtotheconnectiqstore">Publishing to the Connect IQ Store</h1>
<figure>
<img src="resources/programmers-guide/captain-monkey.png" style="max-width:300px;" title="Just sit back now and you'll hear a tale; a tale of a fateful trip..." />
</figure>

<p>We&#8217;re glad you want to develop for Garmin devices, and we want you to be successful. Here are some guidelines to keep in mind as you develop your apps. These guidelines will help you speed through the approval process:</p>

<ul>
<li>We will reject submissions for any content or behavior that we believe is inappropriate</li>
<li>If your submission doesn&#8217;t function or crashes frequently, it may not be accepted</li>
<li>Your submission cannot use GPS data in a way that violates our developer terms of use</li>
<li>Do not use trademarked or copyrighted content without permission</li>
<li>These guidelines may change at any time</li>
</ul>

<p>Once your apps are fully tested and ready to go, you can publish and promote your apps to the Garmin Connect IQ App Store. Here&#8217;s how to prepare your apps for submission.</p>

<ol>
<li>Make sure the manifest file specifies all products supported by the app</li>
<li>Use the App Export Wizard to generate an IQ file, which will contain binaries for each supported device</li>
<li>Upload the app to the App Store</li>
</ol>

<h2 id="checksupportedproducts">Check Supported Products</h2>

<p>It is easy to quickly check the products supported by an app by viewing the manifest XML file in the project root:</p>

<pre><code class="xml">&lt;iq:products&gt;
    &lt;iq:product id=&quot;fenix3&quot;/&gt;
    &lt;iq:product id=&quot;vivoactive&quot;/&gt;
    &lt;iq:product id=&quot;fr920xt&quot;/&gt;
    &lt;iq:product id=&quot;epix&quot;/&gt;
&lt;/iq:products&gt;
</code></pre>

<p>Alternatively, right-click the project in the Eclipse Project Explorer, and choose <em>Properties</em>. The Properties window provides an easy way to edit targeted platforms and permissions:</p>
<figure>
<img src="resources/programmers-guide/app_properties.png" style="max-width:635px;" title="The App Properties Windows in Eclipse" />
</figure>

<h2 id="exportingtheapp">Exporting the App</h2>

<p>Launch the Export Wizard in Eclipse by clicking the <em>Connect IQ</em> menu and selecting <em>Export Wizard</em>:</p>
<figure>
<img src="resources/programmers-guide/export_wizard.png" style="max-width:525px;" title="The App Export Device Wizard" />
</figure>

<p>If needed, click <em>Next</em> to select supported languages, and then click <em>Finish</em> to generate an app package (a .iq file). If there are no errors your app is ready to publish!</p>

<h2 id="publishingthefirstversion">Publishing the First Version</h2>

<p>To upload the IQ file to your developer account, start by visiting the <a href="http://developer.garmin.com/connect-iq/submit-an-app/">Submit an App</a> page of the Garmin Developer site. Click on the <em>Submit an App</em> button to fill out the form shown below:</p>
<figure>
<img src="resources/programmers-guide/upload_app.png" style="max-width:600px;" title="Uploading an app to the App Store" />
</figure>

<p>Once the IQ file has been validated, add in a description, screen shots, and other details about your app:</p>
<figure>
<img src="resources/programmers-guide/title_description.png" style="max-width:600px;" title="Adding a title and description" />
</figure>

<h2 id="gdpr">GDPR</h2>

<p>In April of 2016, the EU Parliament passed the <a href="https://publications.europa.eu/en/publication-detail/-/publication/3e485e15-11bd-11e6-ba9a-01aa75ed71a1/language-en">General Data Protection Regulation</a> (GDPR), an act that was designed to harmonize data privacy laws across the European Union (EU). The GDPR provides requirements for the lawful processing of EU Personal Data, including requirements related to data privacy, consent, and digital services. GDPR generally applies to the processing of EU Personal Data, and it may apply to you or your company even if you are not in the EU. Data protection authorities may issue fines up to 4% of annual global turnover or €20 Million, whichever is greater, for non-compliance. . This isn&#8217;t legal advice and we encourage you to consult with your legal counsel for guidance.</p>

<p>Connect IQ is a global platform, and, as stated in the <a href="https://developer.garmin.com/connect-iq/sdk">Connect IQ license agreement</a>, developers are responsible for their apps&#8217; compliance with all applicable laws, including those related to data protection and privacy. Specific responsibilities related to privacy can be found in Section 2 of the <a href="https://developer.garmin.com/connect-iq/sdk">Connect IQ license agreement</a>. Developers should review the GDPR to determine what obligations they may have under the GDPR. These obligations may include the following:</p>

<ul>
<li>Asking for consent for collection of personal data.</li>
<li>Providing access to information on what personal data concerning them is being processed, where and for what purpose.</li>
<li>Providing access to any personal data collected from them free of charge.</li>
<li>Ability for a user to erase their presence entirely within your product, including the ability to halt third party processing of personal data.</li>
</ul>

<p>If your solution collects personal data in any way, including using the <code>Communications</code> permission to collect or retain personal data (potentially in conjunction with <code>Sensor</code>, <code>Sensor History</code>, or <code>Position</code> permissions) or using any other mechanism, you are responsible for ensuring that your solution is in compliance with GDPR.</p>

<h2 id="approvalprocess">Approval Process</h2>

<p>After your app is successfully uploaded to the app store, the Connect IQ team will review your submission. Aside from special circumstances, such as national holidays, reviews are completed within 72 hours.</p>

<p>If you indicate your app uses one or more ANT+ profiles, an additional 48 hours is typically required to complete ANT+ certification. Once certification is complete, we&#8217;ll provide ANT+ branding information and a link to the <a href="https://www.thisisant.com/directory">ANT+ Directory</a> to add to your app&#8217;s description on the store.</p>

<blockquote>
<p>ANT+ Certification is designed to standardize all ANT+ products and applications and foster a consumer-friendly ecosystem, and is required to apply ANT+ brands, logos or wordmarks to any product or application, including its associated collateral.</p>
</blockquote>

<p>While approval is pending, your app will not appear on the Garmin Connect App Store, but you will be able to preview your app and download it yourself for testing. Once it&#8217;s approved, you will receive a notification and it will appear on the Connect IQ App Store for all users to download and load to their devices!</p>

<p>If for some reason your app is rejected, don&#8217;t despair! The Connect IQ team will provide specific reasons for the rejection via email, and may work with you to resolve issues. The app will continue to be available for you to update as needed and re-submit for approval, but it will not be displayed on the Connect IQ App Store until approved.</p>

<h1 id="betaapps">Beta Apps</h1>
<figure>
<img src="resources/programmers-guide/beta_app.png" style="max-width:275px;" title="This is for testing purposes only" />
</figure>

<p>Connect IQ beta apps allows developers to test app settings and Garmin Connect integration in production without releasing the app.</p>

<p>Uploading a beta app will let you stage your app in production. To use this feature, you will need to create an alternate app id in your manifest using a <a href="https://www.uuidgenerator.net/">UUID creator</a>. Beta apps will show up in your uploaded apps, and you can download them to your Garmin device. Once downloaded you can edit app settings in Garmin Connect and Garmin Express and test your developer fields in Garmin Connect. After you upload the beta app, you can update the beta version as many times as you want. When you are ready to release the app, change the app id to your production version in the manifest and upload it without checking the &#8220;Beta App&#8221; checkbox. Note that the app will have a separate store identifier from your final app, and URLs to the beta will not be visible outside of your account.</p>

<h1 id="apptrialsconnectiq2.3">App Trials (Connect IQ 2.3)</h1>

<p>The app trials feature allows developers who have gone through the appropriate approval process (see https://developer.garmin.com for details) to enable a special &#8220;trial&#8221; mode for their app. Enabling trial mode is accomplished by adding a new tag to the manifest under the application tag as follows:</p>

<pre><code class="xml">&lt;iq:application entry=&quot;CommExample&quot; id=&quot;a3421feed289106a538cb9547ab12095&quot;
        name=&quot;AppName&quot; launcherIcon=&quot;LauncherIcon&quot; type=&quot;widget&quot; minSdkVersion=&quot;1.3.1&quot;&gt;
    &lt;iq:trialMode enable=&quot;true&quot;&gt;
        &lt;iq:unlockURL&gt;https://a.custom.unlock.url.info&lt;/iq:unlockURL&gt;
    &lt;/iq:trialMode&gt;
&lt;/iq:application&gt;
</code></pre>

<p>The unlock URL provides an endpoint for the app store to redirect the user to in order go through whatever you want your app &#8220;unlock&#8221; process to be. The app store will only accept secured HTTPS-URLs when uploading your iq-file. Also make sure that the enable-attribute of the trialMode-tag is set to &#8220;true&#8221;.</p>

<p>&#8212;NOTE&#8212;</p>

<p>The app trials feature is not supported for watchfaces.</p>

<h2 id="trialmodefunctionality">Trial Mode Functionality</h2>

<p>Developers can query the new isTrial() method in AppBase to determine if trial mode is active for their app, which can be used to trigger special trial-mode functionality. App trials can also be time-based. The method getTrialDaysRemaining() in AppBase should be overriden if you wish to support a time-based trial. getTrialDaysRemaining() must return a Number that represents how many days are remaining in the trial(or null if time-based trials are to be disabled), and if 0 is returned, the app will be prevented from running as the trial will be considered &#8220;expired&#8221;. By default, when an app is in trial mode, the system will push special trial notifications to the use either to inform them of how many days remain in their trial(if you&#8217;ve overridden getTrialDaysRemaining() to return a non-null value), or more generally that trial mode is active. If you do not wish for these notifications to be displayed to the user, you can override AppBase.allowTrialMessages() to return false.</p>

<h2 id="trialappserverapi">Trial App Server API</h2>

<p>Once the app is available in the store, the user can unlock the app by clicking on the unlock button on the store.</p>

<p>TODO: Put image here</p>

<p>At this point the app store will redirect to the provided unlock-URL, adding these parameters to the URL:</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Parameter Name</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">callbackUrl</td>
	<td style="text-align:left;">The URL that has to be called back when the unlock-process on your side successfully finished.</td>
</tr>
<tr>
	<td style="text-align:left;">appUnlockRequestId</td>
	<td style="text-align:left;">The app store&#8217;s interal unlock-ID which can be stored by the app-developer as reference.</td>
</tr>
<tr>
	<td style="text-align:left;">appPageUrl</td>
	<td style="text-align:left;">The app details page of the app to be unlocked. You should redirect to this page after a successful call to the callback-URL, and ask the user to download the unlocked app for his desired device.</td>
</tr>
</tbody>
</table>

<p>So this is what a typical/complete call from the app store to your unlock-URL will look like:</p>

<pre><code>https://your.unlock.url.com?appUnlockRequestId=1fe443e5-e76c-4e1c-b82b-2d084bd4c4fe&amp;callbackUrl=https%3A%2F%2Fapps.garmin.com%2FappUnlock%3FappUnlockRequestId%3D1fe443e5-e76c-4e1c-b82b-2d084bd4c4fe&amp;appPageUrl=https%3A%2F%2Fapps.garmin.com%2Fen-US%2Fapps%2Fbf1d944a-8a54-41fa-b7b0-24e651dc88e1
</code></pre>

<p>Both the callbackUrl and the appPageUrl will be passed in URL-encoded form.</p>

<h2 id="howtousethecallbackurl">How to Use the callbackUrl</h2>

<p>The callbackUrl-endpoint is secured and can only be used with a (one-legged) OAuth1-signed request.</p>

<p>For this you&#8217;ll need to obtain your individual set of key/secret credentials from the app store&#8217;s &#8220;Developer Dashboard&#8221;:</p>

<p>TODO: Put Image Here</p>

<p>With these credentials you simply create a standard OAuth1-request and fire it to the callback-URL.
(Using a framework which generates all the necessary OAuth-HTTP-Headers is recommended.)</p>

<p>A straightforward Java example (using the Signpost-library, and Apache&#8217;s HttpClient) would look like this:</p>

<pre><code class="java">HttpGet request = new HttpGet(&quot;callbackUrl&quot;);

OAuthConsumer consumer = new CommonsHttpOAuthConsumer(&quot;yourKey&quot;, &quot;yourSecret&quot;);
consumer.sign(request);

HttpClient client = HttpClientBuilder.create().build();
HttpResponse response = client.execute(request);

System.out.println(&quot;Return code: &quot; + org.springframework.http.HttpStatus.valueOf(response.getStatusLine().getStatusCode()));
</code></pre>

<p>The following return-codes can be expected:</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Status Code</th>
	<th style="text-align:left;">Status Phrase</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">200</td>
	<td style="text-align:left;">OK</td>
	<td style="text-align:left;">Everything worked just fine; the app got marked as &#8220;unlocked&#8221; for the user.</td>
</tr>
<tr>
	<td style="text-align:left;">202</td>
	<td style="text-align:left;">Accepted</td>
	<td style="text-align:left;">When making a successful test-request (see below).</td>
</tr>
<tr>
	<td style="text-align:left;">401</td>
	<td style="text-align:left;">Unauthorized</td>
	<td style="text-align:left;">When the authorization (OAuth) was incorrect.</td>
</tr>
<tr>
	<td style="text-align:left;">404</td>
	<td style="text-align:left;">Not Found</td>
	<td style="text-align:left;">When the requested unlock item was not found.</td>
</tr>
<tr>
	<td style="text-align:left;">409</td>
	<td style="text-align:left;">Conflict</td>
	<td style="text-align:left;">When an app is already being marked as unlocked in the app store.</td>
</tr>
<tr>
	<td style="text-align:left;">410</td>
	<td style="text-align:left;">Gone</td>
	<td style="text-align:left;">When an app is orphaned (e.g. because the app changed ownership due to GDPR).</td>
</tr>
<tr>
	<td style="text-align:left;">510</td>
	<td style="text-align:left;">Internal Server Error</td>
	<td style="text-align:left;">When an unexpected error occurred.</td>
</tr>
</tbody>
</table>

<p>You can test your OAuth-implementation without the need of an actual unlock-request.</p>

<p>Just make a signed call using your credentials and &#8220;test&#8221; as appUnlockRequestId.</p>

<pre><code>https://apps.garmin.com/appUnlock?appUnlockRequestId=test
</code></pre>

<p>When receiving a 202, you can be sure that your OAuth-handling is working.</p>

<div class="footnotes">
<hr />
<ol>

<li id="fn:1">
<p>Music-capable wearables never skip leg day <a href="#fnref:1" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:2">
<p>Non-music wearables are on RAM keto <a href="#fnref:2" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:3">
<p>Graphical titles are currently only supported via programmatic creation of <code>MenuItem</code> elements in <code>Menu2</code>. Defining a title as a drawable resource will result in compiler error. <a href="#fnref:3" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:4">
<p>Their own language and their own video file format? Who do these people think they are? <a href="#fnref:4" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:5">
<p>Developers may also check the <em>Auto read memory</em> checkbox to have the device memory read automatically each time an action is taken. <a href="#fnref:5" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:6">
<p>namaste <a href="#fnref:6" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

</ol>
</div>


</body>
</html>
